<body data-type="generalComponents">
    {include file='layout/top' /}

    <div class="tpl-page-container tpl-page-header-fixed">

        {include file='layout/sidebar' /}

        <div class="tpl-content-wrapper">
            <div class="tpl-content-page-title">
                Amaze UI 表单
            </div>
            <ol class="am-breadcrumb">
                <li><a href="#" class="am-icon-home">首页</a></li>
                <li><a href="#">表单</a></li>
                <li class="am-active">Amaze UI 表单</li>
            </ol>
            <div class="tpl-portlet-components">
                <div class="portlet-title">
                    <div class="caption font-green bold">
                        <span class="am-icon-code"></span> 表单
                    </div>
                    <div class="tpl-portlet-input tpl-fz-ml">
                        <div class="portlet-input input-small input-inline">
                            <div class="input-icon right">
                                <i class="am-icon-search"></i>
                                <input type="text" class="form-control form-control-solid" placeholder="搜索..."> </div>
                        </div>
                    </div>


                </div>

                <div class="tpl-block">

                    <div class="am-g">
                        <div class="tpl-form-body tpl-form-line">
                            <form class="am-form tpl-form-line-form" id="settingForm">

                                <!-- <hr> -->
                                
                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-form-label"><h5>微信公众号配置</h5></label>
                                </div>
                                <div class="am-form-group">
                                    <label for="user-name" class="am-u-sm-3 am-form-label">开发者ID <span class="tpl-form-line-small-title">AppID</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" class="tpl-form-input" id="wechat.AppID" name="wechat.AppID" placeholder="AppID" value="{$settingInfo['wechat.AppID']}">
                                        <small>请填写开发者ID。</small>
                                    </div>
                                </div>

                                <div class="am-form-group">
                                    <label for="user-name" class="am-u-sm-3 am-form-label">开发者密码 <span class="tpl-form-line-small-title">AppSecret</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" class="tpl-form-input" id="wechat.AppSecret" name="wechat.AppSecret" placeholder="AppSecret" value="{$settingInfo['wechat.AppSecret']}">
                                        <small>请填写开发者密码。</small>
                                    </div>
                                </div>

                                <div class="am-form-group">
                                    <label for="user-name" class="am-u-sm-3 am-form-label">开发者令牌 <span class="tpl-form-line-small-title">Token</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" class="tpl-form-input" id="wechat.Token" name="wechat.Token" placeholder="Token" value="{$settingInfo['wechat.Token']}">
                                        <small>请填写开发者令牌。</small>
                                    </div>
                                </div>

                                <div class="am-form-group">
                                    <label for="user-name" class="am-u-sm-3 am-form-label">消息加密密钥 <span class="tpl-form-line-small-title">EncodingAESKey</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" class="tpl-form-input" id="wechat.EncodingAESKey" name="wechat.EncodingAESKey" placeholder="EncodingAESKey" value="{$settingInfo['wechat.EncodingAESKey']}">
                                        <small>请填写消息加密密钥。</small>
                                    </div>
                                </div>

                                <hr>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-form-label"><h5>网站配置</h5></label>
                                </div>
                                <div class="am-form-group">
                                    <label for="user-name" class="am-u-sm-3 am-form-label">网站标题 <span class="tpl-form-line-small-title">Title</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" class="tpl-form-input" id="website.Title" name="website.Title" placeholder="Title" value="{$settingInfo['website.Title']}">
                                    </div>
                                </div>

                                <!-- <div class="am-form-group">
                                    <label for="user-intro" class="am-u-sm-3 am-form-label">网站描述</label>
                                    <div class="am-u-sm-9">
                                        <textarea class="" rows="10" id="website.Desc" placeholder="请输入网站描述" name="website.Desc">{$settingInfo['website.Desc']}</textarea>
                                    </div>
                                </div> -->

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-form-label">网站描述 <span class="tpl-form-line-small-title">Desc</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" placeholder="请输入网站描述" name="website.Desc" value="{$settingInfo['website.Desc']}">
                                    </div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-form-label">SEO <span class="tpl-form-line-small-title">Keywords</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" placeholder="输入SEO关键字" name="website.Keywords" value="{$settingInfo['website.Keywords']}">
                                    </div>
                                </div>

                                <div class="am-form-group">
                                    <label class="am-u-sm-3 am-form-label">标语 <span class="tpl-form-line-small-title">Slogan</span></label>
                                    <div class="am-u-sm-9">
                                        <input type="text" placeholder="输入slogan" name="website.Slogan" value="{$settingInfo['website.Slogan']}">
                                    </div>
                                </div>
                                
                                <div class="am-form-group">
                                    <label for="user-name" class="am-u-sm-3 am-form-label">LOGO</label>
                                    <div class="am-u-sm-9">
                                        
                                        <input type="text" id="website.LOGO" name="website.LOGO" value="{$settingInfo['website.LOGO']}">
                                        <br>
                                        <div class="am-form-group am-form-file">

                                            <div class="tpl-form-file-img" id="doPreview" if $article_info neq true}style="display: none;"{/if}>
                                                <img src="{$settingInfo['website.LOGO']}" alt="">
                                            </div>

                                            <button type="button" id="uploadBtn" class="am-btn {if $settingInfo['website.LOGO']}am-btn-primary{else}am-btn-default{/if} am-btn-sm">
                                                <i class="am-icon-cloud-upload"></i> {if $settingInfo['website.LOGO']}重新选择LOGO{else}选择要上传的LOGO{/if}
                                            </button>
                                            <input type="file" name="images" multiple="multipart/form-data" onchange="showPreview(this)">
                                        </div>                                        
                                    </div>
                                </div>

                                <!-- <div class="am-form-group">
                                    <label for="user-phone" class="am-u-sm-3 am-form-label">作者 <span class="tpl-form-line-small-title">Author</span></label>
                                    <div class="am-u-sm-9">
                                        <select data-am-selected="{searchBox: 1}">
                                          <option value="a">-The.CC</option>
                                          <option value="b">夕风色</option>
                                          <option value="o">Orange</option>
                                        </select>
                                    </div>
                                </div>                   
                                                                
                                <div class="am-form-group">
                                    <label for="user-intro" class="am-u-sm-3 am-form-label">隐藏文章</label>
                                    <div class="am-u-sm-9">
                                        <div class="tpl-switch">
                                            <input type="checkbox" class="ios-switch bigswitch tpl-switch-btn" checked />
                                            <div class="tpl-switch-btn-view">
                                                <div>
                                                </div>
                                            </div>
                                        </div>

                                    </div>
                                </div> -->

                                <div class="am-form-group">
                                    <div class="am-u-sm-9 am-u-sm-push-3">
                                        <button type="button" id="saveBtn" class="am-btn am-btn-primary tpl-btn-bg-color-success ">提交</button>
                                    </div>
                                </div>
                            </form>

                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</body>

<script type="text/javascript">

var API_URL = '/admin.php';

$("#saveBtn").on('click', function(){
    var data = $("#settingForm").serialize();
// console.log(data);return;
    $.ajax({
        url:API_URL+'/setting/save',
        type:'POST',
        data:data,
        dataType:'json',
        success:function(res) {
            if (res.code == 200) {
                // window.location.href = API_URL+'/setting';                
                alert('设置已保存')
            }else{  
                alert(res.msg)
            }
        }
    })
})

// var uploading = false;

function showPreview(obj){    
    var fileData = obj.files[0];
    var formData = new FormData();
    formData.append("images", fileData);
    formData.append("type", 'logo');

    // if(uploading){
    //     alert("头像正在上传中，请稍候");
    //     return false;
    // }

    // if (!verifyPicFile(obj)) {
    //     // do something
    // }

    $.ajax({
        url: API_URL + "/upload/uploadPic",
        type: 'POST',
        cache: false,
        data: formData,
        processData: false,
        contentType: false,
        dataType:"json",
        beforeSend: function(){
            uploading = true;
        },
        success : function(res) {
            if (res.code == 200) {
                $("#doPreview img").attr("src", res.data.img_url);
                $("#doPreview").show();
                $("#website.LOGO").val(res.data.img_url);

                // 按钮样式
                $("#uploadBtn").removeClass("am-btn-default").addClass("am-btn-primary");
            } else {
                showError(res.data.msg);
                // 按钮样式
                $("#uploadBtn").removeClass("am-btn-default").addClass("am-btn-danger");                
            }

            $("#uploadBtn").html('<i class="am-icon-cloud-upload"></i> 重新选择LOGO');         
        }
    });
}

// //图片尺寸验证
// function verifyPicFile(file) {
//     var filePath = file.value;
//     if(filePath){
//         //读取图片数据
//         var filePic = file.files[0];
//         var reader = new FileReader();
//         reader.onload = function (e) {
//             var data = e.target.result;
//             //加载图片获取图片真实宽度和高度
//             var image = new Image();
//             image.onload=function(){
//                 var width = image.width;
//                 var height = image.height;
//                 if (width/height == 16/9){
//                     //  do nothing
//                 }else {
//                     alert("图片宽高比例应为：16:9，建议上传1920*1280尺寸的图片");
//                     file.value = "";
//                     return false;
//                 }
//             };
//             image.src= data;
//         };
//         reader.readAsDataURL(filePic);
//     }else{
//         return false;
//     }
// }

</script>