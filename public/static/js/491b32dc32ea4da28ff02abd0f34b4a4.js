function ToDatetimeStr(n){return n==""?"":n.substring(0,4)+"-"+n.substring(4,6)+"-"+n.substring(6,8)+" "+n.substring(8,10)+":"+n.substring(10,12)+":"+n.substring(12)}function ToWeekday(n){var t="";switch(n){case 1:t="星期日";break;case 2:t="星期一";break;case 3:t="星期二";break;case 4:t="星期三";break;case 5:t="星期四";break;case 6:t="星期五";break;case 7:t="星期六";break;default:t=""}return t}function ToWeather(n){var t="";switch(n){case 1:t="晴天";break;case 2:t="多云";break;case 3:t="阴天";break;case 4:t="大雨";break;case 5:t="雷雨";break;case 6:t="小雨";break;case 7:t="雾";break;case 8:t="雪";break;case 9:t="雾霾";break;case 10:t="夜间";break;default:return""}return t}function jsPost(n,t,i){var r=Math.random(),u;i?(u=window.open(),u.document.write('<form id="post'+r+'" name="post'+r+'" action="'+n+'" method="post" >'),u.document.write('<input type="hidden" name="keyValue" value="'+t+'" />'),u.document.write("<\/form>"),u.document.getElementById("post"+r).submit()):(document.write('<form id="post'+r+'" name="post'+r+'" action="'+n+'" method="post" >'),document.write('<input type="hidden" name="keyValue" value="'+t+'" />'),document.write("<\/form>"),document.getElementById("post"+r).submit())}function RunIndex(){location.href="/WuJi/Index"}function NoInList(){$("#menuDiv").html('<button type="button" class="btn btn-default indexbtn-default dropdown-toggle navbar-brand " data-toggle="dropdown" id="btnMydiarys">我的日记<\/button>')}function GetContent(){$.post("/WuJi/GetContentCookie",{},function(n){if(n!=""){var t=Decrypt(n);$("#content").val(t);parseInt(t.length)-1e4>0?$("#fontlength").attr("style","color:orangered"):$("#fontlength").removeAttr("style");$("#fontlength").text(t.length)}})}function GetCategoryForWrite(){$("#ulcategory").html("");$.post("/WuJi/GetCategoryList",{type:1},function(n){var t=JSON.parse(n),r,i;if(t.status!=1){if(t.status==404){location.href="/WuJi/LoginUser?flag=relog";return}layer.closeAll("loading");layer.msg(t.msg)}else r=$.parseJSON(Decrypt(t.data)),i="",$.each(r,function(n,t){n==1&&(i+='<\/li><li class="divider"><\/li>');i+=' <li ><a href="javascript:;" id="'+t.token+'" categoryName="'+t.categoryName+"\" onclick='setCategory(this)'><p><div class='categoryListoColor' style='margin-right:10px;background-color: #"+t.colorHex+";'><\/div>"+t.categoryName+"<\/p><\/a><\/li>"}),categorytoken=r[0].token,$("#ulcategory").append(i)})}function setCategory(n){var t=$(n).attr("id");$("#categorytoken").val(t);$("#btnMyCategory").html($(n).attr("categoryName")+'<span class="caret"><\/span>')}function GetDiary(n){$.post("/WuJi/GetEditDiary",{keyValue:n},function(n){var s=Decrypt(n),i=JSON.parse(s),t,f,e,r,u,o;if(i.status!="1"){layer.msg(i.msg);setTimeout(function(){location.href="/WuJi/Index"},1e3);return}t=JSON.parse(Decrypt(i.data));f=t.content;$("#content").val(f);$("#pMore").text("确认修改");$("#tip_Show").text("编辑完成请点击下方‘确认修改’按钮完成修改。");$("#categorytoken").val(t.token);e='<span class="caret"><\/span>';$("#btnMyCategory").html(t.categoryName+e);r=[];u=[];$.each(t.MediaChildren,function(n,t){t.mediaType==1&&t.qiniuUrl==1&&(r.push(t.Qnurl),u.push({caption:n+1+"_wuji",key:t.id}))});o={uploadAsync:!1,uploadUrl:"/WuJi/PushImg",maxFileCount:20,validateInitialCount:!0,maxFileSize:2048,showUpload:!1,showRemove:!1,showBrowse:!1,browseOnZoneClick:!0,showClose:!1,allowedFileExtensions:["jpg","png","gif"],language:"zh",showUploadedThumbs:!0,dropZoneEnabled:!0,msgFilesTooMany:"选择上传的文件数量{n}，超过允许的最大数值{m}！",previewFileIcon:"<i class='glyphicon glyphicon-king'><\/i>",showCaption:!1,layoutTemplates:{actionUpload:""},initialPreview:r,initialPreviewAsData:!0,deleteUrl:"/WuJi/DeleteImg",initialPreviewConfig:u,overwriteInitial:!1};$("#input-1").fileinput(o);layer.closeAll("loading")})}function WriteMyDiarys(){if($.trim($("#content").val())==""){layer.msg("请输入日记内容");layer.closeAll("loading");return}var n=$("#input-1").fileinput("getFilesCount"),t=Encrypt($("#content").val()),i=$("#categorytoken").val(),r=$("#createDate").val(),u={content:t,categorytoken:i,imgCount:n,videoCount:0,createDate:r},f=Encrypt(JSON.stringify(u));$.post("/WuJi/WriteMyDiarys",{keyValue:f},function(t){var i=$.parseJSON(Decrypt(t));if(i.status==404){location.href="/WuJi/LoginUser?flag=relog";return}if(i.status!=1&&i.status!=404){layer.msg(i.msg);return}n>0?$("#input-1").fileinput("upload"):$.post("/WuJi/ClearContentCookie",{},function(n){n=="1"&&(layer.msg("记录完成，等待跳转",{time:3e3}),setTimeout(function(){toIndex()},2e3))})})}function EditMyDiary(){if($.trim($("#content").val())==""){layer.msg("请输入日记内容");return}var n=$("#input-1").fileinput("getFileStack").length,t=Encrypt($("#content").val()),i=$("#categorytoken").val(),r={token:keyValue,content:t,categorytoken:i,imgCount:n},u=Encrypt(JSON.stringify(r));$.post("/WuJi/EditMyDiarys",{keyValue:u},function(t){var i=$.parseJSON(Decrypt(t));i.status==404?location.href="/WuJi/LoginUser?flag=relog":i.status!=1&&i.status!=404?(layer.msg(i.msg),layer.closeAll("loading")):i.status==10?(layer.msg(i.msg),setTimeout(function(){toIndex()},2e3)):n>0?$("#input-1").fileinput("upload"):$.post("/WuJi/ClearContentCookie",{},function(n){n=="1"&&(layer.msg("记录完成，等待跳转",{time:3e3}),setTimeout(function(){toIndex()},2e3))})})}function toIndex(){location.href="/WuJi/Index"}$(function(){function n(n){var t;return window.event?t=n.keyCode:n.which&&(t=n.which),t==123?(window.close(),!1):void 0}$(document).keydown(function(){return n(arguments[0])})});$(function(){isvip==0?$("#inputImg").css("display","none"):$("#inputImg").css("display","inline");GetContent();NoInList();$("#menuDiv").click(function(){RunIndex()});GetCategoryForWrite();keyValue!="0"?(layer.load(2),GetDiary(keyValue)):$("#input-1").fileinput({uploadAsync:!1,uploadUrl:"/WuJi/PushImg",maxFileCount:20,validateInitialCount:!0,maxFileSize:2048,showUpload:!1,showRemove:!1,showBrowse:!1,browseOnZoneClick:!0,showClose:!1,allowedFileExtensions:["jpg","png","gif"],language:"zh",showUploadedThumbs:!0,dropZoneEnabled:!0,msgFilesTooMany:"选择上传的文件数量{n}，超过允许的最大数值{m}！",previewFileIcon:"<i class='glyphicon glyphicon-king'><\/i>",showCaption:!1,layoutTemplates:{actionUpload:""}});$("#loadMore").click(function(){layer.load(2);keyValue!="0"?EditMyDiary():WriteMyDiarys()});$("#input-1").on("fileselect",function(){var n=$("#input-1").fileinput("getFilesCount"),t=$("#input-1").fileinput("getFileStack").length;console.log(n);console.log(t)});$("#input-1").on("filebatchuploadsuccess",function(){$.post("/WuJi/ClearContentCookie",{},function(n){n=="1"&&(layer.msg("记录完成，等待跳转",{time:3e3}),setTimeout(function(){toIndex()},2e3))})});$("#content").keyup(function(){parseInt($("#content").val().length)-1e4>0?$("#fontlength").attr("style","color:orangered"):$("#fontlength").removeAttr("style");$("#fontlength").text($("#content").val().length)});$("#content").change(function(){var n=$("#content").val(),t;if(n.length-1e4>0){layer.msg("文字长度超出限制，请调整");return}t=Encrypt(n);$.post("/WuJi/SetContentCookie",{content:t},function(t){t=="1"&&$.trim(n)!=""&&layer.msg("已将文字保存到草稿。",{time:1e3})})})});!function(n){"use strict";"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof module&&module.exports?module.exports=n(require("jquery")):n(window.jQuery)}(function(n){"use strict";n.fn.fileinputLocales={};n.fn.fileinputThemes={};var t,i;t={FRAMES:".kv-preview-thumb",SORT_CSS:"file-sortable",STYLE_SETTING:'style="width:{width};height:{height};"',OBJECT_PARAMS:'<param name="controller" value="true" />\n<param name="allowFullScreen" value="true" />\n<param name="allowScriptAccess" value="always" />\n<param name="autoPlay" value="false" />\n<param name="autoStart" value="false" />\n<param name="quality" value="high" />\n',DEFAULT_PREVIEW:'<div class="file-preview-other">\n<span class="{previewFileIconClass}">{previewFileIcon}<\/span>\n<\/div>',MODAL_ID:"kvFileinputModal",MODAL_EVENTS:["show","shown","hide","hidden","loaded"],objUrl:window.URL||window.webkitURL,compare:function(n,t,i){return void 0!==n&&(i?n===t:n.match(t))},isIE:function(n){if("Microsoft Internet Explorer"!==navigator.appName)return!1;if(10===n)return new RegExp("msie\\s"+n,"i").test(navigator.userAgent);var i,t=document.createElement("div");return t.innerHTML="<!--[if IE "+n+"]> <i><\/i> <![endif]-->",i=t.getElementsByTagName("i").length,document.body.appendChild(t),t.parentNode.removeChild(t),i},initModal:function(t){var i=n("body");i.length&&t.appendTo(i)},isEmpty:function(t,i){return void 0===t||null===t||0===t.length||i&&""===n.trim(t)},isArray:function(n){return Array.isArray(n)||"[object Array]"===Object.prototype.toString.call(n)},ifSet:function(n,t,i){return i=i||"",t&&"object"==typeof t&&n in t?t[n]:i},cleanArray:function(n){return n instanceof Array||(n=[]),n.filter(function(n){return void 0!==n&&null!==n})},spliceArray:function(n,t){var i,r=0,u=[];if(!(n instanceof Array))return[];for(i=0;i<n.length;i++)i!==t&&(u[r]=n[i],r++);return u},getNum:function(n,t){return t=t||0,"number"==typeof n?n:("string"==typeof n&&(n=parseFloat(n)),isNaN(n)?t:n)},hasFileAPISupport:function(){return!(!window.File||!window.FileReader)},hasDragDropSupport:function(){var n=document.createElement("div");return!t.isIE(9)&&(void 0!==n.draggable||void 0!==n.ondragstart&&void 0!==n.ondrop)},hasFileUploadSupport:function(){return t.hasFileAPISupport()&&window.FormData},addCss:function(n,t){n.removeClass(t).addClass(t)},getElement:function(i,r,u){return t.isEmpty(i)||t.isEmpty(i[r])?u:n(i[r])},uniqId:function(){return Math.round((new Date).getTime()+100*Math.random())},htmlEncode:function(n){return n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;")},replaceTags:function(t,i){var r=t;return i?(n.each(i,function(n,t){"function"==typeof t&&(t=t());r=r.split(n).join(t)}),r):r},cleanMemory:function(n){var i=n.is("img")?n.attr("src"):n.find("source").attr("src");t.objUrl.revokeObjectURL(i)},findFileName:function(n){var t=n.lastIndexOf("/");return-1===t&&(t=n.lastIndexOf("\\")),n.split(n.substring(t,t+1)).pop()},checkFullScreen:function(){return document.fullscreenElement||document.mozFullScreenElement||document.webkitFullscreenElement||document.msFullscreenElement},toggleFullScreen:function(n){var i=document,r=i.documentElement;r&&n&&!t.checkFullScreen()?r.requestFullscreen?r.requestFullscreen():r.msRequestFullscreen?r.msRequestFullscreen():r.mozRequestFullScreen?r.mozRequestFullScreen():r.webkitRequestFullscreen&&r.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):i.exitFullscreen?i.exitFullscreen():i.msExitFullscreen?i.msExitFullscreen():i.mozCancelFullScreen?i.mozCancelFullScreen():i.webkitExitFullscreen&&i.webkitExitFullscreen()},moveArray:function(n,t,i){if(i>=n.length)for(var r=i-n.length;r--+1;)n.push(void 0);return n.splice(i,0,n.splice(t,1)[0]),n},cleanZoomCache:function(n){var t=n.closest(".kv-zoom-cache-theme");t.length||(t=n.closest(".kv-zoom-cache"));t.remove()}};i=function(i,r){var u=this;u.$element=n(i);u._validate()&&(u.isPreviewable=t.hasFileAPISupport(),u.isIE9=t.isIE(9),u.isIE10=t.isIE(10),u.isPreviewable||u.isIE9?(u._init(r),u._listen()):u.$element.removeClass("file-loading"))};i.prototype={constructor:i,_init:function(i){var f,e,r=this,u=r.$element;r.options=i;n.each(i,function(n,i){switch(n){case"minFileCount":case"maxFileCount":case"maxFileSize":r[n]=t.getNum(i);break;default:r[n]=i}});r.$form=u.closest("form");r._initTemplateDefaults();r.fileInputCleared=!1;r.fileBatchCompleted=!0;r.isPreviewable||(r.showPreview=!1);r.uploadFileAttr=t.isEmpty(u.attr("name"))?"file_data":u.attr("name");r.reader=null;r.formdata={};r.clearStack();r.uploadCount=0;r.uploadStatus={};r.uploadLog=[];r.uploadAsyncCount=0;r.loadedImages=[];r.totalImagesCount=0;r.ajaxRequests=[];r.isError=!1;r.ajaxAborted=!1;r.cancelling=!1;e=r._getLayoutTemplate("progress");r.progressTemplate=e.replace("{class}",r.progressClass);r.progressCompleteTemplate=e.replace("{class}",r.progressCompleteClass);r.progressErrorTemplate=e.replace("{class}",r.progressErrorClass);r.dropZoneEnabled=t.hasDragDropSupport()&&r.dropZoneEnabled;r.isDisabled=u.attr("disabled")||u.attr("readonly");r.isUploadable=t.hasFileUploadSupport()&&!t.isEmpty(r.uploadUrl);r.isClickable=r.browseOnZoneClick&&r.showPreview&&(r.isUploadable&&r.dropZoneEnabled||!t.isEmpty(r.defaultPreviewContent));r.slug="function"==typeof i.slugCallback?i.slugCallback:r._slugDefault;r.mainTemplate=r.showCaption?r._getLayoutTemplate("main1"):r._getLayoutTemplate("main2");r.captionTemplate=r._getLayoutTemplate("caption");r.previewGenericTemplate=r._getPreviewTemplate("generic");r.resizeImage&&(r.maxImageWidth||r.maxImageHeight)&&(r.imageCanvas=document.createElement("canvas"),r.imageCanvasContext=r.imageCanvas.getContext("2d"));t.isEmpty(u.attr("id"))&&u.attr("id",t.uniqId());r.namespace=".fileinput_"+u.attr("id").replace(/-/g,"_");void 0===r.$container?r.$container=r._createContainer():r._refreshContainer();f=r.$container;r.$dropZone=f.find(".file-drop-zone");r.$progress=f.find(".kv-upload-progress");r.$btnUpload=f.find(".fileinput-upload");r.$captionContainer=t.getElement(i,"elCaptionContainer",f.find(".file-caption"));r.$caption=t.getElement(i,"elCaptionText",f.find(".file-caption-name"));r.$previewContainer=t.getElement(i,"elPreviewContainer",f.find(".file-preview"));r.$preview=t.getElement(i,"elPreviewImage",f.find(".file-preview-thumbnails"));r.$previewStatus=t.getElement(i,"elPreviewStatus",f.find(".file-preview-status"));r.$errorContainer=t.getElement(i,"elErrorContainer",r.$previewContainer.find(".kv-fileinput-error"));t.isEmpty(r.msgErrorClass)||t.addCss(r.$errorContainer,r.msgErrorClass);r.$errorContainer.hide();r.previewInitId="preview-"+t.uniqId();r._initPreviewCache();r._initPreview(!0);r._initPreviewActions();r._setFileDropZoneTitle();u.removeClass("file-loading");u.attr("disabled")&&r.disable();r._initZoom()},_initTemplateDefaults:function(){var u,f,e,o,s,h,c,l,a,v,y,p,w,b,k,d,g,nt,tt,r,it,rt,ut,ft,et,ot,st,ht,ct,lt,at,vt,yt,pt,i=this;u='{preview}\n<div class="kv-upload-progress hide"><\/div>\n<div class="input-group {class}">\n   {caption}\n   <div class="input-group-btn">\n       {remove}\n       {cancel}\n       {upload}\n       {browse}\n   <\/div>\n<\/div>';f='{preview}\n<div class="kv-upload-progress hide"><\/div>\n{remove}\n{cancel}\n{upload}\n{browse}\n';e='<div class="file-preview {class}">\n    {close}    <div class="{dropClass}">\n    <div class="file-preview-thumbnails">\n    <\/div>\n    <div class="clearfix"><\/div>    <div class="file-preview-status text-center text-success"><\/div>\n    <div class="kv-fileinput-error"><\/div>\n    <\/div>\n<\/div>';s='<div class="close fileinput-remove">&times;<\/div>\n';o='<i class="glyphicon glyphicon-file kv-caption-icon"><\/i>';h='<div tabindex="500" class="form-control file-caption {class}">\n   <div class="file-caption-name"><\/div>\n<\/div>\n';c='<button type="{type}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}<\/button>';l='<a href="{href}" tabindex="500" title="{title}" class="{css}" {status}>{icon} {label}<\/a>';a='<div tabindex="500" class="{css}" {status}>{icon} {label}<\/div>';v='<div id="'+t.MODAL_ID+'" class="file-zoom-dialog modal fade" tabindex="-1" aria-labelledby="'+t.MODAL_ID+'Label"><\/div>';y='<div class="modal-dialog modal-lg" role="document">\n  <div class="modal-content">\n    <div class="modal-header">\n      <div class="kv-zoom-actions pull-right">{toggleheader}{fullscreen}{borderless}{close}<\/div>\n      <h3 class="modal-title">{heading} <small><span class="kv-zoom-title"><\/span><\/small><\/h3>\n    <\/div>\n    <div class="modal-body">\n      <div class="floating-buttons"><\/div>\n      <div class="kv-zoom-body file-zoom-content"><\/div>\n{prev} {next}\n    <\/div>\n  <\/div>\n<\/div>\n';p='<div class="progress">\n    <div class="{class}" role="progressbar" aria-valuenow="{percent}" aria-valuemin="0" aria-valuemax="100" style="width:{percent}%;">\n        {status}\n     <\/div>\n<\/div>';w=" <samp>({sizeText})<\/samp>";b='<div class="file-thumbnail-footer">\n    <div class="file-footer-caption" title="{caption}">{caption}<br>{size}<\/div>\n    {progress} {actions}\n<\/div>';k='<div class="file-upload-indicator" title="{indicatorTitle}">{indicator}<\/div>\n{drag}\n<div class="file-actions">\n    <div class="file-footer-buttons">\n        {upload} {delete} {zoom} {other}    <\/div>\n    <div class="clearfix"><\/div>\n<\/div>';d='<button type="button" class="kv-file-remove {removeClass}" title="{removeTitle}" {dataUrl}{dataKey}>{removeIcon}<\/button>\n';g='<button type="button" class="kv-file-upload {uploadClass}" title="{uploadTitle}">{uploadIcon}<\/button>';nt='<button type="button" class="kv-file-zoom {zoomClass}" title="{zoomTitle}">{zoomIcon}<\/button>';tt='<span class="file-drag-handle {dragClass}" title="{dragTitle}">{dragIcon}<\/span>';r='<div class="file-preview-frame {frameClass}" id="{previewId}" data-fileindex="{fileindex}" data-template="{template}"';it=r+'><div class="kv-file-content">\n';rt=r+' title="{caption}"><div class="kv-file-content">\n';ut="<\/div>{footer}\n<\/div>\n";ft="{content}\n";et='<div class="kv-preview-data file-preview-html" title="{caption}" '+t.STYLE_SETTING+">{data}<\/div>\n";ot='<img src="{data}" class="file-preview-image kv-preview-data" title="{caption}" alt="{caption}" '+t.STYLE_SETTING+">\n";st='<textarea class="kv-preview-data file-preview-text" title="{caption}" readonly '+t.STYLE_SETTING+">{data}<\/textarea>\n";ht='<video class="kv-preview-data file-preview-video" width="{width}" height="{height}" controls>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n<\/video>\n";ct='<div class="file-preview-audio"><audio class="kv-preview-data" controls>\n<source src="{data}" type="{type}">\n'+t.DEFAULT_PREVIEW+"\n<\/audio><\/div>\n";lt='<object class="kv-preview-data file-object" type="application/x-shockwave-flash" width="{width}" height="{height}" data="{data}">\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n<\/object>\n";at='<object class="kv-preview-data file-object" data="{data}" type="{type}" width="{width}" height="{height}">\n<param name="movie" value="{caption}" />\n'+t.OBJECT_PARAMS+" "+t.DEFAULT_PREVIEW+"\n<\/object>\n";vt='<embed class="kv-preview-data" src="{data}" width="{width}" height="{height}" type="application/pdf">\n';yt='<div class="kv-preview-data file-preview-other-frame">\n'+t.DEFAULT_PREVIEW+"\n<\/div>\n";pt='<div class="kv-zoom-cache" style="display:none">{zoomContent}<\/div>';i.defaults={layoutTemplates:{main1:u,main2:f,preview:e,close:s,fileIcon:o,caption:h,modalMain:v,modal:y,progress:p,size:w,footer:b,actions:k,actionDelete:d,actionUpload:g,actionZoom:nt,actionDrag:tt,btnDefault:c,btnLink:l,btnBrowse:a,zoomCache:pt},previewMarkupTags:{tagBefore1:it,tagBefore2:rt,tagAfter:ut},previewContentTemplates:{generic:ft,html:et,image:ot,text:st,video:ht,audio:ct,flash:lt,object:at,pdf:vt,other:yt},allowedPreviewTypes:["image","html","text","video","audio","flash","pdf","object"],previewTemplates:{},previewSettings:{image:{width:"auto",height:"160px"},html:{width:"213px",height:"160px"},text:{width:"213px",height:"160px"},video:{width:"213px",height:"160px"},audio:{width:"213px",height:"80px"},flash:{width:"213px",height:"160px"},object:{width:"160px",height:"auto"},pdf:{width:"160px",height:"160px"},other:{width:"160px",height:"160px"}},previewZoomSettings:{image:{width:"auto",height:"auto","max-width":"100%","max-height":"100%"},html:{width:"100%",height:"100%","min-height":"480px"},text:{width:"100%",height:"100%","min-height":"480px"},video:{width:"auto",height:"100%","max-width":"100%"},audio:{width:"100%",height:"30px"},flash:{width:"auto",height:"480px"},object:{width:"auto",height:"100%","min-height":"480px"},pdf:{width:"100%",height:"100%","min-height":"480px"},other:{width:"auto",height:"100%","min-height":"480px"}},fileTypeSettings:{image:function(n,i){return t.compare(n,"image.*")||t.compare(i,/\.(gif|png|jpe?g)$/i)},html:function(n,i){return t.compare(n,"text/html")||t.compare(i,/\.(htm|html)$/i)},text:function(n,i){return t.compare(n,"text.*")||t.compare(i,/\.(xml|javascript)$/i)||t.compare(i,/\.(txt|md|csv|nfo|ini|json|php|js|css)$/i)},video:function(n,i){return t.compare(n,"video.*")&&(t.compare(n,/(ogg|mp4|mp?g|mov|webm|3gp)$/i)||t.compare(i,/\.(og?|mp4|webm|mp?g|mov|3gp)$/i))},audio:function(n,i){return t.compare(n,"audio.*")&&(t.compare(i,/(ogg|mp3|mp?g|wav)$/i)||t.compare(i,/\.(og?|mp3|mp?g|wav)$/i))},flash:function(n,i){return t.compare(n,"application/x-shockwave-flash",!0)||t.compare(i,/\.(swf)$/i)},pdf:function(n,i){return t.compare(n,"application/pdf",!0)||t.compare(i,/\.(pdf)$/i)},object:function(){return!0},other:function(){return!0}},fileActionSettings:{showRemove:!0,showUpload:!0,showZoom:!0,showDrag:!0,removeIcon:'<i class="glyphicon glyphicon-trash text-danger"><\/i>',removeClass:"btn btn-xs btn-default",removeTitle:"Remove file",uploadIcon:'<i class="glyphicon glyphicon-upload text-info"><\/i>',uploadClass:"btn btn-xs btn-default",uploadTitle:"Upload file",zoomIcon:'<i class="glyphicon glyphicon-zoom-in"><\/i>',zoomClass:"btn btn-xs btn-default",zoomTitle:"View Details",dragIcon:'<i class="glyphicon glyphicon-menu-hamburger"><\/i>',dragClass:"text-info",dragTitle:"Move / Rearrange",dragSettings:{},indicatorNew:'<i class="glyphicon glyphicon-hand-down text-warning"><\/i>',indicatorSuccess:'<i class="glyphicon glyphicon-ok-sign text-success"><\/i>',indicatorError:'<i class="glyphicon glyphicon-exclamation-sign text-danger"><\/i>',indicatorLoading:'<i class="glyphicon glyphicon-hand-up text-muted"><\/i>',indicatorNewTitle:"Not uploaded yet",indicatorSuccessTitle:"Uploaded",indicatorErrorTitle:"Upload Error",indicatorLoadingTitle:"Uploading ..."}};n.each(i.defaults,function(t,r){return"allowedPreviewTypes"===t?void(void 0===i.allowedPreviewTypes&&(i.allowedPreviewTypes=r)):void(i[t]=n.extend(!0,{},r,i[t]))});i._initPreviewTemplates()},_initPreviewTemplates:function(){var r,i=this,f=i.defaults,u=i.previewMarkupTags,e=u.tagAfter;n.each(f.previewContentTemplates,function(n,f){t.isEmpty(i.previewTemplates[n])&&(r=u.tagBefore2,"generic"!==n&&"image"!==n&&"html"!==n&&"text"!==n||(r=u.tagBefore1),i.previewTemplates[n]=r+f+e)})},_initPreviewCache:function(){var i=this;i.previewCache={data:{},init:function(){var n=i.initialPreview;n.length>0&&!t.isArray(n)&&(n=n.split(i.initialPreviewDelimiter));i.previewCache.data={content:n,config:i.initialPreviewConfig,tags:i.initialPreviewThumbTags}},fetch:function(){return i.previewCache.data.content.filter(function(n){return null!==n})},count:function(n){return i.previewCache.data&&i.previewCache.data.content?n?i.previewCache.data.content.length:i.previewCache.fetch().length:0},get:function(r,u){var e,s,h,c,l,a,v,y="init_"+r,o=i.previewCache.data,f=o.config[r],p=o.content[r],w=i.previewInitId+"-"+y,k=t.ifSet("previewAsData",f,i.initialPreviewAsData),b=function(n,r,u,f,e,o,s,h,c){return h=" file-preview-initial "+t.SORT_CSS+(h?" "+h:""),i._generatePreviewTemplate(n,r,u,f,e,!1,null,h,o,s,c)};return p?(u=void 0===u?!0:u,h=t.ifSet("type",f,i.initialPreviewFileType||"generic"),l=t.ifSet("filename",f,t.ifSet("caption",f)),a=t.ifSet("filetype",f,h),c=i.previewCache.footer(r,u,f&&f.size||null),v=t.ifSet("frameClass",f),e=k?b(h,p,l,a,w,c,y,v):b("generic",p,l,a,w,c,y,v,h).replace(/\{content}/g,o.content[r]),o.tags.length&&o.tags[r]&&(e=t.replaceTags(e,o.tags[r])),t.isEmpty(f)||t.isEmpty(f.frameAttr)||(s=n(document.createElement("div")).html(e),s.find(".file-preview-initial").attr(f.frameAttr),e=s.html(),s.remove()),e):""},add:function(n,r,u,f){var o,e=i.previewCache.data;return t.isArray(n)||(n=n.split(i.initialPreviewDelimiter)),f?(o=e.content.push(n)-1,e.config[o]=r,e.tags[o]=u):(o=n.length-1,e.content=n,e.config=r,e.tags=u),i.previewCache.data=e,o},set:function(n,r,u,f){var e,s,o=i.previewCache.data;if(n&&n.length&&(t.isArray(n)||(n=n.split(i.initialPreviewDelimiter)),s=n.filter(function(n){return null!==n}),s.length)){if(void 0===o.content&&(o.content=[]),void 0===o.config&&(o.config=[]),void 0===o.tags&&(o.tags=[]),f){for(e=0;e<n.length;e++)n[e]&&o.content.push(n[e]);for(e=0;e<r.length;e++)r[e]&&o.config.push(r[e]);for(e=0;e<u.length;e++)u[e]&&o.tags.push(u[e])}else o.content=n,o.config=r,o.tags=u;i.previewCache.data=o}},unset:function(n){var t=i.previewCache.count();if(t){if(1===t)return i.previewCache.data.content=[],i.previewCache.data.config=[],i.previewCache.data.tags=[],i.initialPreview=[],i.initialPreviewConfig=[],void(i.initialPreviewThumbTags=[]);i.previewCache.data.content[n]=null;i.previewCache.data.config[n]=null;i.previewCache.data.tags[n]=null}},out:function(){var t,n,r="",u=i.previewCache.count(!0);if(0===u)return{content:"",caption:""};for(n=0;u>n;n++)r+=i.previewCache.get(n);return t=i._getMsgSelected(i.previewCache.count()),{content:r,caption:t}},footer:function(n,r,u){var e=i.previewCache.data;if(!e||!e.config||0===e.config.length||t.isEmpty(e.config[n]))return"";r=void 0===r?!0:r;var f=e.config[n],c=t.ifSet("caption",f),o="",l=t.ifSet("width",f,"auto"),s=t.ifSet("url",f,!1),a=t.ifSet("key",f,null),h=i.fileActionSettings,v=t.ifSet("showDelete",f,!0),y=t.ifSet("showZoom",f,h.showZoom),p=t.ifSet("showDrag",f,h.showDrag),w=s===!1&&r;return i.initialPreviewShowDelete&&(o=i._renderFileActions(!1,v,y,p,w,s,a,!0)),i._getLayoutTemplate("footer").replace(/\{progress}/g,i._renderThumbProgress()).replace(/\{actions}/g,o).replace(/\{caption}/g,c).replace(/\{size}/g,i._getSize(u)).replace(/\{width}/g,l).replace(/\{indicator}/g,"").replace(/\{indicatorTitle}/g,"")}};i.previewCache.init()},_handler:function(n,t,i){var f=this,r=f.namespace,u=t.split(" ").join(r+" ")+r;n&&n.length&&n.off(u).on(u,i)},_log:function(n){var i=this,t=i.$element.attr("id");t&&(n='"'+t+'": '+n);"undefined"!=typeof window.console.log?window.console.log(n):window.alert(n)},_validate:function(){var n=this,t="file"===n.$element.attr("type");return t||n._log('The input "type" must be set to "file" for initializing the "bootstrap-fileinput" plugin.'),t},_errorsExist:function(){var t,i=this;return i.$errorContainer.find("li").length?!0:(t=n(document.createElement("div")).html(i.$errorContainer.html()),t.find("span.kv-error-close").remove(),t.find("ul").remove(),!!n.trim(t.text()).length)},_errorHandler:function(n,t){var i=this,r=n.target.error;r.code===r.NOT_FOUND_ERR?i._showError(i.msgFileNotFound.replace("{name}",t)):r.code===r.SECURITY_ERR?i._showError(i.msgFileSecured.replace("{name}",t)):r.code===r.NOT_READABLE_ERR?i._showError(i.msgFileNotReadable.replace("{name}",t)):r.code===r.ABORT_ERR?i._showError(i.msgFilePreviewAborted.replace("{name}",t)):i._showError(i.msgFilePreviewError.replace("{name}",t))},_addError:function(n){var i=this,t=i.$errorContainer;n&&t.length&&(t.html(i.errorCloseButton+n),i._handler(t.find(".kv-error-close"),"click",function(){t.fadeOut("slow")}))},_resetErrors:function(n){var t=this,i=t.$errorContainer;t.isError=!1;t.$container.removeClass("has-error");i.html("");n?i.fadeOut("slow"):i.hide()},_showFolderError:function(n){var r,i=this,u=i.$errorContainer;n&&(r=i.msgFoldersNotAllowed.replace(/\{n}/g,n),i._addError(r),t.addCss(i.$container,"has-error"),u.fadeIn(800),i._raise("filefoldererror",[n,r]))},_showUploadError:function(n,i,r){var u=this,f=u.$errorContainer,o=r||"fileuploaderror",e=i&&i.id?'<li data-file-id="'+i.id+'">'+n+"<\/li>":"<li>"+n+"<\/li>";return 0===f.find("ul").length?u._addError("<ul>"+e+"<\/ul>"):f.find("ul").append(e),f.fadeIn(800),u._raise(o,[i,n]),u.$container.removeClass("file-input-new"),t.addCss(u.$container,"has-error"),!0},_showError:function(n,i,r){var u=this,f=u.$errorContainer,e=r||"fileerror";return i=i||{},i.reader=u.reader,u._addError(n),f.fadeIn(800),u._raise(e,[i,n]),u.isUploadable||u._clearFileInput(),u.$container.removeClass("file-input-new"),t.addCss(u.$container,"has-error"),u.$btnUpload.attr("disabled",!0),!0},_noFilesError:function(n){var i=this,u=i.minFileCount>1?i.filePlural:i.fileSingle,r=i.msgFilesTooLess.replace("{n}",i.minFileCount).replace("{files}",u),f=i.$errorContainer;i._addError(r);i.isError=!0;i._updateFileDetails(0);f.fadeIn(800);i._raise("fileerror",[n,r]);i._clearFileInput();t.addCss(i.$container,"has-error")},_parseError:function(t,i,r,u){var o=this,f=n.trim(r+""),s="."===f.slice(-1)?"":".",e=void 0!==i.responseJSON&&void 0!==i.responseJSON.error?i.responseJSON.error:i.responseText;return o.cancelling&&o.msgUploadAborted&&(f=o.msgUploadAborted),o.showAjaxErrorDetails&&e?(e=n.trim(e.replace(/\n\s*\n/g,"\n")),e=e.length>0?"<pre>"+e+"<\/pre>":"",f+=s+e):f+=s,f===s&&(f=o.msgAjaxError.replace("{operation}",t)),o.cancelling=!1,u?"<b>"+u+": <\/b>"+f:f},_parseFileType:function(n){for(var f,r,u,e=this,o=e.allowedPreviewTypes,i=0;i<o.length;i++)if(u=o[i],f=e.fileTypeSettings[u],r=f(n.type,n.name)?u:"",!t.isEmpty(r))return r;return"other"},_getPreviewIcon:function(t){var r,i=this,u=null;return t&&t.indexOf(".")>-1&&(r=t.split(".").pop(),i.previewFileIconSettings&&i.previewFileIconSettings[r]&&(u=i.previewFileIconSettings[r]),i.previewFileExtSettings&&n.each(i.previewFileExtSettings,function(n,t){i.previewFileIconSettings[n]&&t(r)})),u},_parseFilePreviewIcon:function(n,t){var i=this,r=i._getPreviewIcon(t)||i.previewFileIcon;return n.indexOf("{previewFileIcon}")>-1&&(n=n.replace(/\{previewFileIconClass}/g,i.previewFileIconClass).replace(/\{previewFileIcon}/g,r)),n},_raise:function(t,i){var u=this,r=n.Event(t);if(void 0!==i?u.$element.trigger(r,i):u.$element.trigger(r),r.isDefaultPrevented()||r.result===!1)return!1;switch(t){case"filebatchuploadcomplete":case"filebatchuploadsuccess":case"fileuploaded":case"fileclear":case"filecleared":case"filereset":case"fileerror":case"filefoldererror":case"fileuploaderror":case"filebatchuploaderror":case"filedeleteerror":case"filecustomerror":case"filesuccessremove":break;default:u.ajaxAborted=r.result}return!0},_listenFullScreen:function(n){var r,i,u=this,t=u.$modal;t&&t.length&&(r=t&&t.find(".btn-fullscreen"),i=t&&t.find(".btn-borderless"),r.length&&i.length&&(r.removeClass("active").attr("aria-pressed","false"),i.removeClass("active").attr("aria-pressed","false"),n?r.addClass("active").attr("aria-pressed","true"):i.addClass("active").attr("aria-pressed","true"),t.hasClass("file-zoom-fullscreen")?u._maximizeZoomDialog():n?u._maximizeZoomDialog():i.removeClass("active").attr("aria-pressed","false")))},_listen:function(){var r,i=this,e=i.$element,u=i.$form,f=i.$container;i._handler(e,"change",n.proxy(i._change,i));i.showBrowse&&i._handler(i.$btnFile,"click",n.proxy(i._browse,i));i._handler(f.find(".fileinput-remove:not([disabled])"),"click",n.proxy(i.clear,i));i._handler(f.find(".fileinput-cancel"),"click",n.proxy(i.cancel,i));i._initDragDrop();i._handler(u,"reset",n.proxy(i.reset,i));i.isUploadable||i._handler(u,"submit",n.proxy(i._submitForm,i));i._handler(i.$container.find(".fileinput-upload"),"click",n.proxy(i._uploadClick,i));i._handler(n(window),"resize",function(){i._listenFullScreen(screen.width===window.innerWidth&&screen.height===window.innerHeight)});r="webkitfullscreenchange mozfullscreenchange fullscreenchange MSFullscreenChange";i._handler(n(document),r,function(){i._listenFullScreen(t.checkFullScreen())});i._initClickable()},_initClickable:function(){var r,i=this;i.isClickable&&(r=i.isUploadable?i.$dropZone:i.$preview.find(".file-default-preview"),t.addCss(r,"clickable"),r.attr("tabindex",-1),i._handler(r,"click",function(t){var u=n(t.target);u.parents(".file-preview-thumbnails").length&&!u.parents(".file-default-preview").length||(i.$element.trigger("click"),r.blur())}))},_initDragDrop:function(){var t=this,i=t.$dropZone;t.isUploadable&&t.dropZoneEnabled&&t.showPreview&&(t._handler(i,"dragenter dragover",n.proxy(t._zoneDragEnter,t)),t._handler(i,"dragleave",n.proxy(t._zoneDragLeave,t)),t._handler(i,"drop",n.proxy(t._zoneDrop,t)),t._handler(n(document),"dragenter dragover drop",t._zoneDragDropInit))},_zoneDragDropInit:function(n){n.stopPropagation();n.preventDefault()},_zoneDragEnter:function(i){var r=this,u=n.inArray("Files",i.originalEvent.dataTransfer.types)>-1;return r._zoneDragDropInit(i),r.isDisabled||!u?(i.originalEvent.dataTransfer.effectAllowed="none",void(i.originalEvent.dataTransfer.dropEffect="none")):void t.addCss(r.$dropZone,"file-highlighted")},_zoneDragLeave:function(n){var t=this;t._zoneDragDropInit(n);t.isDisabled||t.$dropZone.removeClass("file-highlighted")},_zoneDrop:function(n){var i=this;n.preventDefault();i.isDisabled||t.isEmpty(n.originalEvent.dataTransfer.files)||(i._change(n,"dragdrop"),i.$dropZone.removeClass("file-highlighted"))},_uploadClick:function(n){var r,u=this,i=u.$container.find(".fileinput-upload"),f=!i.hasClass("disabled")&&t.isEmpty(i.attr("disabled"));if(!n||!n.isDefaultPrevented()){if(!u.isUploadable)return void(f&&"submit"!==i.attr("type")&&(r=i.closest("form"),r.length&&r.trigger("submit"),n.preventDefault()));n.preventDefault();f&&u.upload()}},_submitForm:function(){var n=this,i=n.$element,t=i.get(0).files;return t&&n.minFileCount>0&&n._getFileCount(t.length)<n.minFileCount?(n._noFilesError({}),!1):!n._abort({})},_clearPreview:function(){var i=this,r=i.$preview,u=i.showUploadedThumbs?r.find(t.FRAMES+":not(.file-preview-success)"):r.find(t.FRAMES);u.each(function(){var i=n(this);i.remove();t.cleanZoomCache(r.find("#zoom-"+i.attr("id")))});i.$preview.find(t.FRAMES).length&&i.showPreview||i._resetUpload();i._validateDefaultPreview()},_initSortable:function(){var u,i=this,r=i.$preview,f="."+t.SORT_CSS;window.KvSortable&&0!==r.find(f).length&&(u={handle:".drag-handle-init",dataIdAttr:"data-preview-id",draggable:f,onSort:function(r){var o,s,f=r.oldIndex,e=r.newIndex,u;for(i.initialPreview=t.moveArray(i.initialPreview,f,e),i.initialPreviewConfig=t.moveArray(i.initialPreviewConfig,f,e),i.previewCache.init(),u=0;u<i.initialPreviewConfig.length;u++)null!==i.initialPreviewConfig[u]&&(o=i.initialPreviewConfig[u].key,s=n(".kv-file-remove[data-key='"+o+"']").closest(t.FRAMES),s.attr("data-fileindex","init_"+u).data("fileindex","init_"+u));i._raise("filesorted",{previewId:n(r.item).attr("id"),oldIndex:f,newIndex:e,stack:i.initialPreviewConfig})}},r.data("kvsortable")&&r.kvsortable("destroy"),n.extend(!0,u,i.fileActionSettings.dragSettings),r.kvsortable(u))},_initPreview:function(n){var r,i=this,u=i.initialCaption||"";return i.previewCache.count()?(r=i.previewCache.out(),u=n&&i.initialCaption?i.initialCaption:r.caption,i.$preview.html(r.content),i._setInitThumbAttr(),i._setCaption(u),i._initSortable(),void(t.isEmpty(r.content)||i.$container.removeClass("file-input-new"))):(i._clearPreview(),void(n?i._setCaption(u):i._initCaption()))},_getZoomButton:function(n){var t=this,r=t.previewZoomButtonIcons[n],u=t.previewZoomButtonClasses[n],f=' title="'+(t.previewZoomButtonTitles[n]||"")+'" ',i=f+("close"===n?' data-dismiss="modal" aria-hidden="true"':"");return"fullscreen"!==n&&"borderless"!==n&&"toggleheader"!==n||(i+=' data-toggle="button" aria-pressed="false" autocomplete="off"'),'<button type="button" class="'+u+" btn-"+n+'"'+i+">"+r+"<\/button>"},_getModalContent:function(){var n=this;return n._getLayoutTemplate("modal").replace(/\{heading}/g,n.msgZoomModalHeading).replace(/\{prev}/g,n._getZoomButton("prev")).replace(/\{next}/g,n._getZoomButton("next")).replace(/\{toggleheader}/g,n._getZoomButton("toggleheader")).replace(/\{fullscreen}/g,n._getZoomButton("fullscreen")).replace(/\{borderless}/g,n._getZoomButton("borderless")).replace(/\{close}/g,n._getZoomButton("close"))},_listenModalEvent:function(n){var r=this,i=r.$modal,u=function(n){return{sourceEvent:n,previewId:i.data("previewId"),modal:i}};i.on(n+".bs.modal",function(f){var e=i.find(".btn-fullscreen"),o=i.find(".btn-borderless");r._raise("filezoom"+n,u(f));"shown"===n&&(o.removeClass("active").attr("aria-pressed","false"),e.removeClass("active").attr("aria-pressed","false"),i.hasClass("file-zoom-fullscreen")&&(r._maximizeZoomDialog(),t.checkFullScreen()?e.addClass("active").attr("aria-pressed","true"):o.addClass("active").attr("aria-pressed","true")))})},_initZoom:function(){var r,i=this,u=i._getLayoutTemplate("modalMain"),f="#"+t.MODAL_ID;i.showPreview&&(i.$modal=n(f),i.$modal&&i.$modal.length||(r=n(document.createElement("div")).html(u).insertAfter(i.$container),i.$modal=n("#"+t.MODAL_ID).insertBefore(r),r.remove()),t.initModal(i.$modal),i.$modal.html(i._getModalContent()),n.each(t.MODAL_EVENTS,function(n,t){i._listenModalEvent(t)}))},_initZoomButtons:function(){var e,o,i=this,s=i.$modal.data("previewId")||"",c=i.$preview,r=c.find(t.FRAMES).toArray(),h=r.length,u=i.$modal.find(".btn-prev"),f=i.$modal.find(".btn-next");return r.length<2?(u.hide(),void f.hide()):(u.show(),f.show(),void(h&&(e=n(r[0]),o=n(r[h-1]),u.removeAttr("disabled"),f.removeAttr("disabled"),e.length&&e.attr("id")===s&&u.attr("disabled",!0),o.length&&o.attr("id")===s&&f.attr("disabled",!0))))},_maximizeZoomDialog:function(){var o=this,t=o.$modal,u=t.find(".modal-header:visible"),f=t.find(".modal-footer:visible"),i=t.find(".modal-body"),r=n(window).height(),e=0;t.addClass("file-zoom-fullscreen");u&&u.length&&(r-=u.outerHeight(!0));f&&f.length&&(r-=f.outerHeight(!0));i&&i.length&&(e=i.outerHeight(!0)-i.height(),r-=e);t.find(".kv-zoom-body").height(r)},_resizeZoomDialog:function(n){var r=this,i=r.$modal,u=i.find(".btn-fullscreen"),f=i.find(".btn-borderless");if(i.hasClass("file-zoom-fullscreen"))t.toggleFullScreen(!1),n?u.hasClass("active")||(i.removeClass("file-zoom-fullscreen"),r._resizeZoomDialog(!0),f.hasClass("active")&&f.removeClass("active").attr("aria-pressed","false")):u.hasClass("active")?u.removeClass("active").attr("aria-pressed","false"):(i.removeClass("file-zoom-fullscreen"),r.$modal.find(".kv-zoom-body").css("height",r.zoomModalHeight));else{if(!n)return void r._maximizeZoomDialog();t.toggleFullScreen(!0)}i.focus()},_setZoomContent:function(i,r){var h,v,c,y,e,o,l,a,p,w,u=this,s=i.attr("id"),f=u.$modal,b=f.find(".btn-prev"),k=f.find(".btn-next"),g=f.find(".btn-fullscreen"),nt=f.find(".btn-borderless"),tt=f.find(".btn-toggleheader"),d=u.$preview.find("#zoom-"+s);v=d.attr("data-template")||"generic";h=d.find(".kv-file-content");c=h.length?h.html():"";p=i.data("caption")||"";w=i.data("size")||"";y=p+" "+w;f.find(".kv-zoom-title").html(y);e=f.find(".kv-zoom-body");f.removeClass("kv-single-content");r?(a=e.clone().insertAfter(e),e.html(c).hide(),a.fadeOut("fast",function(){e.fadeIn("fast");a.remove()})):e.html(c);l=u.previewZoomSettings[v];l&&(o=e.find(".kv-preview-data"),t.addCss(o,"file-zoom-detail"),n.each(l,function(n,t){o.css(n,t);(o.attr("width")&&"width"===n||o.attr("height")&&"height"===n)&&o.removeAttr(n)}));f.data("previewId",s);u._handler(b,"click",function(){u._zoomSlideShow("prev",s)});u._handler(k,"click",function(){u._zoomSlideShow("next",s)});u._handler(g,"click",function(){u._resizeZoomDialog(!0)});u._handler(nt,"click",function(){u._resizeZoomDialog(!1)});u._handler(tt,"click",function(){var t,n=f.find(".modal-header"),i=f.find(".modal-body .floating-buttons"),r=n.find(".kv-zoom-actions"),e=function(t){var r=u.$modal.find(".kv-zoom-body"),i=u.zoomModalHeight;f.hasClass("file-zoom-fullscreen")&&(i=r.outerHeight(!0),t||(i-=n.outerHeight(!0)));r.css("height",t?i+t:i)};n.is(":visible")?(t=n.outerHeight(!0),n.slideUp("slow",function(){r.find(".btn").appendTo(i);e(t)})):(i.find(".btn").appendTo(r),n.slideDown("slow",function(){e()}));f.focus()});u._handler(f,"keydown",function(n){var t=n.which||n.keyCode;37!==t||b.attr("disabled")||u._zoomSlideShow("prev",s);39!==t||k.attr("disabled")||u._zoomSlideShow("next",s)})},_zoomPreview:function(n){var u,i=this,r=i.$modal;if(!n.length)throw"Cannot zoom to detailed preview!";t.initModal(r);r.html(i._getModalContent());u=n.closest(t.FRAMES);i._setZoomContent(u);r.modal("show");i._initZoomButtons()},_zoomSlideShow:function(i,r){var s,u,e,f=this,c=f.$modal.find(".kv-zoom-actions .btn-"+i),o=f.$preview.find(t.FRAMES).toArray(),h=o.length;if(!c.attr("disabled")){for(u=0;h>u;u++)if(n(o[u]).attr("id")===r){e="prev"===i?u-1:u+1;break}0>e||e>=h||!o[e]||(s=n(o[e]),s.length&&f._setZoomContent(s,!0),f._initZoomButtons(),f._raise("filezoom"+i,{previewId:r,modal:f.$modal}))}},_initZoomButton:function(){var t=this;t.$preview.find(".kv-file-zoom").each(function(){var i=n(this);t._handler(i,"click",function(){t._zoomPreview(i)})})},_clearObjects:function(t){t.find("video audio").each(function(){this.pause();n(this).remove()});t.find("img object div").each(function(){n(this).remove()})},_clearFileInput:function(){var e,r,u,f=this,i=f.$element;f.fileInputCleared=!0;t.isEmpty(i.val())||(f.isIE9||f.isIE10?(e=i.closest("form"),r=n(document.createElement("form")),u=n(document.createElement("div")),i.before(u),e.length?e.after(r):u.after(r),r.append(i).trigger("reset"),u.before(i).remove(),r.remove()):i.val(""))},_resetUpload:function(){var n=this;n.uploadCache={content:[],config:[],tags:[],append:!0};n.uploadCount=0;n.uploadStatus={};n.uploadLog=[];n.uploadAsyncCount=0;n.loadedImages=[];n.totalImagesCount=0;n.$btnUpload.removeAttr("disabled");n._setProgress(0);t.addCss(n.$progress,"hide");n._resetErrors(!1);n.ajaxAborted=!1;n.ajaxRequests=[];n._resetCanvas();n.cacheInitialPreview={};n.overwriteInitial&&(n.initialPreview=[],n.initialPreviewConfig=[],n.initialPreviewThumbTags=[],n.previewCache.data={content:[],config:[],tags:[]})},_resetCanvas:function(){var n=this;n.canvas&&n.imageCanvasContext&&n.imageCanvasContext.clearRect(0,0,n.canvas.width,n.canvas.height)},_hasInitialPreview:function(){var n=this;return!n.overwriteInitial&&n.previewCache.count()},_resetPreview:function(){var t,i,n=this;n.previewCache.count()?(t=n.previewCache.out(),n.$preview.html(t.content),n._setInitThumbAttr(),i=n.initialCaption?n.initialCaption:t.caption,n._setCaption(i)):(n._clearPreview(),n._initCaption());n.showPreview&&(n._initZoom(),n._initSortable())},_clearDefaultPreview:function(){var n=this;n.$preview.find(".file-default-preview").remove()},_validateDefaultPreview:function(){var n=this;n.showPreview&&!t.isEmpty(n.defaultPreviewContent)&&(n.$preview.html('<div class="file-default-preview">'+n.defaultPreviewContent+"<\/div>"),n.$container.removeClass("file-input-new"),n._initClickable())},_resetPreviewThumbs:function(n){var i,t=this;return n?(t._clearPreview(),void t.clearStack()):void(t._hasInitialPreview()?(i=t.previewCache.out(),t.$preview.html(i.content),t._setInitThumbAttr(),t._setCaption(i.caption),t._initPreviewActions()):t._clearPreview())},_getLayoutTemplate:function(n){var i=this,r=i.layoutTemplates[n];return t.isEmpty(i.customLayoutTags)?r:t.replaceTags(r,i.customLayoutTags)},_getPreviewTemplate:function(n){var i=this,r=i.previewTemplates[n];return t.isEmpty(i.customPreviewTags)?r:t.replaceTags(r,i.customPreviewTags)},_getOutData:function(n,t,i){var r=this;return n=n||{},t=t||{},i=i||r.filestack.slice(0)||{},{form:r.formdata,files:i,filenames:r.filenames,filescount:r.getFilesCount(),extra:r._getExtraData(),response:t,reader:r.reader,jqXHR:n}},_getMsgSelected:function(n){var t=this,i=1===n?t.fileSingle:t.filePlural;return n>0?t.msgSelected.replace("{n}",n).replace("{files}",i):t.msgNoFilesSelected},_getThumbs:function(n){return n=n||"",this.$preview.find(t.FRAMES+":not(.file-preview-initial)"+n)},_getExtraData:function(n,t){var i=this,r=i.uploadExtraData;return"function"==typeof i.uploadExtraData&&(r=i.uploadExtraData(n,t)),r},_initXhr:function(n,t,i){var r=this;return n.upload&&n.upload.addEventListener("progress",function(n){var u=0,f=n.total,e=n.loaded||n.position;n.lengthComputable&&(u=Math.floor(e/f*100));t?r._setAsyncUploadStatus(t,u,i):r._setProgress(u)},!1),n},_ajaxSubmit:function(t,i,r,u,f,e){var s,o=this;o._raise("filepreajax",[f,e])&&(o._uploadExtra(f,e),s=n.extend(!0,{},{xhr:function(){var t=n.ajaxSettings.xhr();return o._initXhr(t,f,o.getFileStack().length)},url:o.uploadUrl,type:"POST",dataType:"json",data:o.formdata,cache:!1,processData:!1,contentType:!1,beforeSend:t,success:i,complete:r,error:u},o.ajaxSettings),o.ajaxRequests.push(n.ajax(s)))},_mergeArray:function(n,i){var r=this,u=t.cleanArray(r[n]),f=t.cleanArray(i);r[n]=u.concat(f)},_initUploadSuccess:function(i,r,u){var h,v,y,c,l,e,o,s,a,f=this;f.showPreview&&"object"==typeof i&&!n.isEmptyObject(i)&&void 0!==i.initialPreview&&i.initialPreview.length>0&&(f.hasInitData=!0,e=i.initialPreview||[],o=i.initialPreviewConfig||[],s=i.initialPreviewThumbTags||[],h=!(void 0!==i.append&&!i.append),e.length>0&&!t.isArray(e)&&(e=e.split(f.initialPreviewDelimiter)),f._mergeArray("initialPreview",e),f._mergeArray("initialPreviewConfig",o),f._mergeArray("initialPreviewThumbTags",s),void 0!==r?u?(a=r.attr("data-fileindex"),f.uploadCache.content[a]=e[0],f.uploadCache.config[a]=o[0]||[],f.uploadCache.tags[a]=s[0]||[],f.uploadCache.append=h):(y=f.previewCache.add(e,o[0],s[0],h),v=f.previewCache.get(y,!1),c=n(document.createElement("div")).html(v).hide().insertAfter(r),l=c.find(".kv-zoom-cache"),l&&l.length&&l.insertAfter(r),r.fadeOut("slow",function(){var n=c.find(".file-preview-frame");n&&n.length&&n.insertBefore(r).fadeIn("slow").css("display:inline-block");f._initPreviewActions();f._clearFileInput();t.cleanZoomCache(f.$preview.find("#zoom-"+r.attr("id")));r.remove();c.remove();f._initSortable()})):(f.previewCache.set(e,o,s,h),f._initPreview(),f._initPreviewActions()))},_initSuccessThumbs:function(){var i=this;i.showPreview&&i._getThumbs(t.FRAMES+".file-preview-success").each(function(){var r=n(this),u=i.$preview,f=r.find(".kv-file-remove");f.removeAttr("disabled");i._handler(f,"click",function(){var n=r.attr("id"),f=i._raise("filesuccessremove",[n,r.data("fileindex")]);t.cleanMemory(r);f!==!1&&r.fadeOut("slow",function(){t.cleanZoomCache(u.find("#zoom-"+n));r.remove();u.find(t.FRAMES).length||i.reset()})})})},_checkAsyncComplete:function(){for(var r,t=this,i=0;i<t.filestack.length;i++)if(t.filestack[i]&&(r=t.previewInitId+"-"+i,-1===n.inArray(r,t.uploadLog)))return!1;return t.uploadAsyncCount===t.uploadLog.length},_uploadExtra:function(t,i){var r=this,u=r._getExtraData(t,i);0!==u.length&&n.each(u,function(n,t){r.formdata.append(n,t)})},_uploadSingle:function(i,r,u){var h,e,p,c,a,w,b,k,d,l,f=this,g=f.getFileStack().length,v=new FormData,o=f.previewInitId+"-"+i,nt=f.filestack.length>0||!n.isEmptyObject(f.uploadExtraData),y=n("#"+o).find(".file-thumb-progress"),s={id:o,index:i};f.formdata=v;f.showPreview&&(e=n("#"+o+":not(.file-preview-initial)"),c=e.find(".kv-file-upload"),a=e.find(".kv-file-remove"),y.removeClass("hide"));0===g||!nt||c&&c.hasClass("disabled")||f._abort(s)||(l=function(n,t){f.updateStack(n,void 0);f.uploadLog.push(t);f._checkAsyncComplete()&&(f.fileBatchCompleted=!0)},p=function(){var e,r,u,n=f.uploadCache,o=0,i=f.cacheInitialPreview;f.fileBatchCompleted&&(i&&i.content&&(o=i.content.length),setTimeout(function(){if(f.showPreview){if(f.previewCache.set(n.content,n.config,n.tags,n.append),o){for(r=0;r<n.content.length;r++)u=r+o,i.content[u]=n.content[r],i.config.length&&(i.config[u]=n.config[r]),i.tags.length&&(i.tags[u]=n.tags[r]);f.initialPreview=t.cleanArray(i.content);f.initialPreviewConfig=t.cleanArray(i.config);f.initialPreviewThumbTags=t.cleanArray(i.tags)}else f.initialPreview=n.content,f.initialPreviewConfig=n.config,f.initialPreviewThumbTags=n.tags;f.cacheInitialPreview={};f.hasInitData&&(f._initPreview(),f._initPreviewActions())}f.unlock();f._clearFileInput();e=f.$preview.find(".file-preview-initial");f.uploadAsync&&e.length&&(t.addCss(e,t.SORT_CSS),f._initSortable());f._raise("filebatchuploadcomplete",[f.filestack,f._getExtraData()]);f.uploadCount=0;f.uploadStatus={};f.uploadLog=[];f._setProgress(101)},100))},w=function(r){h=f._getOutData(r);f.fileBatchCompleted=!1;f.showPreview&&(e.hasClass("file-preview-success")||(f._setThumbStatus(e,"Loading"),t.addCss(e,"file-uploading")),c.attr("disabled",!0),a.attr("disabled",!0));u||f.lock();f._raise("filepreupload",[h,o,i]);n.extend(!0,s,h);f._abort(s)&&(r.abort(),f._setProgressCancelled())},b=function(r,a,v){var p=f.showPreview&&e.attr("id")?e.attr("id"):o;h=f._getOutData(v,r);n.extend(!0,s,h);setTimeout(function(){t.isEmpty(r)||t.isEmpty(r.error)?(f.showPreview&&(f._setThumbStatus(e,"Success"),c.hide(),f._initUploadSuccess(r,e,u),f._setProgress(101,y)),f._raise("fileuploaded",[h,p,i]),u?l(i,p):f.updateStack(i,void 0)):(f._showUploadError(r.error,s),f._setPreviewError(e,i),u&&l(i,p))},100)},k=function(){setTimeout(function(){f.showPreview&&(c.removeAttr("disabled"),a.removeAttr("disabled"),e.removeClass("file-uploading"));u?p():(f.unlock(!1),f._clearFileInput());f._initSuccessThumbs()},100)},d=function(t,h,c){var a=f.ajaxOperations.uploadThumb,v=f._parseError(a,t,c,u?r[i].name:null);setTimeout(function(){u&&l(i,o);f.uploadStatus[o]=100;f._setPreviewError(e,i);n.extend(!0,s,f._getOutData(t));f._setProgress(101,y,f.msgAjaxProgressError.replace("{operation}",a));f._showUploadError(v,s)},100)},v.append(f.uploadFileAttr,r[i],f.filenames[i]),v.append("file_id",i),f._ajaxSubmit(w,b,k,d,o,i))},_uploadBatch:function(){var u,f,e,o,s,i=this,r=i.filestack,h=r.length,c=i.filestack.length>0||!n.isEmptyObject(i.uploadExtraData);i.formdata=new FormData;0!==h&&c&&!i._abort({})&&(s=function(){n.each(r,function(n){i.updateStack(n,void 0)});i._clearFileInput()},u=function(r){i.lock();var u=i._getOutData(r);i.showPreview&&i._getThumbs().each(function(){var r=n(this),u=r.find(".kv-file-upload"),f=r.find(".kv-file-remove");r.hasClass("file-preview-success")||(i._setThumbStatus(r,"Loading"),t.addCss(r,"file-uploading"));u.attr("disabled",!0);f.attr("disabled",!0)});i._raise("filebatchpreupload",[u]);i._abort(u)&&(r.abort(),i._setProgressCancelled())},f=function(r,u,f){var o=i._getOutData(f,r),h=i._getThumbs(":not(.file-preview-error)"),e=0,c=t.isEmpty(r)||t.isEmpty(r.errorkeys)?[]:r.errorkeys;t.isEmpty(r)||t.isEmpty(r.error)?(i._raise("filebatchuploadsuccess",[o]),s(),i.showPreview?(h.each(function(){var t=n(this),r=t.find(".kv-file-upload");t.find(".kv-file-upload").hide();i._setThumbStatus(t,"Success");t.removeClass("file-uploading");r.removeAttr("disabled")}),i._initUploadSuccess(r)):i.reset(),i._setProgress(101)):(i.showPreview&&(h.each(function(){var t=n(this),r=t.find(".kv-file-remove"),u=t.find(".kv-file-upload");return t.removeClass("file-uploading"),u.removeAttr("disabled"),r.removeAttr("disabled"),0===c.length?void i._setPreviewError(t):(-1!==n.inArray(e,c)?i._setPreviewError(t):(t.find(".kv-file-upload").hide(),i._setThumbStatus(t,"Success"),i.updateStack(e,void 0)),void e++)}),i._initUploadSuccess(r)),i._showUploadError(r.error,o,"filebatchuploaderror"))},o=function(){i.unlock();i._initSuccessThumbs();i._clearFileInput();i._raise("filebatchuploadcomplete",[i.filestack,i._getExtraData()])},e=function(t,r,u){var e=i._getOutData(t),f=i.ajaxOperations.uploadBatch,o=i._parseError(f,t,u);i._showUploadError(o,e,"filebatchuploaderror");i.uploadFileCount=h-1;i.showPreview&&(i._getThumbs().each(function(){var t=n(this),r=t.attr("data-fileindex");t.removeClass("file-uploading");void 0!==i.filestack[r]&&i._setPreviewError(t)}),i._getThumbs().removeClass("file-uploading"),i._getThumbs(" .kv-file-upload").removeAttr("disabled"),i._getThumbs(" .kv-file-delete").removeAttr("disabled"),i._setProgress(101,i.$progress,i.msgAjaxProgressError.replace("{operation}",f)))},n.each(r,function(n,u){t.isEmpty(r[n])||i.formdata.append(i.uploadFileAttr,u,i.filenames[n])}),i._ajaxSubmit(u,f,o,e))},_uploadExtraOnly:function(){var r,u,f,e,n=this,i={};n.formdata=new FormData;n._abort(i)||(r=function(t){n.lock();var r=n._getOutData(t);n._raise("filebatchpreupload",[r]);n._setProgress(50);i.data=r;i.xhr=t;n._abort(i)&&(t.abort(),n._setProgressCancelled())},u=function(i,r,u){var f=n._getOutData(u,i);t.isEmpty(i)||t.isEmpty(i.error)?(n._raise("filebatchuploadsuccess",[f]),n._clearFileInput(),n._initUploadSuccess(i),n._setProgress(101)):n._showUploadError(i.error,f,"filebatchuploaderror")},f=function(){n.unlock();n._clearFileInput();n._raise("filebatchuploadcomplete",[n.filestack,n._getExtraData()])},e=function(t,r,u){var f=n._getOutData(t),e=n.ajaxOperations.uploadExtra,o=n._parseError(e,t,u);i.data=f;n._showUploadError(o,f,"filebatchuploaderror");n._setProgress(101,n.$progress,n.msgAjaxProgressError.replace("{operation}",e))},n._ajaxSubmit(r,u,f,e))},_deleteFileIndex:function(i){var r=this,u=i.attr("data-fileindex");"init_"===u.substring(0,5)&&(u=parseInt(u.replace("init_","")),r.initialPreview=t.spliceArray(r.initialPreview,u),r.initialPreviewConfig=t.spliceArray(r.initialPreviewConfig,u),r.initialPreviewThumbTags=t.spliceArray(r.initialPreviewThumbTags,u),r.$preview.find(t.FRAMES).each(function(){var i=n(this),t=i.attr("data-fileindex");"init_"===t.substring(0,5)&&(t=parseInt(t.replace("init_","")),t>u&&(t--,i.attr("data-fileindex","init_"+t)))}),r.uploadAsync&&(r.cacheInitialPreview=r.getPreview()))},_initFileActions:function(){var i=this,r=i.$preview;i.showPreview&&(i._initZoomButton(),r.find(t.FRAMES+" .kv-file-remove").each(function(){var s,e,h,c,l=n(this),u=l.closest(t.FRAMES),f=u.attr("id"),o=u.attr("data-fileindex");i._handler(l,"click",function(){return c=i._raise("filepreremove",[f,o]),c!==!1&&i._validateMinCount()?(s=u.hasClass("file-preview-error"),t.cleanMemory(u),void u.fadeOut("slow",function(){t.cleanZoomCache(r.find("#zoom-"+f));i.updateStack(o,void 0);i._clearObjects(u);u.remove();f&&s&&i.$errorContainer.find('li[data-file-id="'+f+'"]').fadeOut("fast",function(){n(this).remove();i._errorsExist()||i._resetErrors()});i._clearFileInput();var c=i.getFileStack(!0),l=i.previewCache.count(),a=c.length,v=i.showPreview&&r.find(t.FRAMES).length;0!==a||0!==l||v?(e=l+a,h=e>1?i._getMsgSelected(e):c[0]?i._getFileNames()[0]:"",i._setCaption(h)):i.reset();i._raise("fileremoved",[f,o])})):!1})}),i.$preview.find(t.FRAMES+" .kv-file-upload").each(function(){var r=n(this);i._handler(r,"click",function(){var n=r.closest(t.FRAMES),u=n.attr("data-fileindex");n.hasClass("file-preview-error")||i._uploadSingle(u,i.filestack,!1)})}))},_initPreviewActions:function(){var i=this,r=i.$preview,e=i.deleteExtraData||{},f=t.FRAMES+" .kv-file-remove",u=function(){var n=i.isUploadable?i.previewCache.count():i.$element.get(0).files.length;0!==r.find(f).length||n||(i.reset(),i.initialCaption="")};i._initZoomButton();r.find(f).each(function(){var s=n(this),y=s.data("url")||i.deleteUrl,l=s.data("key");if(!t.isEmpty(y)&&void 0!==l){var p,h,a,o,f=s.closest(t.FRAMES),v=i.previewCache.data,c=f.data("fileindex");c=parseInt(c.replace("init_",""));a=t.isEmpty(v.config)&&t.isEmpty(v.config[c])?null:v.config[c];o=t.isEmpty(a)||t.isEmpty(a.extra)?e:a.extra;"function"==typeof o&&(o=o());h={id:s.attr("id"),key:l,extra:o};p=n.extend(!0,{},{url:y,type:"POST",dataType:"json",data:n.extend(!0,{},{key:l},o),beforeSend:function(n){i.ajaxAborted=!1;i._raise("filepredelete",[l,n,o]);i.ajaxAborted?n.abort():(t.addCss(f,"file-uploading"),t.addCss(s,"disabled"))},success:function(n,e,a){var v,y;return t.isEmpty(n)||t.isEmpty(n.error)?(i.previewCache.init(),c=parseInt(f.data("fileindex").replace("init_","")),i.previewCache.unset(c),v=i.previewCache.count(),y=v>0?i._getMsgSelected(v):"",i._deleteFileIndex(f),i._setCaption(y),i._raise("filedeleted",[l,a,o]),f.removeClass("file-uploading").addClass("file-deleted"),void f.fadeOut("slow",function(){t.cleanZoomCache(r.find("#zoom-"+f.attr("id")));i._clearObjects(f);f.remove();u();v||0!==i.getFileStack().length||(i._setCaption(""),i.reset())})):(h.jqXHR=a,h.response=n,i._showError(n.error,h,"filedeleteerror"),f.removeClass("file-uploading"),s.removeClass("disabled"),void u())},error:function(n,t,r){var e=i.ajaxOperations.deleteThumb,o=i._parseError(e,n,r);h.jqXHR=n;h.response={};i._showError(o,h,"filedeleteerror");f.removeClass("file-uploading");u()}},i.ajaxDeleteSettings);i._handler(s,"click",function(){return i._validateMinCount()?void n.ajax(p):!1})}})},_hideFileIcon:function(){this.overwriteInitial&&this.$captionContainer.find(".kv-caption-icon").hide()},_showFileIcon:function(){this.$captionContainer.find(".kv-caption-icon").show()},_getSize:function(t){var u,f,r,e=this,i=parseFloat(t),o=e.fileSizeGetter;return n.isNumeric(t)&&n.isNumeric(i)?("function"==typeof o?r=o(i):0===i?r="0.00 B":(u=Math.floor(Math.log(i)/Math.log(1024)),f=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],r=1*(i/Math.pow(1024,u)).toFixed(2)+" "+f[u]),e._getLayoutTemplate("size").replace("{sizeText}",r)):""},_generatePreviewTemplate:function(n,i,r,u,f,e,o,s,h,c,l){var w,a=this,b=a.slug(r),y="",v=a.previewSettings[n]||a.defaults.previewSettings[n],p=v&&v.width?v.width:"",g=v&&v.height?v.height:"",nt=h||a._renderFileFooter(b,o,t.isEmpty(p)?"auto":p,e),k=a._getPreviewIcon(r),tt=k&&a.preferIconicPreview,it=k&&a.preferIconicZoomPreview,d=function(i,e,o,h){var w=o?"zoom-"+f:f,y=a._getPreviewTemplate(i),v=(s||"")+" "+h;return a.frameClass&&(v=a.frameClass+" "+v),o&&(v=v.replace(" "+t.SORT_CSS,"")),y=a._parseFilePreviewIcon(y,r),"text"===i&&(e=t.htmlEncode(e)),y.replace(/\{previewId}/g,w).replace(/\{caption}/g,b).replace(/\{frameClass}/g,v).replace(/\{type}/g,u).replace(/\{fileindex}/g,c).replace(/\{width}/g,p).replace(/\{height}/g,g).replace(/\{footer}/g,nt).replace(/\{data}/g,e).replace(/\{template}/g,l||n)};return c=c||f.slice(f.lastIndexOf("-")+1),a.fileActionSettings.showZoom&&(y=d(it?"other":n,i,!0,"kv-zoom-thumb")),y="\n"+a._getLayoutTemplate("zoomCache").replace("{zoomContent}",y),w=d(tt?"other":n,i,!1,"kv-preview-thumb"),w+y},_previewDefault:function(i,r,u){var f=this,h=f.$preview;if(f.showPreview){var e,o=i?i.name:"",c=i?i.type:"",s=i.size||0,l=f.slug(o),a=u===!0&&!f.isUploadable,v=t.objUrl.createObjectURL(i);f._clearDefaultPreview();e=f._generatePreviewTemplate("other",v,o,c,r,a,s);h.append("\n"+e);f._setThumbAttr(r,l,s);u===!0&&f.isUploadable&&f._setThumbStatus(n("#"+r),"Error")}},_previewFile:function(n,t,i,r,u){if(this.showPreview){var s,f=this,e=f._parseFileType(t),h=t?t.name:"",c=f.slug(h),l=f.allowedPreviewTypes,a=f.allowedPreviewMimeTypes,y=f.$preview,p=l&&l.indexOf(e)>=0,v=t.size||0,o="text"===e||"html"===e||"image"===e?i.target.result:u,w=a&&-1!==a.indexOf(t.type);"html"===e&&f.purifyHtml&&window.DOMPurify&&(o=window.DOMPurify.sanitize(o));p||w?(s=f._generatePreviewTemplate(e,o,h,t.type,r,!1,v),f._clearDefaultPreview(),y.append("\n"+s),f._validateImage(r,c,t.type)):f._previewDefault(t,r);f._setThumbAttr(r,c,v);f._initSortable()}},_setThumbAttr:function(t,i,r){var f=this,u=n("#"+t);u.length&&(r=r&&r>0?f._getSize(r):"",u.data({caption:i,size:r}))},_setInitThumbAttr:function(){var i,u,f,e,r=this,s=r.previewCache.data,o=r.previewCache.count(!0),n;if(0!==o)for(n=0;o>n;n++)i=s.config[n],e=r.previewInitId+"-init_"+n,u=t.ifSet("caption",i,t.ifSet("filename",i)),f=t.ifSet("size",i),r._setThumbAttr(e,u,f)},_slugDefault:function(n){return t.isEmpty(n)?"":String(n).replace(/[\-\[\]\/\{}:;#%=\(\)\*\+\?\\\^\$\|<>&"']/g,"_")},_readFiles:function(i){this.reader=new FileReader;var e,r=this,b=r.$element,y=r.$preview,u=r.reader,l=r.$previewContainer,c=r.$previewStatus,k=r.msgLoading,p=r.msgProgress,d=r.previewInitId,f=i.length,a=r.fileTypeSettings,g=r.filestack.length,o=r.allowedFileTypes,w=o?o.length:0,s=r.allowedFileExtensions,nt=t.isEmpty(s)?"":s.join(", "),v=r.maxFilePreviewSize&&parseFloat(r.maxFilePreviewSize),tt=y.length&&(!v||isNaN(v)),h=function(t,u,f,o){var s=n.extend(!0,{},r._getOutData({},{},i),{id:f,index:o}),h={id:f,index:o,file:u,files:i};return r._previewDefault(u,f,!0),r.isUploadable&&(r.addToStack(void 0),setTimeout(function(){e(o+1)},100)),r._initFileActions(),r.removeFromPreviewOnError&&n("#"+f).remove(),r.isUploadable?r._showUploadError(t,s):r._showError(t,h)};r.loadedImages=[];r.totalImagesCount=0;n.each(i,function(n,t){var i=r.fileTypeSettings.image;i&&i(t.type)&&r.totalImagesCount++});e=function(n){if(t.isEmpty(b.attr("multiple"))&&(f=1),n>=f)return r.isUploadable&&r.filestack.length>0?r._raise("filebatchselected",[r.getFileStack()]):r._raise("filebatchselected",[i]),l.removeClass("file-thumb-loading"),void c.html("");var pt,wt,ct,et,rt,bt,lt,at,vt,st,dt=g+n,ft=d+"-"+dt,it=i[n],ut=it.name?r.slug(it.name):"",ht=(it.size||0)/1e3,yt="",gt=t.objUrl.createObjectURL(it),ot=0,kt="";if(w>0)for(et=0;w>et;et++)at=o[et],vt=r.msgFileTypes[at]||at,kt+=0===et?vt:", "+vt;if(ut===!1)return void e(n+1);if(0===ut.length)return rt=r.msgInvalidFileName.replace("{name}",t.htmlEncode(it.name)),void(r.isError=h(rt,it,ft,n));if(t.isEmpty(s)||(yt=new RegExp("\\.("+s.join("|")+")$","i")),ct=ht.toFixed(2),r.maxFileSize>0&&ht>r.maxFileSize)return rt=r.msgSizeTooLarge.replace("{name}",ut).replace("{size}",ct).replace("{maxSize}",r.maxFileSize),void(r.isError=h(rt,it,ft,n));if(null!==r.minFileSize&&ht<=t.getNum(r.minFileSize))return rt=r.msgSizeTooSmall.replace("{name}",ut).replace("{size}",ct).replace("{minSize}",r.minFileSize),void(r.isError=h(rt,it,ft,n));if(!t.isEmpty(o)&&t.isArray(o)){for(et=0;et<o.length;et+=1)bt=o[et],st=a[bt],ot+=st&&"function"==typeof st&&st(it.type,it.name)?1:0;if(0===ot)return rt=r.msgInvalidFileType.replace("{name}",ut).replace("{types}",kt),void(r.isError=h(rt,it,ft,n))}return 0!==ot||t.isEmpty(s)||!t.isArray(s)||t.isEmpty(yt)||(lt=t.compare(ut,yt),ot+=t.isEmpty(lt)?0:lt.length,0!==ot)?r.showPreview?!tt&&ht>v?(r.addToStack(it),l.addClass("file-thumb-loading"),r._previewDefault(it,ft),r._initFileActions(),r._updateFileDetails(f),void e(n+1)):(y.length&&void 0!==FileReader?(c.html(k.replace("{index}",n+1).replace("{files}",f)),l.addClass("file-thumb-loading"),u.onerror=function(n){r._errorHandler(n,ut)},u.onload=function(t){r._previewFile(n,it,t,ft,gt);r._initFileActions()},u.onloadend=function(){rt=p.replace("{index}",n+1).replace("{files}",f).replace("{percent}",50).replace("{name}",ut);setTimeout(function(){c.html(rt);r._updateFileDetails(f);e(n+1)},100);r._raise("fileloaded",[it,ft,n,u])},u.onprogress=function(t){if(t.lengthComputable){var i=t.loaded/t.total*100,r=Math.ceil(i);rt=p.replace("{index}",n+1).replace("{files}",f).replace("{percent}",r).replace("{name}",ut);setTimeout(function(){c.html(rt)},100)}},pt=a.text,wt=a.image,pt(it.type,ut)?u.readAsText(it,r.textEncoding):wt(it.type,ut)?u.readAsDataURL(it):u.readAsArrayBuffer(it)):(r._previewDefault(it,ft),setTimeout(function(){e(n+1);r._updateFileDetails(f)},100),r._raise("fileloaded",[it,ft,n,u])),void r.addToStack(it)):(r.addToStack(it),setTimeout(function(){e(n+1)},100),void r._raise("fileloaded",[it,ft,n,u])):(rt=r.msgInvalidFileExtension.replace("{name}",ut).replace("{extensions}",nt),void(r.isError=h(rt,it,ft,n)))};e(0);r._updateFileDetails(f,!1)},_updateFileDetails:function(n){var i=this,r=i.$element,u=i.getFileStack(),o=t.isIE(9)&&t.findFileName(r.val())||r[0].files[0]&&r[0].files[0].name||u.length&&u[0].name||"",f=i.slug(o),e=i.isUploadable?u.length:n,s=i.previewCache.count()+e,h=e>1?i._getMsgSelected(s):f;i.isError?(i.$previewContainer.removeClass("file-thumb-loading"),i.$previewStatus.html(""),i.$captionContainer.find(".kv-caption-icon").hide()):i._showFileIcon();i._setCaption(h,i.isError);i.$container.removeClass("file-input-new file-input-ajax-new");1===arguments.length&&i._raise("fileselect",[n,f]);i.previewCache.count()&&i._initPreviewActions()},_setThumbStatus:function(n,t){var r=this;if(r.showPreview){var u="indicator"+t,e=u+"Title",o="file-preview-"+t.toLowerCase(),i=n.find(".file-upload-indicator"),f=r.fileActionSettings;n.removeClass("file-preview-success file-preview-error file-preview-loading");"Error"===t&&n.find(".kv-file-upload").attr("disabled",!0);"Success"===t&&(n.find(".file-drag-handle").remove(),i.css("margin-left",0));i.html(f[u]);i.attr("title",f[e]);n.addClass(o)}},_setProgressCancelled:function(){var n=this;n._setProgress(101,n.$progress,n.msgCancelled)},_setProgress:function(n,i,r){var e,h,u=this,f=Math.min(n,100),o=u.progressUploadThreshold,c=100>=n?u.progressTemplate:u.progressCompleteTemplate,s=100>f?u.progressTemplate:r?u.progressErrorTemplate:c;i=i||u.$progress;t.isEmpty(s)||(o&&f>o&&100>=n?e=s.replace(/\{percent}/g,o).replace(/\{status}/g,u.msgUploadThreshold):(h=n>100?u.msgUploadEnd:f+"%",e=s.replace(/\{percent}/g,f).replace(/\{status}/g,h)),i.html(e),r&&i.find('[role="progressbar"]').html(r))},_setFileDropZoneTitle:function(){var r,n=this,i=n.$container.find(".file-drop-zone"),u=n.dropZoneTitle;n.isClickable&&(r=t.isEmpty(n.$element.attr("multiple"))?n.fileSingle:n.filePlural,u+=n.dropZoneClickTitle.replace("{files}",r));i.find("."+n.dropZoneTitleClass).remove();n.isUploadable&&n.showPreview&&0!==i.length&&!(n.getFileStack().length>0)&&n.dropZoneEnabled&&(0===i.find(t.FRAMES).length&&t.isEmpty(n.defaultPreviewContent)&&i.prepend('<div class="'+n.dropZoneTitleClass+'">'+u+"<\/div>"),n.$container.removeClass("file-input-new"),t.addCss(n.$container,"file-input-ajax-new"))},_setAsyncUploadStatus:function(t,i,r){var u=this,f=0;u._setProgress(i,n("#"+t).find(".file-thumb-progress"));u.uploadStatus[t]=i;n.each(u.uploadStatus,function(n,t){f+=t});u._setProgress(Math.floor(f/r))},_validateMinCount:function(){var n=this,t=n.isUploadable?n.getFileStack().length:n.$element.get(0).files.length;return n.validateInitialCount&&n.minFileCount>0&&n._getFileCount(t-1)<n.minFileCount?(n._noFilesError({}),!1):!0},_getFileCount:function(n){var t=this,i=0;return t.validateInitialCount&&!t.overwriteInitial&&(i=t.previewCache.count(),n+=i),n},_getFileName:function(n){if(n&&n.name)return this.slug(n.name)},_getFileNames:function(n){var t=this;return t.filenames.filter(function(t){return n?void 0!==t:void 0!==t&&null!==t})},_setPreviewError:function(n,t,i){var r=this;void 0!==t&&r.updateStack(t,i);r.removeFromPreviewOnError?n.remove():r._setThumbStatus(n,"Error")},_checkDimensions:function(n,i,r,u,f,e,o){var a,l,s,v,h=this,y="Small"===i?"min":"max",c=h[y+"Image"+e];!t.isEmpty(c)&&r.length&&(s=r[0],l="Width"===e?s.naturalWidth||s.width:s.naturalHeight||s.height,v="Small"===i?l>=c:c>=l,v||(a=h["msgImage"+e+i].replace("{name}",f).replace("{size}",c),h._showUploadError(a,o),h._setPreviewError(u,n,null)))},_validateImage:function(n,t,i){var o,s,h,r=this,c=r.$preview,u=c.find("#"+n),e=u.attr("data-fileindex"),f=u.find("img");t=t||"Untitled";f.length&&r._handler(f,"load",function(){s=u.width();h=c.width();s>h&&(f.css("width","100%"),u.css("width","97%"));o={ind:e,id:n};r._checkDimensions(e,"Small",f,u,t,"Width",o);r._checkDimensions(e,"Small",f,u,t,"Height",o);r.resizeImage||(r._checkDimensions(e,"Large",f,u,t,"Width",o),r._checkDimensions(e,"Large",f,u,t,"Height",o));r._raise("fileimageloaded",[n]);r.loadedImages.push({ind:e,img:f,thumb:u,pid:n,typ:i});r._validateAllImages()})},_validateAllImages:function(){var t,n=this,r={val:0},i=n.loadedImages.length;if(i===n.totalImagesCount&&(n._raise("fileimagesloaded"),n.resizeImage))for(t=0;t<n.loadedImages.length;t++)n._getResizedImage(n.loadedImages[t],r,i)},_getResizedImage:function(t,i,r){var a,v,h,d,u=this,y=n(t.img)[0],f=y.naturalWidth,e=y.naturalHeight,p=1,c=u.maxImageWidth||f,l=u.maxImageHeight||e,w=!(!f||!e),b=u.imageCanvas,g=u.imageCanvasContext,k=t.typ,s=t.pid,o=t.ind,nt=t.thumb;if(h=function(n,t,i){u.isUploadable?u._showUploadError(n,t,i):u._showError(n,t,i);u._setPreviewError(nt,o)},(!u.filestack[o]||!w||c>=f&&l>=e)&&(w&&u.filestack[o]&&u._raise("fileimageresized",[s,o]),i.val++,i.val===r&&u._raise("fileimagesresized"),!w))return void h(u.msgImageResizeError,{id:s,index:o},"fileimageresizeerror");k=k||u.resizeDefaultImageType;a=f>c;v=e>l;p="width"===u.resizePreference?a?c/f:v?l/e:1:v?l/e:a?c/f:1;u._resetCanvas();f*=p;e*=p;b.width=f;b.height=e;try{g.drawImage(y,0,0,f,e);b.toBlob(function(n){u.filestack[o]=n;u._raise("fileimageresized",[s,o]);i.val++;i.val===r&&u._raise("fileimagesresized",[void 0,void 0]);n instanceof Blob||h(u.msgImageResizeError,{id:s,index:o},"fileimageresizeerror")},k,u.resizeQuality)}catch(tt){i.val++;i.val===r&&u._raise("fileimagesresized",[void 0,void 0]);d=u.msgImageResizeException.replace("{errors}",tt.message);h(d,{id:s,index:o},"fileimageresizeexception")}},_initBrowse:function(n){var t=this;t.showBrowse?(t.$btnFile=n.find(".btn-file"),t.$btnFile.append(t.$element)):t.$element.hide()},_initCaption:function(){var n=this,i=n.initialCaption||"";return n.overwriteInitial||t.isEmpty(i)?(n.$caption.html(""),!1):(n._setCaption(i),!0)},_setCaption:function(i,r){var f,o,e,s,u=this,h=u.getFileStack();if(u.$caption.length){if(r)f=n("<div>"+u.msgValidationError+"<\/div>").text(),e=h.length,s=e?1===e&&h[0]?u._getFileNames()[0]:u._getMsgSelected(e):u._getMsgSelected(u.msgNo),o='<span class="'+u.msgValidationErrorClass+'">'+u.msgValidationErrorIcon+(t.isEmpty(i)?s:i)+"<\/span>";else{if(t.isEmpty(i))return;f=n("<div>"+i+"<\/div>").text();o=u._getLayoutTemplate("fileIcon")+f}u.$caption.html(o);u.$caption.attr("title",f);u.$captionContainer.find(".file-caption-ellipsis").attr("title",f)}},_createContainer:function(){var t=this,i=n(document.createElement("div")).attr({"class":"file-input file-input-new"}).html(t._renderMain());return t.$element.before(i),t._initBrowse(i),t.theme&&i.addClass("theme-"+t.theme),i},_refreshContainer:function(){var n=this,t=n.$container;t.before(n.$element);t.html(n._renderMain());n._initBrowse(t)},_renderMain:function(){var n=this,t=n.isUploadable&&n.dropZoneEnabled?" file-drop-zone":"file-drop-disabled",i=n.showClose?n._getLayoutTemplate("close"):"",r=n.showPreview?n._getLayoutTemplate("preview").replace(/\{class}/g,n.previewClass).replace(/\{dropClass}/g,t):"",u=n.isDisabled?n.captionClass+" file-caption-disabled":n.captionClass,f=n.captionTemplate.replace(/\{class}/g,u+" kv-fileinput-caption");return n.mainTemplate.replace(/\{class}/g,n.mainClass+(!n.showBrowse&&n.showCaption?" no-browse":"")).replace(/\{preview}/g,r).replace(/\{close}/g,i).replace(/\{caption}/g,f).replace(/\{upload}/g,n._renderButton("upload")).replace(/\{remove}/g,n._renderButton("remove")).replace(/\{cancel}/g,n._renderButton("cancel")).replace(/\{browse}/g,n._renderButton("browse"))},_renderButton:function(n){var i=this,u=i._getLayoutTemplate("btnDefault"),f=i[n+"Class"],o=i[n+"Title"],s=i[n+"Icon"],r=i[n+"Label"],h=i.isDisabled?" disabled":"",e="button";switch(n){case"remove":if(!i.showRemove)return"";break;case"cancel":if(!i.showCancel)return"";f+=" hide";break;case"upload":if(!i.showUpload)return"";i.isUploadable&&!i.isDisabled?u=i._getLayoutTemplate("btnLink").replace("{href}",i.uploadUrl):e="submit";break;case"browse":if(!i.showBrowse)return"";u=i._getLayoutTemplate("btnBrowse");break;default:return""}return f+="browse"===n?" btn-file":" fileinput-"+n+" fileinput-"+n+"-button",t.isEmpty(r)||(r=' <span class="'+i.buttonLabelClass+'">'+r+"<\/span>"),u.replace("{type}",e).replace("{css}",f).replace("{title}",o).replace("{status}",h).replace("{icon}",s).replace("{label}",r)},_renderThumbProgress:function(){var n=this;return'<div class="file-thumb-progress hide">'+n.progressTemplate.replace(/\{percent}/g,"0").replace(/\{status}/g,n.msgUploadBegin)+"<\/div>"},_renderFileFooter:function(n,i,r,u){var o,f=this,e=f.fileActionSettings,v=e.showRemove,s=e.showDrag,y=e.showUpload,h=e.showZoom,c=f._getLayoutTemplate("footer"),l=u?e.indicatorError:e.indicatorNew,a=u?e.indicatorErrorTitle:e.indicatorNewTitle;return i=f._getSize(i),o=f.isUploadable?c.replace(/\{actions}/g,f._renderFileActions(y,v,h,s,!1,!1,!1)).replace(/\{caption}/g,n).replace(/\{size}/g,i).replace(/\{width}/g,r).replace(/\{progress}/g,f._renderThumbProgress()).replace(/\{indicator}/g,l).replace(/\{indicatorTitle}/g,a):c.replace(/\{actions}/g,f._renderFileActions(!1,!1,h,s,!1,!1,!1)).replace(/\{caption}/g,n).replace(/\{size}/g,i).replace(/\{width}/g,r).replace(/\{progress}/g,"").replace(/\{indicator}/g,l).replace(/\{indicatorTitle}/g,a),o=t.replaceTags(o,f.previewThumbTags)},_renderFileActions:function(n,t,i,r,u,f,e,o){if(!(n||t||i||r))return"";var c,h=this,w=f===!1?"":' data-url="'+f+'"',l=e===!1?"":' data-key="'+e+'"',a="",v="",y="",p="",b=h._getLayoutTemplate("actions"),s=h.fileActionSettings,k=h.otherActionButtons.replace(/\{dataKey}/g,l),d=u?s.removeClass+" disabled":s.removeClass;return t&&(a=h._getLayoutTemplate("actionDelete").replace(/\{removeClass}/g,d).replace(/\{removeIcon}/g,s.removeIcon).replace(/\{removeTitle}/g,s.removeTitle).replace(/\{dataUrl}/g,w).replace(/\{dataKey}/g,l)),n&&(v=h._getLayoutTemplate("actionUpload").replace(/\{uploadClass}/g,s.uploadClass).replace(/\{uploadIcon}/g,s.uploadIcon).replace(/\{uploadTitle}/g,s.uploadTitle)),i&&(y=h._getLayoutTemplate("actionZoom").replace(/\{zoomClass}/g,s.zoomClass).replace(/\{zoomIcon}/g,s.zoomIcon).replace(/\{zoomTitle}/g,s.zoomTitle)),r&&o&&(c="drag-handle-init "+s.dragClass,p=h._getLayoutTemplate("actionDrag").replace(/\{dragClass}/g,c).replace(/\{dragTitle}/g,s.dragTitle).replace(/\{dragIcon}/g,s.dragIcon)),b.replace(/\{delete}/g,a).replace(/\{upload}/g,v).replace(/\{zoom}/g,y).replace(/\{drag}/g,p).replace(/\{other}/g,k)},_browse:function(n){var t=this;t._raise("filebrowse");n&&n.isDefaultPrevented()||(t.isError&&!t.isUploadable&&t.clear(),t.$captionContainer.focus())},_change:function(i){var r=this,c=r.$element;if(!r.isUploadable&&t.isEmpty(c.val())&&r.fileInputCleared)return void(r.fileInputCleared=!1);r.fileInputCleared=!1;var u,v,e,o,y,f,p=arguments.length>1,s=r.isUploadable,l=0,h=p?i.originalEvent.dataTransfer.files:c.get(0).files,w=r.filestack.length,k=t.isEmpty(c.attr("multiple")),b=k&&w>0,a=0,d=function(t,i,u,f){var e=n.extend(!0,{},r._getOutData({},{},h),{id:u,index:f}),o={id:u,index:f,file:i,files:h};return r.isUploadable?r._showUploadError(t,e):r._showError(t,o)};if(r.reader=null,r._resetUpload(),r._hideFileIcon(),r.isUploadable&&r.$container.find(".file-drop-zone ."+r.dropZoneTitleClass).remove(),p)for(u=[];h[l];)o=h[l],o.type||o.size%4096!=0?u.push(o):a++,l++;else u=void 0===i.target.files?i.target&&i.target.value?[{name:i.target.value.replace(/^.+\\/,"")}]:[]:i.target.files;if(t.isEmpty(u)||0===u.length)return s||r.clear(),r._showFolderError(a),void r._raise("fileselectnone");if(r._resetErrors(),f=u.length,e=r._getFileCount(r.isUploadable?r.getFileStack().length+f:f),r.maxFileCount>0&&e>r.maxFileCount){if(!r.autoReplace||f>r.maxFileCount)return y=r.autoReplace&&f>r.maxFileCount?f:e,v=r.msgFilesTooMany.replace("{m}",r.maxFileCount).replace("{n}",y),r.isError=d(v,null,null,null),r.$captionContainer.find(".kv-caption-icon").hide(),r._setCaption("",!0),void r.$container.removeClass("file-input-new file-input-ajax-new");e>r.maxFileCount&&r._resetPreviewThumbs(s)}else!s||b?(r._resetPreviewThumbs(!1),b&&r.clearStack()):!s||0!==w||r.previewCache.count()&&!r.overwriteInitial||r._resetPreviewThumbs(!0);r.isPreviewable?r._readFiles(u):r._updateFileDetails(1);r._showFolderError(a)},_abort:function(t){var r,i=this;return i.ajaxAborted&&"object"==typeof i.ajaxAborted&&void 0!==i.ajaxAborted.message?(r=n.extend(!0,{},i._getOutData(),t),r.abortData=i.ajaxAborted.data||{},r.abortMessage=i.ajaxAborted.message,i.cancel(),i._setProgress(101,i.$progress,i.msgCancelled),i._showUploadError(i.ajaxAborted.message,r,"filecustomerror"),!0):!1},_resetFileStack:function(){var t=this,i=0,r=[],u=[];t._getThumbs().each(function(){var f=n(this),o=f.attr("data-fileindex"),e=t.filestack[o];-1!==o&&(void 0!==e?(r[i]=e,u[i]=t._getFileName(e),f.attr({id:t.previewInitId+"-"+i,"data-fileindex":i}),i++):f.attr({"data-fileindex":"-1"}))});t.filestack=r;t.filenames=u},clearStack:function(){var n=this;return n.filestack=[],n.filenames=[],n.$element},updateStack:function(n,t){var i=this;return i.filestack[n]=t,i.filenames[n]=i._getFileName(t),i.$element},addToStack:function(n){var t=this;return t.filestack.push(n),t.filenames.push(t._getFileName(n)),t.$element},getFileStack:function(n){var t=this;return t.filestack.filter(function(t){return n?void 0!==t:void 0!==t&&null!==t})},getFilesCount:function(){var n=this,t=n.isUploadable?n.getFileStack().length:n.$element.get(0).files.length;return n._getFileCount(t)},lock:function(){var n=this;return n._resetErrors(),n.disable(),n.showRemove&&t.addCss(n.$container.find(".fileinput-remove"),"hide"),n.showCancel&&n.$container.find(".fileinput-cancel").removeClass("hide"),n._raise("filelock",[n.filestack,n._getExtraData()]),n.$element},unlock:function(n){var i=this;return void 0===n&&(n=!0),i.enable(),i.showCancel&&t.addCss(i.$container.find(".fileinput-cancel"),"hide"),i.showRemove&&i.$container.find(".fileinput-remove").removeClass("hide"),n&&i._resetFileStack(),i._raise("fileunlock",[i.filestack,i._getExtraData()]),i.$element},cancel:function(){var i,t=this,r=t.ajaxRequests,u=r.length;if(u>0)for(i=0;u>i;i+=1)t.cancelling=!0,r[i].abort();return t._setProgressCancelled(),t._getThumbs().each(function(){var i=n(this),r=i.attr("data-fileindex");i.removeClass("file-uploading");void 0!==t.filestack[r]&&(i.find(".kv-file-upload").removeClass("disabled").removeAttr("disabled"),i.find(".kv-file-remove").removeClass("disabled").removeAttr("disabled"));t.unlock()}),t.$element},clear:function(){var r,i=this;if(i._raise("fileclear"))return i.$btnUpload.removeAttr("disabled"),i._getThumbs().find("video,audio,img").each(function(){t.cleanMemory(n(this))}),i._resetUpload(),i.clearStack(),i._clearFileInput(),i._resetErrors(!0),i._hasInitialPreview()?(i._showFileIcon(),i._resetPreview(),i._initPreviewActions(),i.$container.removeClass("file-input-new")):(i._getThumbs().each(function(){i._clearObjects(n(this))}),i.isUploadable&&(i.previewCache.data={}),i.$preview.html(""),r=!i.overwriteInitial&&i.initialCaption.length>0?i.initialCaption:"",i.$caption.html(r),i.$caption.attr("title",""),t.addCss(i.$container,"file-input-new"),i._validateDefaultPreview()),0===i.$container.find(t.FRAMES).length&&(i._initCaption()||i.$captionContainer.find(".kv-caption-icon").hide()),i._hideFileIcon(),i._raise("filecleared"),i.$captionContainer.focus(),i._setFileDropZoneTitle(),i.$element},reset:function(){var n=this;if(n._raise("filereset"))return n._resetPreview(),n.$container.find(".fileinput-filename").text(""),t.addCss(n.$container,"file-input-new"),(n.$preview.find(t.FRAMES).length||n.isUploadable&&n.dropZoneEnabled)&&n.$container.removeClass("file-input-new"),n._setFileDropZoneTitle(),n.clearStack(),n.formdata={},n.$element},disable:function(){var n=this;return n.isDisabled=!0,n._raise("filedisabled"),n.$element.attr("disabled","disabled"),n.$container.find(".kv-fileinput-caption").addClass("file-caption-disabled"),n.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").attr("disabled",!0),n._initDragDrop(),n.$element},enable:function(){var n=this;return n.isDisabled=!1,n._raise("fileenabled"),n.$element.removeAttr("disabled"),n.$container.find(".kv-fileinput-caption").removeClass("file-caption-disabled"),n.$container.find(".btn-file, .fileinput-remove, .fileinput-upload, .file-preview-frame button").removeAttr("disabled"),n._initDragDrop(),n.$element},upload:function(){var r,e,u,i=this,f=i.getFileStack().length,o=!n.isEmptyObject(i._getExtraData());if(i.isUploadable&&!i.isDisabled){if(i.minFileCount>0&&i._getFileCount(f)<i.minFileCount)return void i._noFilesError({});if(i._resetUpload(),0===f&&!o)return void i._showUploadError(i.msgUploadEmpty);if(i.$progress.removeClass("hide"),i.uploadCount=0,i.uploadStatus={},i.uploadLog=[],i.lock(),i._setProgress(2),0===f&&o)return void i._uploadExtraOnly();if(u=i.filestack.length,i.hasInitData=!1,!i.uploadAsync)return i._uploadBatch(),i.$element;for(e=i._getOutData(),i._raise("filebatchpreupload",[e]),i.fileBatchCompleted=!1,i.uploadCache={content:[],config:[],tags:[],append:!0},i.uploadAsyncCount=i.getFileStack().length,r=0;u>r;r++)i.uploadCache.content[r]=null,i.uploadCache.config[r]=null,i.uploadCache.tags[r]=null;for(i.$preview.find(".file-preview-initial").removeClass(t.SORT_CSS),i._initSortable(),i.cacheInitialPreview=i.getPreview(),r=0;u>r;r++)void 0!==i.filestack[r]&&i._uploadSingle(r,i.filestack,!0)}},destroy:function(){var t=this,r=t.$form,u=t.$container,f=t.$element,i=t.namespace;return n(document).off(i),n(window).off(i),r&&r.length&&r.off(i),f.insertBefore(u).off(i).removeData(),u.off().remove(),f},refresh:function(t){var i=this,r=i.$element;return t=t?n.extend(!0,{},i.options,t):i.options,i.destroy(),r.fileinput(t),r.val()&&r.trigger("change.fileinput"),r},zoom:function(i){var r=this,f=n("#"+i),u=r.$modal;return f.length?(t.initModal(u),u.html(r._getModalContent()),r._setZoomContent(f),u.modal("show"),void r._initZoomButtons()):void r._log('Cannot zoom to detailed preview! Invalid frame with id: "'+i+'".')},getPreview:function(){var n=this;return{content:n.initialPreview,config:n.initialPreviewConfig,tags:n.initialPreviewThumbTags}}};n.fn.fileinput=function(r){if(t.hasFileAPISupport()||t.isIE(9)){var f=Array.apply(null,arguments),u=[];switch(f.shift(),this.each(function(){var c,e=n(this),o=e.data("fileinput"),s="object"==typeof r&&r,l=s.theme||e.data("theme"),a={},v={},h=s.language||e.data("language")||n.fn.fileinput.defaults.language||"en";o||(l&&(v=n.fn.fileinputThemes[l]||{}),"en"===h||t.isEmpty(n.fn.fileinputLocales[h])||(a=n.fn.fileinputLocales[h]||{}),c=n.extend(!0,{},n.fn.fileinput.defaults,v,n.fn.fileinputLocales.en,a,s,e.data()),o=new i(this,c),e.data("fileinput",o));"string"==typeof r&&u.push(o[r].apply(o,f))}),u.length){case 0:return this;case 1:return u[0];default:return u}}};n.fn.fileinput.defaults={language:"en",showCaption:!0,showBrowse:!0,showPreview:!0,showRemove:!0,showUpload:!0,showCancel:!0,showClose:!0,showUploadedThumbs:!0,browseOnZoneClick:!1,autoReplace:!1,previewClass:"",captionClass:"",frameClass:"krajee-default",mainClass:"file-caption-main",mainTemplate:null,purifyHtml:!0,fileSizeGetter:null,initialCaption:"",initialPreview:[],initialPreviewDelimiter:"*$$*",initialPreviewAsData:!1,initialPreviewFileType:"image",initialPreviewConfig:[],initialPreviewThumbTags:[],previewThumbTags:{},initialPreviewShowDelete:!0,removeFromPreviewOnError:!1,deleteUrl:"",deleteExtraData:{},overwriteInitial:!0,previewZoomButtonIcons:{prev:'<i class="glyphicon glyphicon-triangle-left"><\/i>',next:'<i class="glyphicon glyphicon-triangle-right"><\/i>',toggleheader:'<i class="glyphicon glyphicon-resize-vertical"><\/i>',fullscreen:'<i class="glyphicon glyphicon-fullscreen"><\/i>',borderless:'<i class="glyphicon glyphicon-resize-full"><\/i>',close:'<i class="glyphicon glyphicon-remove"><\/i>'},previewZoomButtonClasses:{prev:"btn btn-navigate",next:"btn btn-navigate",toggleheader:"btn btn-default btn-header-toggle",fullscreen:"btn btn-default",borderless:"btn btn-default",close:"btn btn-default"},preferIconicPreview:!1,preferIconicZoomPreview:!1,allowedPreviewTypes:void 0,allowedPreviewMimeTypes:null,allowedFileTypes:null,allowedFileExtensions:null,defaultPreviewContent:null,customLayoutTags:{},customPreviewTags:{},previewFileIcon:'<i class="glyphicon glyphicon-file"><\/i>',previewFileIconClass:"file-other-icon",previewFileIconSettings:{},previewFileExtSettings:{},buttonLabelClass:"hidden-xs",browseIcon:'<i class="glyphicon glyphicon-folder-open"><\/i>&nbsp;',browseClass:"btn btn-primary",removeIcon:'<i class="glyphicon glyphicon-trash"><\/i>',removeClass:"btn btn-default",cancelIcon:'<i class="glyphicon glyphicon-ban-circle"><\/i>',cancelClass:"btn btn-default",uploadIcon:'<i class="glyphicon glyphicon-upload"><\/i>',uploadClass:"btn btn-default",uploadUrl:null,uploadAsync:!0,uploadExtraData:{},zoomModalHeight:480,minImageWidth:null,minImageHeight:null,maxImageWidth:null,maxImageHeight:null,resizeImage:!1,resizePreference:"width",resizeQuality:.92,resizeDefaultImageType:"image/jpeg",minFileSize:0,maxFileSize:0,maxFilePreviewSize:25600,minFileCount:0,maxFileCount:0,validateInitialCount:!1,msgValidationErrorClass:"text-danger",msgValidationErrorIcon:'<i class="glyphicon glyphicon-exclamation-sign"><\/i> ',msgErrorClass:"file-error-message",progressThumbClass:"progress-bar progress-bar-success progress-bar-striped active",progressClass:"progress-bar progress-bar-success progress-bar-striped active",progressCompleteClass:"progress-bar progress-bar-success",progressErrorClass:"progress-bar progress-bar-danger",progressUploadThreshold:99,previewFileType:"image",elCaptionContainer:null,elCaptionText:null,elPreviewContainer:null,elPreviewImage:null,elPreviewStatus:null,elErrorContainer:null,errorCloseButton:'<span class="close kv-error-close">&times;<\/span>',slugCallback:null,dropZoneEnabled:!0,dropZoneTitleClass:"file-drop-zone-title",fileActionSettings:{},otherActionButtons:"",textEncoding:"UTF-8",ajaxSettings:{},ajaxDeleteSettings:{},showAjaxErrorDetails:!0};n.fn.fileinputLocales.en={fileSingle:"file",filePlural:"files",browseLabel:"Browse &hellip;",removeLabel:"Remove",removeTitle:"Clear selected files",cancelLabel:"Cancel",cancelTitle:"Abort ongoing upload",uploadLabel:"Upload",uploadTitle:"Upload selected files",msgNo:"No",msgNoFilesSelected:"No files selected",msgCancelled:"Cancelled",msgZoomModalHeading:"Detailed Preview",msgSizeTooSmall:'File "{name}" (<b>{size} KB<\/b>) is too small and must be larger than <b>{minSize} KB<\/b>.',msgSizeTooLarge:'File "{name}" (<b>{size} KB<\/b>) exceeds maximum allowed upload size of <b>{maxSize} KB<\/b>.',msgFilesTooLess:"You must select at least <b>{n}<\/b> {files} to upload.",msgFilesTooMany:"Number of files selected for upload <b>({n})<\/b> exceeds maximum allowed limit of <b>{m}<\/b>.",msgFileNotFound:'File "{name}" not found!',msgFileSecured:'Security restrictions prevent reading the file "{name}".',msgFileNotReadable:'File "{name}" is not readable.',msgFilePreviewAborted:'File preview aborted for "{name}".',msgFilePreviewError:'An error occurred while reading the file "{name}".',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'Invalid type for file "{name}". Only "{types}" files are supported.',msgInvalidFileExtension:'Invalid extension for file "{name}". Only "{extensions}" files are supported.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"The file upload was aborted",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgValidationError:"Validation Error",msgLoading:"Loading file {index} of {files} &hellip;",msgProgress:"Loading file {index} of {files} - {name} - {percent}% completed.",msgSelected:"{n} {files} selected",msgFoldersNotAllowed:"Drag & drop files only! {n} folder(s) dropped were skipped.",msgImageWidthSmall:'Width of image file "{name}" must be at least {size} px.',msgImageHeightSmall:'Height of image file "{name}" must be at least {size} px.',msgImageWidthLarge:'Width of image file "{name}" cannot exceed {size} px.',msgImageHeightLarge:'Height of image file "{name}" cannot exceed {size} px.',msgImageResizeError:"Could not get the image dimensions to resize.",msgImageResizeException:"Error while resizing the image.<pre>{errors}<\/pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"Drag & drop files here &hellip;",dropZoneClickTitle:"<br>(or click to select {files})",previewZoomButtonTitles:{prev:"View previous file",next:"View next file",toggleheader:"Toggle header",fullscreen:"Toggle full screen",borderless:"Toggle borderless mode",close:"Close detailed preview"}};n.fn.fileinput.Constructor=i;n(document).ready(function(){var t=n("input.file[type=file]");t.length&&t.fileinput()})}),function(n){"use strict";n.fn.fileinputLocales.zh={fileSingle:"文件",filePlural:"个文件",browseLabel:"选择 &hellip;",removeLabel:"移除",removeTitle:"清除选中文件",cancelLabel:"取消",cancelTitle:"取消进行中的上传",uploadLabel:"上传",uploadTitle:"上传选中文件",msgNo:"没有",msgNoFilesSelected:"",msgCancelled:"取消",msgZoomModalHeading:"详细预览",msgSizeTooSmall:'File "{name}" (<b>{size} KB<\/b>) is too small and must be larger than <b>{minSize} KB<\/b>.',msgSizeTooLarge:'文件 "{name}" (<b>{size} KB<\/b>) 超过了允许大小 <b>{maxSize} KB<\/b>.',msgFilesTooLess:"你必须选择最少 <b>{n}<\/b> {files} 来上传. ",msgFilesTooMany:"选择的上传文件个数 <b>({n})<\/b> 超出最大文件的限制个数 <b>{m}<\/b>.",msgFileNotFound:'文件 "{name}" 未找到!',msgFileSecured:'安全限制，为了防止读取文件 "{name}".',msgFileNotReadable:'文件 "{name}" 不可读.',msgFilePreviewAborted:'取消 "{name}" 的预览.',msgFilePreviewError:'读取 "{name}" 时出现了一个错误.',msgInvalidFileName:'Invalid or unsupported characters in file name "{name}".',msgInvalidFileType:'不正确的类型 "{name}". 只支持 "{types}" 类型的文件.',msgInvalidFileExtension:'不正确的文件扩展名 "{name}". 只支持 "{extensions}" 的文件扩展名.',msgFileTypes:{image:"image",html:"HTML",text:"text",video:"video",audio:"audio",flash:"flash",pdf:"PDF",object:"object"},msgUploadAborted:"该文件上传被中止",msgUploadThreshold:"Processing...",msgUploadBegin:"Initializing...",msgUploadEnd:"Done",msgUploadEmpty:"No valid data available for upload.",msgValidationError:"验证错误",msgLoading:"加载第 {index} 文件 共 {files} &hellip;",msgProgress:"加载第 {index} 文件 共 {files} - {name} - {percent}% 完成.",msgSelected:"{n} {files} 选中",msgFoldersNotAllowed:"只支持拖拽文件! 跳过 {n} 拖拽的文件夹.",msgImageWidthSmall:'宽度的图像文件的"{name}"的必须是至少{size}像素.',msgImageHeightSmall:'图像文件的"{name}"的高度必须至少为{size}像素.',msgImageWidthLarge:'宽度的图像文件"{name}"不能超过{size}像素.',msgImageHeightLarge:'图像文件"{name}"的高度不能超过{size}像素.',msgImageResizeError:"无法获取的图像尺寸调整。",msgImageResizeException:"错误而调整图像大小。<pre>{errors}<\/pre>",msgAjaxError:"Something went wrong with the {operation} operation. Please try again later!",msgAjaxProgressError:"{operation} failed",ajaxOperations:{deleteThumb:"file delete",uploadThumb:"file upload",uploadBatch:"batch file upload",uploadExtra:"form data upload"},dropZoneTitle:"拖拽文件到这里 &hellip;<br>支持多文件同时上传",dropZoneClickTitle:"<br>(或点击{files}按钮选择文件)",fileActionSettings:{removeTitle:"删除文件",uploadTitle:"上传文件",zoomTitle:"查看详情",dragTitle:"移动 / 重置",indicatorNewTitle:"没有上传",indicatorSuccessTitle:"上传",indicatorErrorTitle:"上传错误",indicatorLoadingTitle:"上传 ..."},previewZoomButtonTitles:{prev:"预览上一个文件",next:"预览下一个文件",toggleheader:"缩放",fullscreen:"全屏",borderless:"无边界模式",close:"关闭当前预览"}}}(window.jQuery);!function(n,t){"use strict";function ui(n,t){for(var r,u=[],i=0;i<n.length;++i){if(r=ut[n[i]]||fi(n[i]),!r)throw"module definition dependecy not found: "+n[i];u.push(r)}t.apply(null,u)}function i(n,i,r){if("string"!=typeof n)throw"invalid module definition, module id must be defined and be a string";if(i===t)throw"invalid module definition, dependencies must be specified";if(r===t)throw"invalid module definition, definition function must be specified";ui(i,function(){ut[n]=r.apply(null,arguments)})}function fi(t){for(var i=n,u=t.split(/[.\/]/),r=0;r<u.length;++r){if(!i[u[r]])return;i=i[u[r]]}return i}function ei(i){for(var e=0;e<i.length;e++){for(var u=n,o=i[e],r=o.split(/[.\/]/),f=0;f<r.length-1;++f)u[r[f]]===t&&(u[r[f]]={}),u=u[r[f]];u[r[r.length-1]]=ut[o]}}var ut={},r="moxie/core/utils/Basic",g="moxie/core/I18n",h="moxie/core/utils/Mime",e="moxie/core/utils/Env",o="moxie/core/utils/Dom",u="moxie/core/Exceptions",c="moxie/core/EventTarget",s="moxie/core/utils/Encode",l="moxie/runtime/Runtime",a="moxie/runtime/RuntimeClient",f="moxie/file/Blob",v="moxie/file/File",ot="moxie/file/FileInput",st="moxie/file/FileDrop",ft="moxie/runtime/RuntimeTarget",ht="moxie/file/FileReader",nt="moxie/core/utils/Url",k="moxie/file/FileReaderSync",d="moxie/xhr/FormData",et="moxie/xhr/XMLHttpRequest",tt="moxie/runtime/Transporter",ct="moxie/image/Image",w="moxie/runtime/html5/Runtime",b="moxie/core/utils/Events",lt="moxie/runtime/html5/file/FileReader",it="moxie/runtime/html5/utils/BinaryReader",at="moxie/runtime/html5/image/JPEGHeaders",vt="moxie/runtime/html5/image/ExifParser",yt="moxie/runtime/html5/image/JPEG",pt="moxie/runtime/html5/image/PNG",wt="moxie/runtime/html5/image/ImageInfo",bt="moxie/runtime/html5/image/MegaPixel",kt="moxie/runtime/html5/image/Image",p="moxie/runtime/flash/Runtime",dt="moxie/runtime/flash/file/Blob",gt="moxie/runtime/flash/file/FileReader",ni="moxie/runtime/flash/file/FileReaderSync",ti="moxie/runtime/flash/xhr/XMLHttpRequest",ii="moxie/runtime/flash/runtime/Transporter",ri="moxie/runtime/flash/image/Image",y="moxie/runtime/silverlight/Runtime",rt="moxie/runtime/html4/Runtime";i(r,[],function(){var n=function(n){var t;return n===t?"undefined":null===n?"null":n.nodeType?"node":{}.toString.call(n).match(/\s([a-z|A-Z]+)/)[1].toLowerCase()},r=function(u){var f;return t(arguments,function(e,o){o>0&&t(e,function(t,e){t!==f&&(n(u[e])===n(t)&&~i(n(t),["array","object"])?r(u[e],t):u[e]=t)})}),u},t=function(n,t){var r,u,i,f;if(n){try{r=n.length}catch(e){r=f}if(r===f){for(u in n)if(n.hasOwnProperty(u)&&t(n[u],u)===!1)return}else for(i=0;r>i;i++)if(t(n[i],i)===!1)return}},u=function(t){var i;if(!t||"object"!==n(t))return!0;for(i in t)return!1;return!0},f=function(t,i){function r(f){"function"===n(t[f])&&t[f](function(n){++f<u&&!n?r(f):i(n)})}var u=t.length;"function"!==n(i)&&(i=function(){});t&&t.length||i();r(0)},e=function(n,i){var u=0,f=n.length,r=new Array(f);t(n,function(n,t){n(function(n){if(n)return i(n);var e=[].slice.call(arguments);e.shift();r[t]=e;u++;u===f&&(r.unshift(null),i.apply(this,r))})})},i=function(n,t){if(t){if(Array.prototype.indexOf)return Array.prototype.indexOf.call(t,n);for(var i=0,r=t.length;r>i;i++)if(t[i]===n)return i}return-1},o=function(t,r){var u=[],f;"array"!==n(t)&&(t=[t]);"array"!==n(r)&&(r=[r]);for(f in t)-1===i(t[f],r)&&u.push(t[f]);return u.length?u:!1},s=function(n,r){var u=[];return t(n,function(n){-1!==i(n,r)&&u.push(n)}),u.length?u:null},h=function(n){for(var i=[],t=0;t<n.length;t++)i[t]=n[t];return i},c=function(){var n=0;return function(t){for(var r=(new Date).getTime().toString(32),i=0;5>i;i++)r+=Math.floor(65535*Math.random()).toString(32);return(t||"o_")+r+(n++).toString(32)}}(),l=function(n){return n?String.prototype.trim?String.prototype.trim.call(n):n.toString().replace(/^\s*/,"").replace(/\s*$/,""):n},a=function(n){if("string"!=typeof n)return n;var i={t:1099511627776,g:1073741824,m:1048576,k:1024},t;return n=/^([0-9]+)([mgk]?)$/.exec(n.toLowerCase().replace(/[^0-9mkg]/g,"")),t=n[2],n=+n[1],i.hasOwnProperty(t)&&(n*=i[t]),n};return{guid:c,typeOf:n,extend:r,each:t,isEmptyObj:u,inSeries:f,inParallel:e,inArray:i,arrayDiff:o,arrayIntersect:s,toArray:h,trim:l,parseSizeStr:a}});i(g,[r],function(n){var t={};return{addI18n:function(i){return n.extend(t,i)},translate:function(n){return t[n]||n},_:function(n){return this.translate(n)},sprintf:function(t){var i=[].slice.call(arguments,1);return t.replace(/%[a-z]/g,function(){var t=i.shift();return"undefined"!==n.typeOf(t)?t:""})}}});i(h,[r,g],function(n,t){var i={mimes:{},extensions:{},addMimeType:function(n){for(var i=n.split(/,/),r,u,t=0;t<i.length;t+=2){for(u=i[t+1].split(/ /),r=0;r<u.length;r++)this.mimes[u[r]]=i[t];this.extensions[i[t]]=u}},extList2mimes:function(t,i){for(var s=this,u,r,o,e=[],f=0;f<t.length;f++)for(u=t[f].extensions.split(/\s*,\s*/),r=0;r<u.length;r++){if("*"===u[r])return[];if(o=s.mimes[u[r]])-1===n.inArray(o,e)&&e.push(o);else{if(!i||!/^\w+$/.test(u[r]))return[];e.push("."+u[r])}}return e},mimes2exts:function(t){var i=this,r=[];return n.each(t,function(t){if("*"===t)return r=[],!1;var u=t.match(/^(\w+)\/(\*|\w+)$/);u&&("*"===u[2]?n.each(i.extensions,function(n,t){new RegExp("^"+u[1]+"/").test(t)&&[].push.apply(r,i.extensions[t])}):i.extensions[t]&&[].push.apply(r,i.extensions[t]))}),r},mimes2extList:function(i){var r=[],u=[];return"string"===n.typeOf(i)&&(i=n.trim(i).split(/\s*,\s*/)),u=this.mimes2exts(i),r.push({title:t.translate("Files"),extensions:u.length?u.join(","):"*"}),r.mimes=i,r},getFileExtension:function(n){var t=n&&n.match(/\.([^.]+)$/);return t?t[1].toLowerCase():""},getFileMime:function(n){return this.mimes[this.getFileExtension(n)]||""}};return i.addMimeType("application/msword,doc dot,application/pdf,pdf,application/pgp-signature,pgp,application/postscript,ps ai eps,application/rtf,rtf,application/vnd.ms-excel,xls xlb,application/vnd.ms-powerpoint,ppt pps pot,application/zip,zip,application/x-shockwave-flash,swf swfl,application/vnd.openxmlformats-officedocument.wordprocessingml.document,docx,application/vnd.openxmlformats-officedocument.wordprocessingml.template,dotx,application/vnd.openxmlformats-officedocument.spreadsheetml.sheet,xlsx,application/vnd.openxmlformats-officedocument.presentationml.presentation,pptx,application/vnd.openxmlformats-officedocument.presentationml.template,potx,application/vnd.openxmlformats-officedocument.presentationml.slideshow,ppsx,application/x-javascript,js,application/json,json,audio/mpeg,mp3 mpga mpega mp2,audio/x-wav,wav,audio/x-m4a,m4a,audio/ogg,oga ogg,audio/aiff,aiff aif,audio/flac,flac,audio/aac,aac,audio/ac3,ac3,audio/x-ms-wma,wma,image/bmp,bmp,image/gif,gif,image/jpeg,jpg jpeg jpe,image/photoshop,psd,image/png,png,image/svg+xml,svg svgz,image/tiff,tiff tif,text/plain,asc txt text diff log,text/html,htm html xhtml,text/css,css,text/csv,csv,text/rtf,rtf,video/mpeg,mpeg mpg mpe m2v,video/quicktime,qt mov,video/mp4,mp4,video/x-m4v,m4v,video/x-flv,flv,video/x-ms-wmv,wmv,video/avi,avi,video/webm,webm,video/3gpp,3gpp 3gp,video/3gpp2,3g2,video/vnd.rn-realvideo,rv,video/ogg,ogv,video/x-matroska,mkv,application/vnd.oasis.opendocument.formula-template,otf,application/octet-stream,exe"),i});i(e,[r],function(n){function r(n,t,i){var r=0,f=0,u=0,s={dev:-6,alpha:-5,a:-5,beta:-4,b:-4,RC:-3,rc:-3,"#":-2,p:1,pl:1},e=function(n){return n=(""+n).replace(/[_\-+]/g,"."),n=n.replace(/([^.\d]+)/g,".$1.").replace(/\.{2,}/g,"."),n.length?n.split("."):[-8]},o=function(n){return n?isNaN(n)?s[n]||-7:parseInt(n,10):0};for(n=e(n),t=e(t),f=Math.max(n.length,t.length),r=0;f>r;r++)if(n[r]!=t[r]){if(n[r]=o(n[r]),t[r]=o(t[r]),n[r]<t[r]){u=-1;break}if(n[r]>t[r]){u=1;break}}if(!i)return u;switch(i){case">":case"gt":return u>0;case">=":case"ge":return u>=0;case"<=":case"le":return 0>=u;case"==":case"=":case"eq":return 0===u;case"<>":case"!=":case"ne":return 0!==u;case"":case"<":case"lt":return 0>u;default:return null}}var i=function(n){var l="",s="?",h="function",a="undefined",e="object",r="major",t="name",i="version",c={has:function(n,t){return-1!==t.toLowerCase().indexOf(n.toLowerCase())},lowerize:function(n){return n.toLowerCase()}},u={rgx:function(){for(var r,s,y,u,t,l,i,v,o,f=0,c=arguments;f<c.length;f+=2){if(v=c[f],o=c[f+1],typeof r===a){r={};for(u in o)t=o[u],typeof t===e?r[t[0]]=n:r[t]=n}for(s=y=0;s<v.length;s++)if(l=v[s].exec(this.getUA())){for(u=0;u<o.length;u++)i=l[++y],t=o[u],typeof t===e&&t.length>0?2==t.length?r[t[0]]=typeof t[1]==h?t[1].call(this,i):t[1]:3==t.length?r[t[0]]=typeof t[1]!==h||t[1].exec&&t[1].test?i?i.replace(t[1],t[2]):n:i?t[1].call(this,i,t[2]):n:4==t.length&&(r[t[0]]=i?t[3].call(this,i.replace(t[1],t[2])):n):r[t]=i?i:n;break}if(l)break}return r},str:function(t,i){var r,u;for(r in i)if(typeof i[r]===e&&i[r].length>0){for(u=0;u<i[r].length;u++)if(c.has(i[r][u],t))return r===s?n:r}else if(c.has(i[r],t))return r===s?n:r;return t}},f={browser:{oldsafari:{major:{1:["/8","/1","/3"],2:"/4","?":"/"},version:{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}}},device:{sprint:{model:{"Evo Shift 4G":"7373KT"},vendor:{HTC:"APA",Sprint:"Sprint"}}},os:{windows:{version:{ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",RT:"ARM"}}}},o={browser:[[/(opera\smini)\/((\d+)?[\w\.-]+)/i,/(opera\s[mobiletab]+).+version\/((\d+)?[\w\.-]+)/i,/(opera).+version\/((\d+)?[\w\.]+)/i,/(opera)[\/\s]+((\d+)?[\w\.]+)/i],[t,i,r],[/\s(opr)\/((\d+)?[\w\.]+)/i],[[t,"Opera"],i,r],[/(kindle)\/((\d+)?[\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/\s]?((\d+)?[\w\.]+)*/i,/(avant\s|iemobile|slim|baidu)(?:browser)?[\/\s]?((\d+)?[\w\.]*)/i,/(?:ms|\()(ie)\s((\d+)?[\w\.]+)/i,/(rekonq)((?:\/)[\w\.]+)*/i,/(chromium|flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron)\/((\d+)?[\w\.-]+)/i],[t,i,r],[/(trident).+rv[:\s]((\d+)?[\w\.]+).+like\sgecko/i],[[t,"IE"],i,r],[/(yabrowser)\/((\d+)?[\w\.]+)/i],[[t,"Yandex"],i,r],[/(comodo_dragon)\/((\d+)?[\w\.]+)/i],[[t,/_/g," "],i,r],[/(chrome|omniweb|arora|[tizenoka]{5}\s?browser)\/v?((\d+)?[\w\.]+)/i],[t,i,r],[/(dolfin)\/((\d+)?[\w\.]+)/i],[[t,"Dolphin"],i,r],[/((?:android.+)crmo|crios)\/((\d+)?[\w\.]+)/i],[[t,"Chrome"],i,r],[/((?:android.+))version\/((\d+)?[\w\.]+)\smobile\ssafari/i],[[t,"Android Browser"],i,r],[/version\/((\d+)?[\w\.]+).+?mobile\/\w+\s(safari)/i],[i,r,[t,"Mobile Safari"]],[/version\/((\d+)?[\w\.]+).+?(mobile\s?safari|safari)/i],[i,r,t],[/webkit.+?(mobile\s?safari|safari)((\/[\w\.]+))/i],[t,[r,u.str,f.browser.oldsafari.major],[i,u.str,f.browser.oldsafari.version]],[/(konqueror)\/((\d+)?[\w\.]+)/i,/(webkit|khtml)\/((\d+)?[\w\.]+)/i],[t,i,r],[/(navigator|netscape)\/((\d+)?[\w\.-]+)/i],[[t,"Netscape"],i,r],[/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo\sbrowser|minimo|conkeror)[\/\s]?((\d+)?[\w\.\+]+)/i,/(firefox|seamonkey|k-meleon|icecat|iceape|firebird|phoenix)\/((\d+)?[\w\.-]+)/i,/(mozilla)\/((\d+)?[\w\.]+).+rv\:.+gecko\/\d+/i,/(uc\s?browser|polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|qqbrowser)[\/\s]?((\d+)?[\w\.]+)/i,/(links)\s\(((\d+)?[\w\.]+)/i,/(gobrowser)\/?((\d+)?[\w\.]+)*/i,/(ice\s?browser)\/v?((\d+)?[\w\._]+)/i,/(mosaic)[\/\s]((\d+)?[\w\.]+)/i],[t,i,r]],engine:[[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m)\/([\w\.]+)/i,/(khtml|tasman|links)[\/\s]\(?([\w\.]+)/i,/(icab)[\/\s]([23]\.[\d\.]+)/i],[t,i],[/rv\:([\w\.]+).*(gecko)/i],[i,t]],os:[[/(windows)\snt\s6\.2;\s(arm)/i,/(windows\sphone(?:\sos)*|windows\smobile|windows)[\s\/]?([ntce\d\.\s]+\w)/i],[t,[i,u.str,f.os.windows.version]],[/(win(?=3|9|n)|win\s9x\s)([nt\d\.]+)/i],[[t,"Windows"],[i,u.str,f.os.windows.version]],[/\((bb)(10);/i],[[t,"BlackBerry"],i],[/(blackberry)\w*\/?([\w\.]+)*/i,/(tizen)\/([\w\.]+)/i,/(android|webos|palm\os|qnx|bada|rim\stablet\sos|meego)[\/\s-]?([\w\.]+)*/i],[t,i],[/(symbian\s?os|symbos|s60(?=;))[\/\s-]?([\w\.]+)*/i],[[t,"Symbian"],i],[/mozilla.+\(mobile;.+gecko.+firefox/i],[[t,"Firefox OS"],i],[/(nintendo|playstation)\s([wids3portablevu]+)/i,/(mint)[\/\s\(]?(\w+)*/i,/(joli|[kxln]?ubuntu|debian|[open]*suse|gentoo|arch|slackware|fedora|mandriva|centos|pclinuxos|redhat|zenwalk)[\/\s-]?([\w\.-]+)*/i,/(hurd|linux)\s?([\w\.]+)*/i,/(gnu)\s?([\w\.]+)*/i],[t,i],[/(cros)\s[\w]+\s([\w\.]+\w)/i],[[t,"Chromium OS"],i],[/(sunos)\s?([\w\.]+\d)*/i],[[t,"Solaris"],i],[/\s([frentopc-]{0,4}bsd|dragonfly)\s?([\w\.]+)*/i],[t,i],[/(ip[honead]+)(?:.*os\s*([\w]+)*\slike\smac|;\sopera)/i],[[t,"iOS"],[i,/_/g,"."]],[/(mac\sos\sx)\s?([\w\s\.]+\w)*/i],[t,[i,/_/g,"."]],[/(haiku)\s(\w+)/i,/(aix)\s((\d)(?=\.|\)|\s)[\w\.]*)*/i,/(macintosh|mac(?=_powerpc)|plan\s9|minix|beos|os\/2|amigaos|morphos|risc\sos)/i,/(unix)\s?([\w\.]+)*/i],[t,i]]},v=function(n){var t=n||(window&&window.navigator&&window.navigator.userAgent?window.navigator.userAgent:l);this.getBrowser=function(){return u.rgx.apply(this,o.browser)};this.getEngine=function(){return u.rgx.apply(this,o.engine)};this.getOS=function(){return u.rgx.apply(this,o.os)};this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS()}};this.getUA=function(){return t};this.setUA=function(n){return t=n,this};this.setUA(t)};return(new v).getResult()}(),u=function(){var i={define_property:function(){return!1}(),create_canvas:function(){var n=document.createElement("canvas");return!(!n.getContext||!n.getContext("2d"))}(),return_response_type:function(t){try{if(-1!==n.inArray(t,["","text","document"]))return!0;if(window.XMLHttpRequest){var i=new XMLHttpRequest;if(i.open("get","/"),"responseType"in i)return i.responseType=t,i.responseType!==t?!1:!0}}catch(r){}return!1},use_data_uri:function(){var n=new Image;return n.onload=function(){i.use_data_uri=1===n.width&&1===n.height},setTimeout(function(){n.src="data:image/gif;base64,R0lGODlhAQABAIAAAP8AAAAAACH5BAAAAAAALAAAAAABAAEAAAICRAEAOw=="},1),!1}(),use_data_uri_over32kb:function(){return i.use_data_uri&&("IE"!==t.browser||t.version>=9)},use_data_uri_of:function(n){return i.use_data_uri&&33e3>n||i.use_data_uri_over32kb()},use_fileinput:function(){var n=document.createElement("input");return n.setAttribute("type","file"),!n.disabled}};return function(t){var r=[].slice.call(arguments);return r.shift(),"function"===n.typeOf(i[t])?i[t].apply(this,r):!!i[t]}}(),t={can:u,browser:i.browser.name,version:parseFloat(i.browser.major),os:i.os.name,osVersion:i.os.version,verComp:r,swf_url:"../flash/Moxie.swf",xap_url:"../silverlight/Moxie.xap",global_event_dispatcher:"moxie.core.EventTarget.instance.dispatchEvent"};return t.OS=t.os,t});i(o,[e],function(n){var i=function(n){return"string"!=typeof n?n:document.getElementById(n)},t=function(n,t){if(!n.className)return!1;var i=new RegExp("(^|\\s+)"+t+"(\\s+|$)");return i.test(n.className)},r=function(n,i){t(n,i)||(n.className=n.className?n.className.replace(/\s+$/,"")+" "+i:i)},u=function(n,t){if(n.className){var i=new RegExp("(^|\\s+)"+t+"(\\s+|$)");n.className=n.className.replace(i,function(n,t,i){return" "===t&&" "===i?" ":""})}},f=function(n,t){return n.currentStyle?n.currentStyle[t]:window.getComputedStyle?window.getComputedStyle(n,null)[t]:void 0},e=function(t,i){function h(n){var t,i,r=0,f=0;return n&&(i=n.getBoundingClientRect(),t="CSS1Compat"===u.compatMode?u.documentElement:u.body,r=i.left+t.scrollLeft,f=i.top+t.scrollTop),{x:r,y:f}}var f=0,e=0,r,u=document,o,s;if(t=t,i=i||u.body,t&&t.getBoundingClientRect&&"IE"===n.browser&&(!u.documentMode||u.documentMode<8))return o=h(t),s=h(i),{x:o.x-s.x,y:o.y-s.y};for(r=t;r&&r!=i&&r.nodeType;)f+=r.offsetLeft||0,e+=r.offsetTop||0,r=r.offsetParent;for(r=t.parentNode;r&&r!=i&&r.nodeType;)f-=r.scrollLeft||0,e-=r.scrollTop||0,r=r.parentNode;return{x:f,y:e}},o=function(n){return{w:n.offsetWidth||n.clientWidth,h:n.offsetHeight||n.clientHeight}};return{get:i,hasClass:t,addClass:r,removeClass:u,getStyle:f,getPos:e,getSize:o}});i(u,[r],function(n){function t(n,t){var i;for(i in n)if(n[i]===t)return i;return null}return{RuntimeError:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": RuntimeError "+this.code}var r={NOT_INIT_ERR:1,NOT_SUPPORTED_ERR:9,JS_ERR:4};return n.extend(i,r),i.prototype=Error.prototype,i}(),OperationNotAllowedException:function(){function t(n){this.code=n;this.name="OperationNotAllowedException"}return n.extend(t,{NOT_ALLOWED_ERR:1}),t.prototype=Error.prototype,t}(),ImageError:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": ImageError "+this.code}var r={WRONG_FORMAT:1,MAX_RESOLUTION_ERR:2};return n.extend(i,r),i.prototype=Error.prototype,i}(),FileException:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": FileException "+this.code}var r={NOT_FOUND_ERR:1,SECURITY_ERR:2,ABORT_ERR:3,NOT_READABLE_ERR:4,ENCODING_ERR:5,NO_MODIFICATION_ALLOWED_ERR:6,INVALID_STATE_ERR:7,SYNTAX_ERR:8};return n.extend(i,r),i.prototype=Error.prototype,i}(),DOMException:function(){function i(n){this.code=n;this.name=t(r,n);this.message=this.name+": DOMException "+this.code}var r={INDEX_SIZE_ERR:1,DOMSTRING_SIZE_ERR:2,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,INVALID_CHARACTER_ERR:5,NO_DATA_ALLOWED_ERR:6,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INUSE_ATTRIBUTE_ERR:10,INVALID_STATE_ERR:11,SYNTAX_ERR:12,INVALID_MODIFICATION_ERR:13,NAMESPACE_ERR:14,INVALID_ACCESS_ERR:15,VALIDATION_ERR:16,TYPE_MISMATCH_ERR:17,SECURITY_ERR:18,NETWORK_ERR:19,ABORT_ERR:20,URL_MISMATCH_ERR:21,QUOTA_EXCEEDED_ERR:22,TIMEOUT_ERR:23,INVALID_NODE_TYPE_ERR:24,DATA_CLONE_ERR:25};return n.extend(i,r),i.prototype=Error.prototype,i}(),EventException:function(){function t(n){this.code=n;this.name="EventException"}return n.extend(t,{UNSPECIFIED_EVENT_TYPE_ERR:0}),t.prototype=Error.prototype,t}()}});i(c,[u,r],function(n,t){function i(){var i={};t.extend(this,{uid:null,init:function(){this.uid||(this.uid=t.guid("uid_"))},addEventListener:function(n,r,u,f){var o=this,e;return n=t.trim(n),/\s/.test(n)?void t.each(n.split(/\s+/),function(n){o.addEventListener(n,r,u,f)}):(n=n.toLowerCase(),u=parseInt(u,10)||0,e=i[this.uid]&&i[this.uid][n]||[],e.push({fn:r,priority:u,scope:f||this}),i[this.uid]||(i[this.uid]={}),void(i[this.uid][n]=e))},hasEventListener:function(n){return n?!(!i[this.uid]||!i[this.uid][n]):!!i[this.uid]},removeEventListener:function(n,r){n=n.toLowerCase();var u=i[this.uid]&&i[this.uid][n],f;if(u){if(r){for(f=u.length-1;f>=0;f--)if(u[f].fn===r){u.splice(f,1);break}}else u=[];u.length||(delete i[this.uid][n],t.isEmptyObj(i[this.uid])&&delete i[this.uid])}},removeAllEventListeners:function(){i[this.uid]&&delete i[this.uid]},dispatchEvent:function(r){var o,h,f,u,e={},c=!0,l,s;if("string"!==t.typeOf(r)){if(u=r,"string"!==t.typeOf(u.type))throw new n.EventException(n.EventException.UNSPECIFIED_EVENT_TYPE_ERR);r=u.type;u.total!==l&&u.loaded!==l&&(e.total=u.total,e.loaded=u.loaded);e.async=u.async||!1}return(-1!==r.indexOf("::")?!function(n){o=n[0];r=n[1]}(r.split("::")):o=this.uid,r=r.toLowerCase(),h=i[o]&&i[o][r])&&(h.sort(function(n,t){return t.priority-n.priority}),f=[].slice.call(arguments),f.shift(),e.type=r,f.unshift(e),s=[],t.each(h,function(n){f[0].target=n.scope;s.push(e.async?function(t){setTimeout(function(){t(n.fn.apply(n.scope,f)===!1)},1)}:function(t){t(n.fn.apply(n.scope,f)===!1)})}),s.length&&t.inSeries(s,function(n){c=!n})),c},bind:function(){this.addEventListener.apply(this,arguments)},unbind:function(){this.removeEventListener.apply(this,arguments)},unbindAll:function(){this.removeAllEventListeners.apply(this,arguments)},trigger:function(){return this.dispatchEvent.apply(this,arguments)},convertEventPropsToHandlers:function(n){var i,r;for("array"!==t.typeOf(n)&&(n=[n]),r=0;r<n.length;r++)i="on"+n[r],"function"===t.typeOf(this[i])?this.addEventListener(n[r],this[i]):"undefined"===t.typeOf(this[i])&&(this[i]=null)}})}return i.instance=new i,i});i(s,[],function(){var t=function(n){return unescape(encodeURIComponent(n))},n=function(n){return decodeURIComponent(escape(n))},i=function(t,i){if("function"==typeof window.atob)return i?n(window.atob(t)):window.atob(t);var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f,o,l,a,v,s,h,e,r=0,p=0,c="",y=[];if(!t)return t;t+="";do a=u.indexOf(t.charAt(r++)),v=u.indexOf(t.charAt(r++)),s=u.indexOf(t.charAt(r++)),h=u.indexOf(t.charAt(r++)),e=a<<18|v<<12|s<<6|h,f=e>>16&255,o=e>>8&255,l=255&e,y[p++]=64==s?String.fromCharCode(f):64==h?String.fromCharCode(f,o):String.fromCharCode(f,o,l);while(r<t.length);return c=y.join(""),i?n(c):c},r=function(n,i){var e;if(i&&t(n),"function"==typeof window.btoa)return window.btoa(n);var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",s,h,c,l,a,v,y,r,f=0,w=0,o="",p=[];if(!n)return n;do s=n.charCodeAt(f++),h=n.charCodeAt(f++),c=n.charCodeAt(f++),r=s<<16|h<<8|c,l=r>>18&63,a=r>>12&63,v=r>>6&63,y=63&r,p[w++]=u.charAt(l)+u.charAt(a)+u.charAt(v)+u.charAt(y);while(f<n.length);return o=p.join(""),e=n.length%3,(e?o.slice(0,e-3):o)+"===".slice(e||3)};return{utf8_encode:t,utf8_decode:n,atob:i,btoa:r}});i(l,[r,o,c],function(n,t,i){function r(i,f,e,o,s){var h=this,c,l=n.guid(f+"_"),a=s||"browser";i=i||{};u[l]=this;e=n.extend({access_binary:!1,access_image_binary:!1,display_media:!1,do_cors:!1,drag_and_drop:!1,filter_by_extension:!0,resize_image:!1,report_upload_progress:!1,return_response_headers:!1,return_response_type:!1,return_status_code:!0,send_custom_headers:!1,select_file:!1,select_folder:!1,select_multiple:!0,send_binary_string:!1,send_browser_cookies:!0,send_multipart:!0,slice_blob:!1,stream_upload:!1,summon_file_dialog:!1,upload_filesize:!0,use_http_method:!0},e);i.preferred_caps&&(a=r.getMode(o,i.preferred_caps,a));c=function(){var t={};return{exec:function(n,i,r,u){if(c[i]&&(t[n]||(t[n]={context:this,instance:new c[i]}),t[n].instance[r]))return t[n].instance[r].apply(this,u)},removeInstance:function(n){delete t[n]},removeAllInstances:function(){var i=this;n.each(t,function(t,r){"function"===n.typeOf(t.instance.destroy)&&t.instance.destroy.call(t.context);i.removeInstance(r)})}}}();n.extend(this,{initialized:!1,uid:l,type:f,mode:r.getMode(o,i.required_caps,a),shimid:l+"_container",clients:0,options:i,can:function(t,i){var u=arguments[2]||e,f;if("string"===n.typeOf(t)&&"undefined"===n.typeOf(i)&&(t=r.parseCaps(t)),"object"===n.typeOf(t)){for(f in t)if(!this.can(f,t[f],u))return!1;return!0}return"function"===n.typeOf(u[t])?u[t].call(this,i):i===u[t]},getShimContainer:function(){var r,i=t.get(this.shimid);return i||(r=this.options.container?t.get(this.options.container):document.body,i=document.createElement("div"),i.id=this.shimid,i.className="moxie-shim moxie-shim-"+this.type,n.extend(i.style,{position:"absolute",top:"0px",left:"0px",width:"1px",height:"1px",overflow:"hidden"}),r.appendChild(i),r=null),i},getShim:function(){return c},shimExec:function(n,t){var i=[].slice.call(arguments,2);return h.getShim().exec.call(this,this.uid,n,t,i)},exec:function(n,t){var i=[].slice.call(arguments,2);return h[n]&&h[n][t]?h[n][t].apply(this,i):h.shimExec.apply(this,arguments)},destroy:function(){if(h){var n=t.get(this.shimid);n&&n.parentNode.removeChild(n);c&&c.removeAllInstances();this.unbindAll();delete u[this.uid];this.uid=null;l=h=c=n=null}}});this.mode&&i.required_caps&&!this.can(i.required_caps)&&(this.mode=!1)}var f={},u={};return r.order="html5,flash,silverlight,html4",r.getRuntime=function(n){return u[n]?u[n]:!1},r.addConstructor=function(n,t){t.prototype=i.instance;f[n]=t},r.getConstructor=function(n){return f[n]||null},r.getInfo=function(n){var t=r.getRuntime(n);return t?{uid:t.uid,type:t.type,mode:t.mode,can:function(){return t.can.apply(t,arguments)}}:null},r.parseCaps=function(t){var i={};return"string"!==n.typeOf(t)?t||{}:(n.each(t.split(","),function(n){i[n]=!0}),i)},r.can=function(n,t){var i,u=r.getConstructor(n),f;return u?(i=new u({required_caps:t}),f=i.mode,i.destroy(),!!f):!1},r.thatCan=function(n,t){var i=(t||r.order).split(/\s*,\s*/),u;for(u in i)if(r.can(i[u],n))return i[u];return null},r.getMode=function(t,i,r){var u=null;if("undefined"===n.typeOf(r)&&(r="browser"),i&&!n.isEmptyObj(t)){if(n.each(i,function(i,r){if(t.hasOwnProperty(r)){var f=t[r](i);if("string"==typeof f&&(f=[f]),u){if(!(u=n.arrayIntersect(u,f)))return u=!1}else u=f}}),u)return-1!==n.inArray(r,u)?r:u[0];if(u===!1)return!1}return r},r.capTrue=function(){return!0},r.capFalse=function(){return!1},r.capTest=function(n){return function(){return!!n}},r});i(a,[u,r,l],function(n,t,i){return function(){var r;t.extend(this,{connectRuntime:function(u){function e(t){var f,s;return t.length?(f=t.shift(),(s=i.getConstructor(f))?(r=new s(u),r.bind("Init",function(){r.initialized=!0;setTimeout(function(){r.clients++;o.trigger("RuntimeInit",r)},1)}),r.bind("Error",function(){r.destroy();e(t)}),r.mode?void r.init():void r.trigger("Error")):void e(t)):(o.trigger("RuntimeError",new n.RuntimeError(n.RuntimeError.NOT_INIT_ERR)),void(r=null))}var o=this,f;if("string"===t.typeOf(u)?f=u:"string"===t.typeOf(u.ruid)&&(f=u.ruid),f){if(r=i.getRuntime(f))return r.clients++,r;throw new n.RuntimeError(n.RuntimeError.NOT_INIT_ERR);}e((u.runtime_order||i.order).split(/\s*,\s*/))},getRuntime:function(){return r&&r.uid?r:(r=null,null)},disconnectRuntime:function(){r&&--r.clients<=0&&(r.destroy(),r=null)}})}});i(f,[r,s,a],function(n,t,i){function u(f,e){function o(t,i,f){var e,o=r[this.uid];return"string"===n.typeOf(o)&&o.length?(e=new u(null,{type:f,size:i-t}),e.detach(o.substr(t,e.size)),e):null}i.call(this);f&&this.connectRuntime(f);e?"string"===n.typeOf(e)&&(e={data:e}):e={};n.extend(this,{uid:e.uid||n.guid("uid_"),ruid:f,size:e.size||0,type:e.type||"",slice:function(n,t,i){return this.isDetached()?o.apply(this,arguments):this.getRuntime().exec.call(this,"Blob","slice",this.getSource(),n,t,i)},getSource:function(){return r[this.uid]?r[this.uid]:null},detach:function(n){this.ruid&&(this.getRuntime().exec.call(this,"Blob","destroy"),this.disconnectRuntime(),this.ruid=null);n=n||"";var i=n.match(/^data:([^;]*);base64,/);i&&(this.type=i[1],n=t.atob(n.substring(n.indexOf("base64,")+7)));this.size=n.length;r[this.uid]=n},isDetached:function(){return!this.ruid&&"string"===n.typeOf(r[this.uid])},destroy:function(){this.detach();delete r[this.uid]}});e.data?this.detach(e.data):r[this.uid]=e}var r={};return u});i(v,[r,h,f],function(n,t,i){function r(r,u){var f,e,o;(u||(u={}),e=u.type&&""!==u.type?u.type:t.getFileMime(u.name),u.name)?(f=u.name.replace(/\\/g,"/"),f=f.substr(f.lastIndexOf("/")+1)):(o=e.split("/")[0],f=n.guid((""!==o?o:"file")+"_"),t.extensions[e]&&(f+="."+t.extensions[e][0]));i.apply(this,arguments);n.extend(this,{type:e||"",name:f||n.guid("file_"),lastModifiedDate:u.lastModifiedDate||(new Date).toLocaleString()})}return r.prototype=i.prototype,r});i(ot,[r,h,o,u,c,g,v,l,a],function(n,t,i,r,u,f,e,o,s){function h(u){var h=this,l,a,v;if(-1!==n.inArray(n.typeOf(u),["string","node"])&&(u={browse_button:u}),a=i.get(u.browse_button),!a)throw new r.DOMException(r.DOMException.NOT_FOUND_ERR);v={accept:[{title:f.translate("All Files"),extensions:"*"}],name:"file",multiple:!1,required_caps:!1,container:a.parentNode||document.body};u=n.extend({},v,u);"string"==typeof u.required_caps&&(u.required_caps=o.parseCaps(u.required_caps));"string"==typeof u.accept&&(u.accept=t.mimes2extList(u.accept));l=i.get(u.container);l||(l=document.body);"static"===i.getStyle(l,"position")&&(l.style.position="relative");l=a=null;s.call(h);n.extend(h,{uid:n.guid("uid_"),ruid:null,shimid:null,files:null,init:function(){h.convertEventPropsToHandlers(c);h.bind("RuntimeInit",function(t,r){h.ruid=r.uid;h.shimid=r.shimid;h.bind("Ready",function(){h.trigger("Refresh")},999);h.bind("Change",function(){var t=r.exec.call(h,"FileInput","getFiles");h.files=[];n.each(t,function(n){return 0===n.size?!0:void h.files.push(new e(h.ruid,n))})},999);h.bind("Refresh",function(){var e,o,t,f;t=i.get(u.browse_button);f=i.get(r.shimid);t&&(e=i.getPos(t,i.get(u.container)),o=i.getSize(t),f&&n.extend(f.style,{top:e.y+"px",left:e.x+"px",width:o.w+"px",height:o.h+"px"}));f=t=null});r.exec.call(h,"FileInput","init",u)});h.connectRuntime(n.extend({},u,{required_caps:{select_file:!0}}))},disable:function(t){var i=this.getRuntime();i&&i.exec.call(this,"FileInput","disable","undefined"===n.typeOf(t)?!0:t)},refresh:function(){h.trigger("Refresh")},destroy:function(){var t=this.getRuntime();t&&(t.exec.call(this,"FileInput","destroy"),this.disconnectRuntime());"array"===n.typeOf(this.files)&&n.each(this.files,function(n){n.destroy()});this.files=null}})}var c=["ready","change","cancel","mouseenter","mouseleave","mousedown","mouseup"];return h.prototype=u.instance,h});i(st,[g,o,u,r,v,a,c,h],function(n,t,i,r,u,f,e,o){function s(i){var e=this,s;"string"==typeof i&&(i={drop_zone:i});s={accept:[{title:n.translate("All Files"),extensions:"*"}],required_caps:{drag_and_drop:!0}};i="object"==typeof i?r.extend({},s,i):s;i.container=t.get(i.drop_zone)||document.body;"static"===t.getStyle(i.container,"position")&&(i.container.style.position="relative");"string"==typeof i.accept&&(i.accept=o.mimes2extList(i.accept));f.call(e);r.extend(e,{uid:r.guid("uid_"),ruid:null,files:null,init:function(){e.convertEventPropsToHandlers(h);e.bind("RuntimeInit",function(n,t){e.ruid=t.uid;e.bind("Drop",function(){var n=t.exec.call(e,"FileDrop","getFiles");e.files=[];r.each(n,function(n){e.files.push(new u(e.ruid,n))})},999);t.exec.call(e,"FileDrop","init",i);e.dispatchEvent("ready")});e.connectRuntime(i)},destroy:function(){var n=this.getRuntime();n&&(n.exec.call(this,"FileDrop","destroy"),this.disconnectRuntime());this.files=null}})}var h=["ready","dragenter","dragleave","drop","error"];return s.prototype=e.instance,s});i(ft,[r,a,c],function(n,t,i){function r(){this.uid=n.guid("uid_");t.call(this);this.destroy=function(){this.disconnectRuntime();this.unbindAll()}}return r.prototype=i.instance,r});i(ht,[r,s,u,c,f,v,ft],function(n,t,i,r,u,f,e){function o(){function h(n,h){function c(n){f.readyState=o.DONE;f.error=n;f.trigger("error");l()}function l(){r.destroy();r=null;f.trigger("loadend")}function v(t){r.bind("Error",function(n,t){c(t)});r.bind("Progress",function(n){f.result=t.exec.call(r,"FileReader","getResult");f.trigger(n)});r.bind("Load",function(n){f.readyState=o.DONE;f.result=t.exec.call(r,"FileReader","getResult");f.trigger(n);l()});t.exec.call(r,"FileReader","read",n,h)}if(r=new e,this.convertEventPropsToHandlers(s),this.readyState===o.LOADING)return c(new i.DOMException(i.DOMException.INVALID_STATE_ERR));if(this.readyState=o.LOADING,this.trigger("loadstart"),h instanceof u)if(h.isDetached()){var a=h.getSource();switch(n){case"readAsText":case"readAsBinaryString":this.result=a;break;case"readAsDataURL":this.result="data:"+h.type+";base64,"+t.btoa(a)}this.readyState=o.DONE;this.trigger("load");l()}else v(r.connectRuntime(h.ruid));else c(new i.DOMException(i.DOMException.NOT_FOUND_ERR))}var f=this,r;n.extend(this,{uid:n.guid("uid_"),readyState:o.EMPTY,result:null,error:null,readAsBinaryString:function(n){h.call(this,"readAsBinaryString",n)},readAsDataURL:function(n){h.call(this,"readAsDataURL",n)},readAsText:function(n){h.call(this,"readAsText",n)},abort:function(){this.result=null;-1===n.inArray(this.readyState,[o.EMPTY,o.DONE])&&(this.readyState===o.LOADING&&(this.readyState=o.DONE),r&&r.getRuntime().exec.call(this,"FileReader","abort"),this.trigger("abort"),this.trigger("loadend"))},destroy:function(){this.abort();r&&(r.getRuntime().exec.call(this,"FileReader","destroy"),r.disconnectRuntime());f=r=null}})}var s=["loadstart","progress","load","abort","error","loadend"];return o.EMPTY=0,o.LOADING=1,o.DONE=2,o.prototype=r.instance,o});i(nt,[],function(){var n=function(t,i){for(var u,e=["source","scheme","authority","userInfo","user","pass","host","port","relative","path","directory","file","query","fragment"],f=e.length,r={},o=/^(?:([^:\/?#]+):)?(?:\/\/()(?:(?:()(?:([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?()(?:(()(?:(?:[^?#\/]*\/)*)()(?:[^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/.exec(t||"");f--;)o[f]&&(r[e[f]]=o[f]);return r.scheme||(i&&"string"!=typeof i||(i=n(i||document.location.href)),r.scheme=i.scheme,r.host=i.host,r.port=i.port,u="",/^[^\/]/.test(r.path)&&(u=i.path,/(\/|\/[^\.]+)$/.test(u)?u+="/":u=u.replace(/\/[^\/]+$/,"/")),r.path=u+(r.path||"")),r.port||(r.port={http:80,https:443}[r.scheme]||80),r.port=parseInt(r.port,10),r.path||(r.path="/"),delete r.source,r},t=function(t){var i=n(t);return i.scheme+"://"+i.host+(i.port!=={http:80,https:443}[i.scheme]?":"+i.port:"")+i.path+(i.query?i.query:"")},i=function(t){function i(n){return[n.scheme,n.host,n.port].join("/")}return"string"==typeof t&&(t=n(t)),i(n())===i(t)};return{parseUrl:n,resolveUrl:t,hasSameOrigin:i}});i(k,[r,a,s],function(n,t,i){return function(){function r(n,t){var f,r;if(!t.isDetached())return f=this.connectRuntime(t.ruid).exec.call(this,"FileReaderSync","read",n,t),this.disconnectRuntime(),f;r=t.getSource();switch(n){case"readAsBinaryString":return r;case"readAsDataURL":return"data:"+t.type+";base64,"+i.btoa(r);case"readAsText":for(var e="",u=0,o=r.length;o>u;u++)e+=String.fromCharCode(r[u]);return e}}t.call(this);n.extend(this,{uid:n.guid("uid_"),readAsBinaryString:function(n){return r.call(this,"readAsBinaryString",n)},readAsDataURL:function(n){return r.call(this,"readAsDataURL",n)},readAsText:function(n){return r.call(this,"readAsText",n)}})}});i(d,[u,r,f],function(n,t,i){function r(){var n,r=[];t.extend(this,{append:function(u,f){var o=this,e=t.typeOf(f);f instanceof i?n={name:u,value:f}:"array"===e?(u+="[]",t.each(f,function(n){o.append(u,n)})):"object"===e?t.each(f,function(n,t){o.append(u+"["+t+"]",n)}):"null"===e||"undefined"===e||"number"===e&&isNaN(f)?o.append(u,"false"):r.push({name:u,value:f.toString()})},hasBlob:function(){return!!this.getBlob()},getBlob:function(){return n&&n.value||null},getBlobName:function(){return n&&n.name||null},each:function(i){t.each(r,function(n){i(n.value,n.name)});n&&i(n.value,n.name)},destroy:function(){n=null;r=[]}})}return r});i(et,[r,u,c,s,nt,l,ft,f,k,d,e,h],function(n,t,i,r,u,f,e,o,s,h,c,l){function v(){this.uid=n.guid("uid_")}function a(){function i(n,t){if(tt.hasOwnProperty(n))return 1===arguments.length?c.can("define_property")?tt[n]:ht[n]:void(c.can("define_property")?tt[n]=t:ht[n]=t)}function pt(t){function u(){s&&(s.destroy(),s=null);r.dispatchEvent("loadend");r=null}function o(f){s.bind("LoadStart",function(n){i("readyState",a.LOADING);r.dispatchEvent("readystatechange");r.dispatchEvent(n);ft&&r.upload.dispatchEvent(n)});s.bind("Progress",function(n){i("readyState")!==a.LOADING&&(i("readyState",a.LOADING),r.dispatchEvent("readystatechange"));r.dispatchEvent(n)});s.bind("UploadProgress",function(n){ft&&r.upload.dispatchEvent({type:"progress",lengthComputable:!1,total:n.total,loaded:n.loaded})});s.bind("Load",function(t){i("readyState",a.DONE);i("status",Number(f.exec.call(s,"XMLHttpRequest","getStatus")||0));i("statusText",p[i("status")]||"");i("response",f.exec.call(s,"XMLHttpRequest","getResponse",i("responseType")));~n.inArray(i("responseType"),["text",""])?i("responseText",i("response")):"document"===i("responseType")&&i("responseXML",i("response"));nt=f.exec.call(s,"XMLHttpRequest","getAllResponseHeaders");r.dispatchEvent("readystatechange");i("status")>0?(ft&&r.upload.dispatchEvent(t),r.dispatchEvent(t)):(g=!0,r.dispatchEvent("error"));u()});s.bind("Abort",function(n){r.dispatchEvent(n);u()});s.bind("Error",function(n){g=!0;i("readyState",a.DONE);r.dispatchEvent("readystatechange");et=!0;r.dispatchEvent(n);u()});f.exec.call(s,"XMLHttpRequest","send",{url:ct,method:st,async:it,user:lt,password:at,headers:k,mimeType:rt,encoding:vt,responseType:r.responseType,withCredentials:r.withCredentials,options:w},t)}var r=this;yt=(new Date).getTime();s=new e;"string"==typeof w.required_caps&&(w.required_caps=f.parseCaps(w.required_caps));w.required_caps=n.extend({},w.required_caps,{return_response_type:r.responseType});t instanceof h&&(w.required_caps.send_multipart=!0);ot||(w.required_caps.do_cors=!0);w.ruid?o(s.connectRuntime(w)):(s.bind("RuntimeInit",function(n,t){o(t)}),s.bind("RuntimeError",function(n,t){r.dispatchEvent("RuntimeError",t)}),s.connectRuntime(w))}function wt(){i("responseText","");i("responseXML",null);i("response",null);i("status",0);i("statusText","");yt=bt=null}var ht=this,tt={timeout:0,readyState:a.UNSENT,withCredentials:!1,status:0,statusText:"",responseType:"",responseXML:null,responseText:null,response:null},it=!0,ct,st,k={},lt,at,vt=null,rt=null,ut=!1,d=!1,ft=!1,et=!1,g=!1,ot=!1,yt,bt,kt=null,dt=null,w={},s,nt="",b;n.extend(this,tt,{uid:n.guid("uid_"),upload:new v,open:function(f,e,o,s,h){var c;if(!f||!e)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(/[\u0100-\uffff]/.test(f)||r.utf8_encode(f)!==f)throw new t.DOMException(t.DOMException.SYNTAX_ERR);if(~n.inArray(f.toUpperCase(),["CONNECT","DELETE","GET","HEAD","OPTIONS","POST","PUT","TRACE","TRACK"])&&(st=f.toUpperCase()),~n.inArray(st,["CONNECT","TRACE","TRACK"]))throw new t.DOMException(t.DOMException.SECURITY_ERR);if(e=r.utf8_encode(e),c=u.parseUrl(e),ot=u.hasSameOrigin(c),ct=u.resolveUrl(e),(s||h)&&!ot)throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);if(lt=s||c.user,at=h||c.pass,it=o||!0,it===!1&&(i("timeout")||i("withCredentials")||""!==i("responseType")))throw new t.DOMException(t.DOMException.INVALID_ACCESS_ERR);ut=!it;d=!1;k={};wt.call(this);i("readyState",a.OPENED);this.convertEventPropsToHandlers(["readystatechange"]);this.dispatchEvent("readystatechange")},setRequestHeader:function(u,f){if(i("readyState")!==a.OPENED||d)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(/[\u0100-\uffff]/.test(u)||r.utf8_encode(u)!==u)throw new t.DOMException(t.DOMException.SYNTAX_ERR);return u=n.trim(u).toLowerCase(),~n.inArray(u,["accept-charset","accept-encoding","access-control-request-headers","access-control-request-method","connection","content-length","cookie","cookie2","content-transfer-encoding","date","expect","host","keep-alive","origin","referer","te","trailer","transfer-encoding","upgrade","user-agent","via"])||/^(proxy\-|sec\-)/.test(u)?!1:(k[u]?k[u]+=", "+f:k[u]=f,!0)},getAllResponseHeaders:function(){return nt||""},getResponseHeader:function(t){return t=t.toLowerCase(),g||~n.inArray(t,["set-cookie","set-cookie2"])?null:nt&&""!==nt&&(b||(b={},n.each(nt.split(/\r\n/),function(t){var i=t.split(/:\s+/);2===i.length&&(i[0]=n.trim(i[0]),b[i[0].toLowerCase()]={header:i[0],value:n.trim(i[1])})})),b.hasOwnProperty(t))?b[t].header+": "+b[t].value:null},overrideMimeType:function(r){var u,f;if(~n.inArray(i("readyState"),[a.LOADING,a.DONE]))throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(r=n.trim(r.toLowerCase()),/;/.test(r)&&(u=r.match(/^([^;]+)(?:;\scharset\=)?(.*)$/))&&(r=u[1],u[2]&&(f=u[2])),!l.mimes[r])throw new t.DOMException(t.DOMException.SYNTAX_ERR);kt=r;dt=f},send:function(i,u){if(w="string"===n.typeOf(u)?{ruid:u}:u?u:{},this.convertEventPropsToHandlers(y),this.upload.convertEventPropsToHandlers(y),this.readyState!==a.OPENED||d)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);if(i instanceof o)w.ruid=i.ruid,rt=i.type||"application/octet-stream";else if(i instanceof h){if(i.hasBlob()){var f=i.getBlob();w.ruid=f.ruid;rt=f.type||"application/octet-stream"}}else"string"==typeof i&&(vt="UTF-8",rt="text/plain;charset=UTF-8",i=r.utf8_encode(i));this.withCredentials||(this.withCredentials=w.required_caps&&w.required_caps.send_browser_cookies&&!ot);ft=!ut&&this.upload.hasEventListener();g=!1;et=!i;ut||(d=!0);pt.call(this,i)},abort:function(){if(g=!0,ut=!1,~n.inArray(i("readyState"),[a.UNSENT,a.OPENED,a.DONE]))i("readyState",a.UNSENT);else{if(i("readyState",a.DONE),d=!1,!s)throw new t.DOMException(t.DOMException.INVALID_STATE_ERR);s.getRuntime().exec.call(s,"XMLHttpRequest","abort",et);et=!0}},destroy:function(){s&&("function"===n.typeOf(s.destroy)&&s.destroy(),s=null);this.unbindAll();this.upload&&(this.upload.unbindAll(),this.upload=null)}})}var p={100:"Continue",101:"Switching Protocols",102:"Processing",200:"OK",201:"Created",202:"Accepted",203:"Non-Authoritative Information",204:"No Content",205:"Reset Content",206:"Partial Content",207:"Multi-Status",226:"IM Used",300:"Multiple Choices",301:"Moved Permanently",302:"Found",303:"See Other",304:"Not Modified",305:"Use Proxy",306:"Reserved",307:"Temporary Redirect",400:"Bad Request",401:"Unauthorized",402:"Payment Required",403:"Forbidden",404:"Not Found",405:"Method Not Allowed",406:"Not Acceptable",407:"Proxy Authentication Required",408:"Request Timeout",409:"Conflict",410:"Gone",411:"Length Required",412:"Precondition Failed",413:"Request Entity Too Large",414:"Request-URI Too Long",415:"Unsupported Media Type",416:"Requested Range Not Satisfiable",417:"Expectation Failed",422:"Unprocessable Entity",423:"Locked",424:"Failed Dependency",426:"Upgrade Required",500:"Internal Server Error",501:"Not Implemented",502:"Bad Gateway",503:"Service Unavailable",504:"Gateway Timeout",505:"HTTP Version Not Supported",506:"Variant Also Negotiates",507:"Insufficient Storage",510:"Not Extended"};v.prototype=i.instance;var y=["loadstart","progress","abort","error","load","timeout","loadend"];return a.UNSENT=0,a.OPENED=1,a.HEADERS_RECEIVED=2,a.LOADING=3,a.DONE=4,a.prototype=i.instance,a});i(tt,[r,s,a,c],function(n,t,i,r){function u(){function h(){f=e=0;o=this.result=null}function c(t,i){var s=this;r=i;s.bind("TransportingProgress",function(t){e=t.loaded;f>e&&-1===n.inArray(s.state,[u.IDLE,u.DONE])&&l.call(s)},999);s.bind("TransportingComplete",function(){e=f;s.state=u.DONE;o=null;s.result=r.exec.call(s,"Transporter","getAsBlob",t||"")},999);s.state=u.BUSY;s.trigger("TransportingStarted");l.call(s)}function l(){var u=this,n,i=f-e;s>i&&(s=i);n=t.btoa(o.substr(e,s));r.exec.call(u,"Transporter","receive",n,f)}var a,r,o,f,e,s;i.call(this);n.extend(this,{uid:n.guid("uid_"),state:u.IDLE,result:null,transport:function(t,i,r){var u=this,e;(r=n.extend({chunk_size:204798},r),(a=r.chunk_size%3)&&(r.chunk_size+=3-a),s=r.chunk_size,h.call(this),o=t,f=t.length,"string"===n.typeOf(r)||r.ruid)?c.call(u,i,this.connectRuntime(r)):(e=function(n,t){u.unbind("RuntimeInit",e);c.call(u,i,t)},this.bind("RuntimeInit",e),this.connectRuntime(r))},abort:function(){var n=this;n.state=u.IDLE;r&&(r.exec.call(n,"Transporter","clear"),n.trigger("TransportingAborted"));h.call(n)},destroy:function(){this.unbindAll();r=null;this.disconnectRuntime();h.call(this)}})}return u.IDLE=0,u.BUSY=1,u.DONE=2,u.prototype=r.instance,u});i(ct,[r,o,u,k,et,l,a,tt,e,c,f,v,s],function(n,t,i,r,u,f,e,o,s,h,c,l,a){function v(){function p(n){n||(n=this.getRuntime().exec.call(this,"Image","getInfo"));this.size=n.size;this.width=n.width;this.height=n.height;this.type=n.type;this.meta=n.meta;""===this.name&&(this.name=n.name)}function r(t){var u=n.typeOf(t);try{if(t instanceof v){if(!t.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);w.apply(this,arguments)}else if(t instanceof c){if(!~n.inArray(t.type,["image/jpeg","image/png"]))throw new i.ImageError(i.ImageError.WRONG_FORMAT);h.apply(this,arguments)}else if(-1!==n.inArray(u,["blob","file"]))r.call(this,new l(null,t),arguments[1]);else if("string"===u)/^data:[^;]*;base64,/.test(t)?r.call(this,new c(null,{data:t}),arguments[1]):b.apply(this,arguments);else{if("node"!==u||"img"!==t.nodeName.toLowerCase())throw new i.DOMException(i.DOMException.TYPE_MISMATCH_ERR);r.call(this,t.src,arguments[1])}}catch(f){this.trigger("error",f.code)}}function w(t,i){var r=this.connectRuntime(t.ruid);this.ruid=r.uid;r.exec.call(this,"Image","loadFromImage",t,"undefined"===n.typeOf(i)?!0:i)}function h(t,i){function u(n){r.ruid=n.uid;n.exec.call(r,"Image","loadFromBlob",t)}var r=this;r.name=t.name||"";t.isDetached()?(this.bind("RuntimeInit",function(n,t){u(t)}),i&&"string"==typeof i.required_caps&&(i.required_caps=f.parseCaps(i.required_caps)),this.connectRuntime(n.extend({required_caps:{access_image_binary:!0,resize_image:!0}},i))):u(this.connectRuntime(t.ruid))}function b(n,t){var r=this,i;i=new u;i.open("get",n);i.responseType="blob";i.onprogress=function(n){r.trigger(n)};i.onload=function(){h.call(r,i.response,!0)};i.onerror=function(n){r.trigger(n)};i.onloadend=function(){i.destroy()};i.bind("RuntimeError",function(n,t){r.trigger("RuntimeError",t)});i.send(null,t)}e.call(this);n.extend(this,{uid:n.guid("uid_"),ruid:null,name:"",size:0,width:0,height:0,type:"",meta:{},clone:function(){this.load.apply(this,arguments)},load:function(){this.bind("Load Resize",function(){p.call(this)},999);this.convertEventPropsToHandlers(y);r.apply(this,arguments)},downsize:function(t){var r={width:this.width,height:this.height,crop:!1,preserveHeaders:!0};t="object"==typeof t?n.extend(r,t):n.extend(r,{width:arguments[0],height:arguments[1],crop:arguments[2],preserveHeaders:arguments[3]});try{if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(this.width>v.MAX_RESIZE_WIDTH||this.height>v.MAX_RESIZE_HEIGHT)throw new i.ImageError(i.ImageError.MAX_RESOLUTION_ERR);this.getRuntime().exec.call(this,"Image","downsize",t.width,t.height,t.crop,t.preserveHeaders)}catch(u){this.trigger("error",u.code)}},crop:function(n,t,i){this.downsize(n,t,!0,i)},getAsCanvas:function(){if(!s.can("create_canvas"))throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR);var n=this.connectRuntime(this.ruid);return n.exec.call(this,"Image","getAsCanvas")},getAsBlob:function(n,t){if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);return n||(n="image/jpeg"),"image/jpeg"!==n||t||(t=90),this.getRuntime().exec.call(this,"Image","getAsBlob",n,t)},getAsDataURL:function(n,t){if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);return this.getRuntime().exec.call(this,"Image","getAsDataURL",n,t)},getAsBinaryString:function(n,t){var i=this.getAsDataURL(n,t);return a.atob(i.substring(i.indexOf("base64,")+7))},embed:function(r){function k(){var c,t,v;if(s.can("create_canvas")&&(c=u.getAsCanvas(),c))return r.appendChild(c),c=null,u.destroy(),void e.trigger("embedded");if(t=u.getAsDataURL(p,w),!t)throw new i.ImageError(i.ImageError.WRONG_FORMAT);s.can("use_data_uri_of",t.length)?(r.innerHTML='<img src="'+t+'" width="'+u.width+'" height="'+u.height+'" />',u.destroy(),e.trigger("embedded")):(v=new o,v.bind("TransportingComplete",function(){y=e.connectRuntime(this.result.ruid);e.bind("Embedded",function(){n.extend(y.getShimContainer().style,{top:"0px",left:"0px",width:u.width+"px",height:u.height+"px"});y=null},999);y.exec.call(e,"ImageView","display",this.result.uid,h,l);u.destroy()}),v.transport(a.atob(t.substring(t.indexOf("base64,")+7)),p,n.extend({},f,{required_caps:{display_media:!0},runtime_order:"flash,silverlight",container:r})))}var e=this,u,p,w,b,f=arguments[1]||{},h=this.width,l=this.height,y,c;try{if(!(r=t.get(r)))throw new i.DOMException(i.DOMException.INVALID_NODE_TYPE_ERR);if(!this.size)throw new i.DOMException(i.DOMException.INVALID_STATE_ERR);if(this.width>v.MAX_RESIZE_WIDTH||this.height>v.MAX_RESIZE_HEIGHT)throw new i.ImageError(i.ImageError.MAX_RESOLUTION_ERR);return(p=f.type||this.type||"image/jpeg",w=f.quality||90,b="undefined"!==n.typeOf(f.crop)?f.crop:!1,f.width)?(h=f.width,l=f.height||h):(c=t.getSize(r),c.w&&c.h&&(h=c.w,l=c.h)),u=new v,u.bind("Resize",function(){k.call(e)}),u.bind("Load",function(){u.downsize(h,l,b,!1)}),u.clone(this,!1),u}catch(d){this.trigger("error",d.code)}},destroy:function(){this.ruid&&(this.getRuntime().exec.call(this,"Image","destroy"),this.disconnectRuntime());this.unbindAll()}})}var y=["progress","load","error","resize","embedded"];return v.MAX_RESIZE_WIDTH=6500,v.MAX_RESIZE_HEIGHT=6500,v.prototype=h.instance,v});i(w,[r,u,l,e],function(n,t,i,r){function e(t){var o=this,e=i.capTest,s=i.capTrue,h=n.extend({access_binary:e(window.FileReader||window.File&&window.File.getAsDataURL),access_image_binary:function(){return o.can("access_binary")&&!!u.Image},display_media:e(r.can("create_canvas")||r.can("use_data_uri_over32kb")),do_cors:e(window.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest),drag_and_drop:e(function(){var n=document.createElement("div");return("draggable"in n||"ondragstart"in n&&"ondrop"in n)&&("IE"!==r.browser||r.version>9)}()),filter_by_extension:e(function(){return"Chrome"===r.browser&&r.version>=28||"IE"===r.browser&&r.version>=10}()),return_response_headers:s,return_response_type:function(n){return"json"===n&&window.JSON?!0:r.can("return_response_type",n)},return_status_code:s,report_upload_progress:e(window.XMLHttpRequest&&(new XMLHttpRequest).upload),resize_image:function(){return o.can("access_binary")&&r.can("create_canvas")},select_file:function(){return r.can("use_fileinput")&&window.File},select_folder:function(){return o.can("select_file")&&"Chrome"===r.browser&&r.version>=21},select_multiple:function(){return!(!o.can("select_file")||"Safari"===r.browser&&"Windows"===r.os||"iOS"===r.os&&r.verComp(r.osVersion,"7.0.4","<"))},send_binary_string:e(window.XMLHttpRequest&&((new XMLHttpRequest).sendAsBinary||window.Uint8Array&&window.ArrayBuffer)),send_custom_headers:e(window.XMLHttpRequest),send_multipart:function(){return!!(window.XMLHttpRequest&&(new XMLHttpRequest).upload&&window.FormData)||o.can("send_binary_string")},slice_blob:e(window.File&&(File.prototype.mozSlice||File.prototype.webkitSlice||File.prototype.slice)),stream_upload:function(){return o.can("slice_blob")&&o.can("send_multipart")},summon_file_dialog:e(function(){return"Firefox"===r.browser&&r.version>=4||"Opera"===r.browser&&r.version>=12||"IE"===r.browser&&r.version>=10||!!~n.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:s},arguments[2]);i.call(this,t,arguments[1]||f,h);n.extend(this,{init:function(){this.trigger("Init")},destroy:function(n){return function(){n.call(o);n=o=null}}(this.destroy)});n.extend(this.getShim(),u)}var f="html5",u={};return i.addConstructor(f,e),u});i("moxie/runtime/html5/file/Blob",[w,f],function(n,t){function i(){function n(n,t,i){var r;if(!window.File.prototype.slice)return(r=window.File.prototype.webkitSlice||window.File.prototype.mozSlice)?r.call(n,t,i):null;try{return n.slice(),n.slice(t,i)}catch(u){return n.slice(t,i-t)}}this.slice=function(){return new t(this.getRuntime().uid,n.apply(this,arguments))}}return n.Blob=i});i(b,[r],function(n){function u(){this.returnValue=!1}function f(){this.cancelBubble=!0}var i={},t="moxie_"+n.guid(),e=function(r,e,o,s){var h,c;e=e.toLowerCase();r.addEventListener?(h=o,r.addEventListener(e,h,!1)):r.attachEvent&&(h=function(){var n=window.event;n.target||(n.target=n.srcElement);n.preventDefault=u;n.stopPropagation=f;o(n)},r.attachEvent("on"+e,h));r[t]||(r[t]=n.guid());i.hasOwnProperty(r[t])||(i[r[t]]={});c=i[r[t]];c.hasOwnProperty(e)||(c[e]=[]);c[e].push({func:h,orig:o,key:s})},r=function(r,u,f){var e,s,o;if(u=u.toLowerCase(),r[t]&&i[r[t]]&&i[r[t]][u]){for(e=i[r[t]][u],o=e.length-1;o>=0&&(e[o].orig!==f&&e[o].key!==f||(r.removeEventListener?r.removeEventListener(u,e[o].func,!1):r.detachEvent&&r.detachEvent("on"+u,e[o].func),e[o].orig=null,e[o].func=null,e.splice(o,1),f===s));o--);if(e.length||delete i[r[t]][u],n.isEmptyObj(i[r[t]])){delete i[r[t]];try{delete r[t]}catch(h){r[t]=s}}}},o=function(u,f){u&&u[t]&&n.each(i[u[t]],function(n,t){r(u,t,f)})};return{addEvent:e,removeEvent:r,removeAllEvents:o}});i("moxie/runtime/html5/file/FileInput",[w,r,o,b,h,e],function(n,t,i,r,u,f){function e(){var e=[],n;t.extend(this,{init:function(o){var s=this,h=s.getRuntime(),v,l,y,c,p,a;n=o;e=[];y=n.accept.mimes||u.extList2mimes(n.accept,h.can("filter_by_extension"));l=h.getShimContainer();l.innerHTML='<input id="'+h.uid+'" type="file" style="font-size:999px;opacity:0;"'+(n.multiple&&h.can("select_multiple")?"multiple":"")+(n.directory&&h.can("select_folder")?"webkitdirectory directory":"")+(y?' accept="'+y.join(",")+'"':"")+" />";v=i.get(h.uid);t.extend(v.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});c=i.get(n.browse_button);h.can("summon_file_dialog")&&("static"===i.getStyle(c,"position")&&(c.style.position="relative"),p=parseInt(i.getStyle(c,"z-index"),10)||1,c.style.zIndex=p,l.style.zIndex=p-1,r.addEvent(c,"click",function(n){var t=i.get(h.uid);t&&!t.disabled&&t.click();n.preventDefault()},s.uid));a=h.can("summon_file_dialog")?c:l;r.addEvent(a,"mouseover",function(){s.trigger("mouseenter")},s.uid);r.addEvent(a,"mouseout",function(){s.trigger("mouseleave")},s.uid);r.addEvent(a,"mousedown",function(){s.trigger("mousedown")},s.uid);r.addEvent(i.get(n.container),"mouseup",function(){s.trigger("mouseup")},s.uid);v.onchange=function w(){if(e=[],n.directory?t.each(this.files,function(n){"."!==n.name&&e.push(n)}):e=[].slice.call(this.files),"IE"!==f.browser&&"IEMobile"!==f.browser)this.value="";else{var i=this.cloneNode(!0);this.parentNode.replaceChild(i,this);i.onchange=w}s.trigger("change")};s.trigger({type:"ready",async:!0});l=null},getFiles:function(){return e},disable:function(n){var r=this.getRuntime(),t;(t=i.get(r.uid))&&(t.disabled=!!n)},destroy:function(){var u=this.getRuntime(),f=u.getShim(),t=u.getShimContainer();r.removeAllEvents(t,this.uid);r.removeAllEvents(n&&i.get(n.container),this.uid);r.removeAllEvents(n&&i.get(n.browse_button),this.uid);t&&(t.innerHTML="");f.removeInstance(this.uid);e=n=t=f=null}})}return n.FileInput=e});i("moxie/runtime/html5/file/FileDrop",[w,r,o,b,h],function(n,t,i,r,u){function f(){function s(n){if(!n.dataTransfer||!n.dataTransfer.types)return!1;var i=t.toArray(n.dataTransfer.types||[]);return-1!==t.inArray("Files",i)||-1!==t.inArray("public.file-url",i)||-1!==t.inArray("application/x-moz-file",i)}function c(n){for(var i=[],r=0;r<n.length;r++)[].push.apply(i,n[r].extensions.split(/\s*,\s*/));return-1===t.inArray("*",i)?i:[]}function o(n){if(!e.length)return!0;var i=u.getFileExtension(n.name);return!i||-1!==t.inArray(i,e)}function l(i,r){var u=[];t.each(i,function(t){var i=t.webkitGetAsEntry(),r;i&&(i.isFile?(r=t.getAsFile(),o(r)&&n.push(r)):u.push(i))});u.length?h(u,r):r()}function h(n,i){var r=[];t.each(n,function(n){r.push(function(t){a(n,t)})});t.inSeries(r,function(){i()})}function a(t,i){t.isFile?t.file(function(t){o(t)&&n.push(t);i()},function(){i()}):t.isDirectory?v(t,i):i()}function v(n,t){function i(n){u.readEntries(function(t){t.length?([].push.apply(r,t),i(n)):n()},n)}var r=[],u=n.createReader();i(function(){h(r,t)})}var n=[],e=[],f;t.extend(this,{init:function(i){var u=this,h;f=i;e=c(f.accept);h=f.container;r.addEvent(h,"dragover",function(n){s(n)&&(n.preventDefault(),n.dataTransfer.dropEffect="copy")},u.uid);r.addEvent(h,"drop",function(i){s(i)&&(i.preventDefault(),n=[],i.dataTransfer.items&&i.dataTransfer.items[0].webkitGetAsEntry?l(i.dataTransfer.items,function(){u.trigger("drop")}):(t.each(i.dataTransfer.files,function(t){o(t)&&n.push(t)}),u.trigger("drop")))},u.uid);r.addEvent(h,"dragenter",function(){u.trigger("dragenter")},u.uid);r.addEvent(h,"dragleave",function(){u.trigger("dragleave")},u.uid)},getFiles:function(){return n},destroy:function(){r.removeAllEvents(f&&i.get(f.container),this.uid);n=e=f=null}})}return n.FileDrop=f});i(lt,[w,s,r],function(n,t,i){function r(){function u(n){return t.atob(n.substring(n.indexOf("base64,")+7))}var n,r=!1;i.extend(this,{read:function(t,u){var f=this;n=new window.FileReader;n.addEventListener("progress",function(n){f.trigger(n)});n.addEventListener("load",function(n){f.trigger(n)});n.addEventListener("error",function(t){f.trigger(t,n.error)});n.addEventListener("loadend",function(){n=null});"function"===i.typeOf(n[t])?(r=!1,n[t](u.getSource())):"readAsBinaryString"===t&&(r=!0,n.readAsDataURL(u.getSource()))},getResult:function(){return n&&n.result?r?u(n.result):n.result:null},abort:function(){n&&n.abort()},destroy:function(){n=null}})}return n.FileReader=r});i("moxie/runtime/html5/xhr/XMLHttpRequest",[w,r,h,nt,v,f,d,u,e],function(n,t,i,r,u,f,e,o,s){function h(){function l(n,t){var u=this,r,i;r=t.getBlob().getSource();i=new window.FileReader;i.onload=function(){t.append(t.getBlobName(),new f(null,{type:r.type,data:i.result}));c.send.call(u,n,t)};i.readAsBinaryString(r)}function a(){return!window.XMLHttpRequest||"IE"===s.browser&&s.version<8?function(){for(var t=["Msxml2.XMLHTTP.6.0","Microsoft.XMLHTTP"],n=0;n<t.length;n++)try{return new ActiveXObject(t[n])}catch(i){}}():new window.XMLHttpRequest}function v(n){var t=n.responseXML,i=n.responseText;return"IE"===s.browser&&i&&t&&!t.documentElement&&/[^\/]+\/[^\+]+\+xml/.test(n.getResponseHeader("Content-Type"))&&(t=new window.ActiveXObject("Microsoft.XMLDOM"),t.async=!1,t.validateOnParse=!1,t.loadXML(i)),t&&("IE"===s.browser&&0!==t.parseError||!t.documentElement||"parsererror"===t.documentElement.tagName)?null:t}function y(t){var r="----moxieboundary"+(new Date).getTime(),u="--",i="\r\n",e="",s=this.getRuntime();if(!s.can("send_binary_string"))throw new o.RuntimeError(o.RuntimeError.NOT_SUPPORTED_ERR);return n.setRequestHeader("Content-Type","multipart/form-data; boundary="+r),t.each(function(n,t){e+=n instanceof f?u+r+i+'Content-Disposition: form-data; name="'+t+'"; filename="'+unescape(encodeURIComponent(n.name||"blob"))+'"'+i+"Content-Type: "+(n.type||"application/octet-stream")+i+i+n.getSource()+i:u+r+i+'Content-Disposition: form-data; name="'+t+'"'+i+i+unescape(encodeURIComponent(n))+i}),e+=u+r+u+i}var c=this,n,h;t.extend(this,{send:function(i,u){var o=this,p="Mozilla"===s.browser&&s.version>=4&&s.version<7,w="Android Browser"===s.browser,v=!1,c;if(h=i.url.replace(/^.+?\/([\w\-\.]+)$/,"$1").toLowerCase(),n=a(),n.open(i.method,i.url,i.async,i.user,i.password),u instanceof f)u.isDetached()&&(v=!0),u=u.getSource();else if(u instanceof e){if(u.hasBlob())if(u.getBlob().isDetached())u=y.call(o,u),v=!0;else if((p||w)&&"blob"===t.typeOf(u.getBlob().getSource())&&window.FileReader)return void l.call(o,i,u);u instanceof e&&(c=new window.FormData,u.each(function(n,t){n instanceof f?c.append(t,n.getSource()):c.append(t,n)}),u=c)}n.upload?(i.withCredentials&&(n.withCredentials=!0),n.addEventListener("load",function(n){o.trigger(n)}),n.addEventListener("error",function(n){o.trigger(n)}),n.addEventListener("progress",function(n){o.trigger(n)}),n.upload.addEventListener("progress",function(n){o.trigger({type:"UploadProgress",loaded:n.loaded,total:n.total})})):n.onreadystatechange=function(){switch(n.readyState){case 3:var t,u;try{r.hasSameOrigin(i.url)&&(t=n.getResponseHeader("Content-Length")||0);n.responseText&&(u=n.responseText.length)}catch(f){t=u=0}o.trigger({type:"progress",lengthComputable:!!t,total:parseInt(t,10),loaded:u});break;case 4:n.onreadystatechange=function(){};o.trigger(0===n.status?"error":"load")}};t.isEmptyObj(i.headers)||t.each(i.headers,function(t,i){n.setRequestHeader(i,t)});""!==i.responseType&&"responseType"in n&&(n.responseType="json"!==i.responseType||s.can("return_response_type","json")?i.responseType:"text");v?n.sendAsBinary?n.sendAsBinary(u):!function(){for(var i=new Uint8Array(u.length),t=0;t<u.length;t++)i[t]=255&u.charCodeAt(t);n.send(i.buffer)}():n.send(u);o.trigger("loadstart")},getStatus:function(){try{if(n)return n.status}catch(t){}return 0},getResponse:function(t){var o=this.getRuntime(),r,f,e;try{switch(t){case"blob":return r=new u(o.uid,n.response),f=n.getResponseHeader("Content-Disposition"),f&&(e=f.match(/filename=([\'\"'])([^\1]+)\1/),e&&(h=e[2])),r.name=h,r.type||(r.type=i.getFileMime(h)),r;case"json":return s.can("return_response_type","json")?n.response:200===n.status&&window.JSON?JSON.parse(n.responseText):null;case"document":return v(n);default:return""!==n.responseText?n.responseText:null}}catch(c){return null}},getAllResponseHeaders:function(){try{return n.getAllResponseHeaders()}catch(t){}return""},abort:function(){n&&n.abort()},destroy:function(){c=h=null}})}return n.XMLHttpRequest=h});i(it,[],function(){return function(){function i(t,i){for(var e=r?0:-8*(i-1),f=0,u=0;i>u;u++)f|=n.charCodeAt(t+u)<<Math.abs(e+8*u);return f}function u(t,i,r){r=3===arguments.length?r:n.length-i-1;n=n.substr(0,i)+t+n.substr(r+i)}function f(n,t,i){for(var e="",o=r?0:-8*(i-1),f=0;i>f;f++)e+=String.fromCharCode(t>>Math.abs(o+8*f)&255);u(e,n,i)}var r=!1,n;return{II:function(n){return n===t?r:void(r=n)},init:function(t){r=!1;n=t},SEGMENT:function(t,i,r){switch(arguments.length){case 1:return n.substr(t,n.length-t-1);case 2:return n.substr(t,i);case 3:u(r,t,i);break;default:return n}},BYTE:function(n){return i(n,1)},SHORT:function(n){return i(n,2)},LONG:function(n,r){return r===t?i(n,4):void f(n,r,4)},SLONG:function(n){var t=i(n,4);return t>2147483647?t-4294967296:t},STRING:function(n,t){var r="";for(t+=n;t>n;n++)r+=String.fromCharCode(i(n,1));return r}}}});i(at,[it],function(n){return function t(i){var u=[],r,f,e,o=0;if(r=new n,r.init(i),65496===r.SHORT(0)){for(f=2;f<=i.length;)if(e=r.SHORT(f),e>=65488&&65495>=e)f+=2;else{if(65498===e||65497===e)break;o=r.SHORT(f+2)+2;e>=65505&&65519>=e&&u.push({hex:e,name:"APP"+(15&e),start:f,length:o,segment:r.SEGMENT(f,o)});f+=o}return r.init(null),{headers:u,restore:function(n){var i,t;for(r.init(n),f=65504==r.SHORT(2)?4+r.SHORT(4):2,t=0,i=u.length;i>t;t++)r.SEGMENT(f,0,u[t].segment),f+=u[t].length;return n=r.SEGMENT(),r.init(null),n},strip:function(n){var i,f,u;for(f=new t(n),i=f.headers,f.purge(),r.init(n),u=i.length;u--;)r.SEGMENT(i[u].start,i[u].length,"");return n=r.SEGMENT(),r.init(null),n},get:function(n){for(var i=[],t=0,r=u.length;r>t;t++)u[t].name===n.toUpperCase()&&i.push(u[t].segment);return i},set:function(n,t){var r=[],i,f,e;for("string"==typeof t?r.push(t):r=t,i=f=0,e=u.length;e>i&&(u[i].name===n.toUpperCase()&&(u[i].segment=r[f],u[i].length=r[f].length,f++),!(f>=r.length));i++);},purge:function(){u=[];r.init(null);r=null}}}}});i(vt,[r,it],function(n,i){return function(){function o(n,i){for(var p=r.SHORT(n),f,c,y,o,w,e,a,h=[],v={},l=0;p>l;l++)if(e=w=n+12*l+2,c=i[r.SHORT(e)],c!==t){switch(y=r.SHORT(e+=2),o=r.LONG(e+=2),e+=4,h=[],y){case 1:case 7:for(o>4&&(e=r.LONG(e)+u.tiffHeader),f=0;o>f;f++)h[f]=r.BYTE(e+f);break;case 2:o>4&&(e=r.LONG(e)+u.tiffHeader);v[c]=r.STRING(e,o-1);continue;case 3:for(o>2&&(e=r.LONG(e)+u.tiffHeader),f=0;o>f;f++)h[f]=r.SHORT(e+2*f);break;case 4:for(o>1&&(e=r.LONG(e)+u.tiffHeader),f=0;o>f;f++)h[f]=r.LONG(e+4*f);break;case 5:for(e=r.LONG(e)+u.tiffHeader,f=0;o>f;f++)h[f]=r.LONG(e+4*f)/r.LONG(e+4*f+4);break;case 9:for(e=r.LONG(e)+u.tiffHeader,f=0;o>f;f++)h[f]=r.SLONG(e+4*f);break;case 10:for(e=r.LONG(e)+u.tiffHeader,f=0;o>f;f++)h[f]=r.SLONG(e+4*f)/r.SLONG(e+4*f+4);break;default:continue}a=1==o?h[0]:h;v[c]=s.hasOwnProperty(c)&&"object"!=typeof a?s[c][a]:a}return v}function h(){var n=u.tiffHeader;return r.II(18761==r.SHORT(n)),42!==r.SHORT(n+=2)?!1:(u.IFD0=u.tiffHeader+r.LONG(n+=2),f=o(u.IFD0,e.tiff),"ExifIFDPointer"in f&&(u.exifIFD=u.tiffHeader+f.ExifIFDPointer,delete f.ExifIFDPointer),"GPSInfoIFDPointer"in f&&(u.gpsIFD=u.tiffHeader+f.GPSInfoIFDPointer,delete f.GPSInfoIFDPointer),!0)}function c(n,t,i){var o,a,s,h=0,c,l,f;if("string"==typeof t){c=e[n.toLowerCase()];for(l in c)if(c[l]===t){t=l;break}}for(o=u[n.toLowerCase()+"IFD"],a=r.SHORT(o),f=0;a>f;f++)if(s=o+12*f+2,r.SHORT(s)==t){h=s+8;break}return h?(r.LONG(h,i),!0):!1}var r,e,f,u={},s;return r=new i,e={tiff:{274:"Orientation",270:"ImageDescription",271:"Make",272:"Model",305:"Software",34665:"ExifIFDPointer",34853:"GPSInfoIFDPointer"},exif:{36864:"ExifVersion",40961:"ColorSpace",40962:"PixelXDimension",40963:"PixelYDimension",36867:"DateTimeOriginal",33434:"ExposureTime",33437:"FNumber",34855:"ISOSpeedRatings",37377:"ShutterSpeedValue",37378:"ApertureValue",37383:"MeteringMode",37384:"LightSource",37385:"Flash",37386:"FocalLength",41986:"ExposureMode",41987:"WhiteBalance",41990:"SceneCaptureType",41988:"DigitalZoomRatio",41992:"Contrast",41993:"Saturation",41994:"Sharpness"},gps:{0:"GPSVersionID",1:"GPSLatitudeRef",2:"GPSLatitude",3:"GPSLongitudeRef",4:"GPSLongitude"}},s={ColorSpace:{1:"sRGB",0:"Uncalibrated"},MeteringMode:{0:"Unknown",1:"Average",2:"CenterWeightedAverage",3:"Spot",4:"MultiSpot",5:"Pattern",6:"Partial",255:"Other"},LightSource:{1:"Daylight",2:"Fliorescent",3:"Tungsten",4:"Flash",9:"Fine weather",10:"Cloudy weather",11:"Shade",12:"Daylight fluorescent (D 5700 - 7100K)",13:"Day white fluorescent (N 4600 -5400K)",14:"Cool white fluorescent (W 3900 - 4500K)",15:"White fluorescent (WW 3200 - 3700K)",17:"Standard light A",18:"Standard light B",19:"Standard light C",20:"D55",21:"D65",22:"D75",23:"D50",24:"ISO studio tungsten",255:"Other"},Flash:{0:"Flash did not fire.",1:"Flash fired.",5:"Strobe return light not detected.",7:"Strobe return light detected.",9:"Flash fired, compulsory flash mode",13:"Flash fired, compulsory flash mode, return light not detected",15:"Flash fired, compulsory flash mode, return light detected",16:"Flash did not fire, compulsory flash mode",24:"Flash did not fire, auto mode",25:"Flash fired, auto mode",29:"Flash fired, auto mode, return light not detected",31:"Flash fired, auto mode, return light detected",32:"No flash function",65:"Flash fired, red-eye reduction mode",69:"Flash fired, red-eye reduction mode, return light not detected",71:"Flash fired, red-eye reduction mode, return light detected",73:"Flash fired, compulsory flash mode, red-eye reduction mode",77:"Flash fired, compulsory flash mode, red-eye reduction mode, return light not detected",79:"Flash fired, compulsory flash mode, red-eye reduction mode, return light detected",89:"Flash fired, auto mode, red-eye reduction mode",93:"Flash fired, auto mode, return light not detected, red-eye reduction mode",95:"Flash fired, auto mode, return light detected, red-eye reduction mode"},ExposureMode:{0:"Auto exposure",1:"Manual exposure",2:"Auto bracket"},WhiteBalance:{0:"Auto white balance",1:"Manual white balance"},SceneCaptureType:{0:"Standard",1:"Landscape",2:"Portrait",3:"Night scene"},Contrast:{0:"Normal",1:"Soft",2:"Hard"},Saturation:{0:"Normal",1:"Low saturation",2:"High saturation"},Sharpness:{0:"Normal",1:"Soft",2:"Hard"},GPSLatitudeRef:{N:"North latitude",S:"South latitude"},GPSLongitudeRef:{E:"East longitude",W:"West longitude"}},{init:function(n){return u={tiffHeader:10},n!==t&&n.length?(r.init(n),65505===r.SHORT(0)&&"EXIF\x00"===r.STRING(4,5).toUpperCase()?h():!1):!1},TIFF:function(){return f},EXIF:function(){var t,i,r;if(t=o(u.exifIFD,e.exif),t.ExifVersion&&"array"===n.typeOf(t.ExifVersion)){for(i=0,r="";i<t.ExifVersion.length;i++)r+=String.fromCharCode(t.ExifVersion[i]);t.ExifVersion=r}return t},GPS:function(){var t;return t=o(u.gpsIFD,e.gps),t.GPSVersionID&&"array"===n.typeOf(t.GPSVersionID)&&(t.GPSVersionID=t.GPSVersionID.join(".")),t},setExif:function(n,t){return"PixelXDimension"!==n&&"PixelYDimension"!==n?!1:c("exif",n,t)},getBinary:function(){return r.SEGMENT()},purge:function(){r.init(null);r=f=null;u={}}}}});i(yt,[r,u,at,it,vt],function(n,t,i,r,u){function f(f){function a(){for(var n=0,t,i;n<=h.length;){if(t=o.SHORT(n+=2),t>=65472&&65475>=t)return n+=5,{height:o.SHORT(n),width:o.SHORT(n+=2)};i=o.SHORT(n+=2);n+=i-2}return null}function v(){e&&s&&o&&(e.purge(),s.purge(),o.init(null),h=c=s=e=o=null)}var h,o,s,e,c,l;if(h=f,o=new r,o.init(h),65496!==o.SHORT(0))throw new t.ImageError(t.ImageError.WRONG_FORMAT);s=new i(f);e=new u;l=!!e.init(s.get("app1")[0]);c=a.call(this);n.extend(this,{type:"image/jpeg",size:h.length,width:c&&c.width||0,height:c&&c.height||0,setExif:function(t,i){return l?("object"===n.typeOf(t)?n.each(t,function(n,t){e.setExif(t,n)}):e.setExif(t,i),void s.set("app1",e.getBinary())):!1},writeHeaders:function(){return arguments.length?s.restore(arguments[0]):h=s.restore(h)},stripHeaders:function(n){return s.strip(n)},purge:function(){v.call(this)}});l&&(this.meta={tiff:e.TIFF(),exif:e.EXIF(),gps:e.GPS()})}return f});i(pt,[u,r,it],function(n,t,i){function r(r){function s(){var n,t;return n=h.call(this,8),"IHDR"==n.type?(t=n.start,{width:u.LONG(t),height:u.LONG(t+=4)}):null}function o(){u&&(u.init(null),f=e=c=l=u=null)}function h(n){var t,i,r,f;return t=u.LONG(n),i=u.STRING(n+=4,4),r=n+=4,f=u.LONG(n+t),{length:t,type:i,start:r,CRC:f}}var f,u,c,l,e;f=r;u=new i;u.init(f),function(){for(var i=0,t=0,r=[35152,20039,3338,6666],t=0;t<r.length;t++,i+=2)if(r[t]!=u.SHORT(i))throw new n.ImageError(n.ImageError.WRONG_FORMAT);}();e=s.call(this);t.extend(this,{type:"image/png",size:f.length,width:e.width,height:e.height,purge:function(){o.call(this)}});o.call(this)}return r});i(wt,[r,u,yt,pt],function(n,t,i,r){return function(u){var e=[i,r],f;f=function(){for(var n=0;n<e.length;n++)try{return new e[n](u)}catch(i){}throw new t.ImageError(t.ImageError.WRONG_FORMAT);}();n.extend(this,{type:"",size:0,width:0,height:0,setExif:function(){},writeHeaders:function(n){return n},stripHeaders:function(n){return n},purge:function(){}});n.extend(this,f);this.purge=function(){f.purge();f=null}}});i(bt,[],function(){function t(t,r,u){var e=t.naturalWidth,o=t.naturalHeight,y=u.width,p=u.height,b=u.x||0,k=u.y||0,d=r.getContext("2d"),f,h,a,s,v;n(t)&&(e/=2,o/=2);f=1024;h=document.createElement("canvas");h.width=h.height=f;for(var l=h.getContext("2d"),w=i(t,e,o),c=0;o>c;){for(a=c+f>o?o-c:f,s=0;e>s;){v=s+f>e?e-s:f;l.clearRect(0,0,f,f);l.drawImage(t,-s,-c);var g=s*y/e+b<<0,nt=Math.ceil(v*y/e),tt=c*p/o/w+k<<0,it=Math.ceil(a*p/o/w);d.drawImage(h,0,0,v,a,g,tt,nt,it);s+=f}c+=f}h=l=null}function n(n){var r=n.naturalWidth,u=n.naturalHeight,t,i;return r*u>1048576?(t=document.createElement("canvas"),t.width=t.height=1,i=t.getContext("2d"),i.drawImage(n,-r+1,0),0===i.getImageData(0,0,1,1).data[3]):!1}function i(n,t,i){var u=document.createElement("canvas"),f,h,o;u.width=1;u.height=i;f=u.getContext("2d");f.drawImage(n,0,0);for(var c=f.getImageData(0,0,1,i).data,e=0,s=i,r=i;r>e;)h=c[4*(r-1)+3],0===h?s=r:e=r,r=s+e>>1;return u=null,o=r/i,0===o?1:o}return{isSubsampled:n,renderTo:t}});i(kt,[w,r,u,s,v,wt,bt,h,e],function(n,t,i,r,u,f,e,o,s){function h(){function w(){if(!n&&!a)throw new i.ImageError(i.DOMException.INVALID_STATE_ERR);return n||a}function y(n){return r.atob(n.substring(n.indexOf("base64,")+7))}function nt(n,t){return"data:"+(t||"")+";base64,"+r.btoa(n)}function b(n){var t=this;a=new Image;a.onerror=function(){g.call(this);t.trigger("error",i.ImageError.WRONG_FORMAT)};a.onload=function(){t.trigger("load")};a.src=/^data:[^;]*;base64,/.test(n)?n:nt(n,l.type)}function tt(n,t){var u=this,r;return window.FileReader?(r=new FileReader,r.onload=function(){t(this.result)},r.onerror=function(){u.trigger("error",i.ImageError.WRONG_FORMAT)},r.readAsDataURL(n),void 0):t(n.getAsDataURL())}function d(i,r,u,f){var p=this,o,l=0,a=0,e,s,h,c,y;return(k=f,c=this.meta&&this.meta.tiff&&this.meta.tiff.Orientation||1,-1!==t.inArray(c,[5,6,7,8]))&&(y=i,i=r,r=y),e=w(),u?(i=Math.min(i,e.width),r=Math.min(r,e.height),o=Math.max(i/e.width,r/e.height)):o=Math.min(i/e.width,r/e.height),o>1&&!u&&f?void this.trigger("Resize"):(n||(n=document.createElement("canvas")),s=Math.round(e.width*o),h=Math.round(e.height*o),u?(n.width=i,n.height=r,s>i&&(l=Math.round((s-i)/2)),h>r&&(a=Math.round((h-r)/2))):(n.width=s,n.height=h),k||rt(n.width,n.height,c),it.call(this,e,n,-l,-a,s,h),this.width=n.width,this.height=n.height,v=!0,void p.trigger("Resize"))}function it(n,t,i,r,u,f){if("iOS"===s.OS)e.renderTo(n,t,{width:u,height:f,x:i,y:r});else{var o=t.getContext("2d");o.drawImage(n,i,r,u,f)}}function rt(t,i,r){switch(r){case 5:case 6:case 7:case 8:n.width=i;n.height=t;break;default:n.width=t;n.height=i}var u=n.getContext("2d");switch(r){case 2:u.translate(t,0);u.scale(-1,1);break;case 3:u.translate(t,i);u.rotate(Math.PI);break;case 4:u.translate(0,i);u.scale(1,-1);break;case 5:u.rotate(.5*Math.PI);u.scale(1,-1);break;case 6:u.rotate(.5*Math.PI);u.translate(0,-i);break;case 7:u.rotate(.5*Math.PI);u.translate(t,-i);u.scale(-1,1);break;case 8:u.rotate(-.5*Math.PI);u.translate(-t,0)}}function g(){c&&(c.purge(),c=null);h=a=n=l=null;v=!1}var p=this,a,c,n,h,l,v=!1,k=!0;t.extend(this,{loadFromBlob:function(n){var t=this,r=t.getRuntime(),u=arguments.length>1?arguments[1]:!0;if(!r.can("access_binary"))throw new i.RuntimeError(i.RuntimeError.NOT_SUPPORTED_ERR);return l=n,n.isDetached()?(h=n.getSource(),void b.call(this,h)):void tt.call(this,n.getSource(),function(n){u&&(h=y(n));b.call(t,n)})},loadFromImage:function(n,t){this.meta=n.meta;l=new u(null,{name:n.name,size:n.size,type:n.type});b.call(this,t?h=n.getAsBinaryString():n.getAsDataURL())},getInfo:function(){var n=this.getRuntime(),t;return!c&&h&&n.can("access_image_binary")&&(c=new f(h)),t={width:w().width||0,height:w().height||0,type:l.type||o.getFileMime(l.name),size:h&&h.length||l.size||0,name:l.name||"",meta:c&&c.meta||this.meta||{}}},downsize:function(){d.apply(this,arguments)},getAsCanvas:function(){return n&&(n.id=this.uid+"_canvas"),n},getAsBlob:function(n,t){return n!==this.type&&d.call(this,this.width,this.height,!1),new u(null,{name:l.name||"",type:n,data:p.getAsBinaryString.call(this,n,t)})},getAsDataURL:function(t){var i=arguments[1]||90;if(!v)return a.src;if("image/jpeg"!==t)return n.toDataURL("image/png");try{return n.toDataURL("image/jpeg",i/100)}catch(r){return n.toDataURL("image/jpeg")}},getAsBinaryString:function(t,i){if(!v)return h||(h=y(p.getAsDataURL(t,i))),h;if("image/jpeg"!==t)h=y(p.getAsDataURL(t,i));else{var r;i||(i=90);try{r=n.toDataURL("image/jpeg",i/100)}catch(u){r=n.toDataURL("image/jpeg")}h=y(r);c&&(h=c.stripHeaders(h),k&&(c.meta&&c.meta.exif&&c.setExif({PixelXDimension:this.width,PixelYDimension:this.height}),h=c.writeHeaders(h)),c.purge(),c=null)}return v=!1,h},destroy:function(){p=null;g.call(this);this.getRuntime().getShim().removeInstance(this.uid)}})}return n.Image=h});i(p,[r,e,o,u,l],function(n,t,i,r,u){function o(){var n;try{n=navigator.plugins["Shockwave Flash"];n=n.description}catch(t){try{n=new ActiveXObject("ShockwaveFlash.ShockwaveFlash").GetVariable("$version")}catch(i){n="0.0"}}return n=n.match(/\d+/g),parseFloat(n[0]+"."+n[1])}function s(s){var h=this,c;s=n.extend({swf_url:t.swf_url},s);u.call(this,s,f,{access_binary:function(n){return n&&"browser"===h.mode},access_image_binary:function(n){return n&&"browser"===h.mode},display_media:u.capTrue,do_cors:u.capTrue,drag_and_drop:!1,report_upload_progress:function(){return"client"===h.mode},resize_image:u.capTrue,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!n.arrayDiff(t,["","text","document"])||"browser"===h.mode},return_status_code:function(t){return"browser"===h.mode||!n.arrayDiff(t,[200,404])},select_file:u.capTrue,select_multiple:u.capTrue,send_binary_string:function(n){return n&&"browser"===h.mode},send_browser_cookies:function(n){return n&&"browser"===h.mode},send_custom_headers:function(n){return n&&"browser"===h.mode},send_multipart:u.capTrue,slice_blob:function(n){return n&&"browser"===h.mode},stream_upload:function(n){return n&&"browser"===h.mode},summon_file_dialog:!1,upload_filesize:function(t){return n.parseSizeStr(t)<=2097152||"client"===h.mode},use_http_method:function(t){return!n.arrayDiff(t,["GET","POST"])}},{access_binary:function(n){return n?"browser":"client"},access_image_binary:function(n){return n?"browser":"client"},report_upload_progress:function(n){return n?"browser":"client"},return_response_type:function(t){return n.arrayDiff(t,["","text","json","document"])?"browser":["client","browser"]},return_status_code:function(t){return n.arrayDiff(t,[200,404])?"browser":["client","browser"]},send_binary_string:function(n){return n?"browser":"client"},send_browser_cookies:function(n){return n?"browser":"client"},send_custom_headers:function(n){return n?"browser":"client"},stream_upload:function(n){return n?"client":"browser"},upload_filesize:function(t){return n.parseSizeStr(t)>=2097152?"client":"browser"}},"client");o()<10&&(this.mode=!1);n.extend(this,{getShim:function(){return i.get(this.uid)},shimExec:function(n,t){var i=[].slice.call(arguments,2);return h.getShim().exec(this.uid,n,t,i)},init:function(){var i,f,u;u=this.getShimContainer();n.extend(u.style,{position:"absolute",top:"-8px",left:"-8px",width:"9px",height:"9px",overflow:"hidden"});i='<object id="'+this.uid+'" type="application/x-shockwave-flash" data="'+s.swf_url+'" ';"IE"===t.browser&&(i+='classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" ');i+='width="100%" height="100%" style="outline:0"><param name="movie" value="'+s.swf_url+'" /><param name="flashvars" value="uid='+escape(this.uid)+"&target="+t.global_event_dispatcher+'" /><param name="wmode" value="transparent" /><param name="allowscriptaccess" value="always" /><\/object>';"IE"===t.browser?(f=document.createElement("div"),u.appendChild(f),f.outerHTML=i,f=u=null):u.innerHTML=i;c=setTimeout(function(){h&&!h.initialized&&h.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},5e3)},destroy:function(n){return function(){n.call(h);clearTimeout(c);s=c=n=h=null}}(this.destroy)},e)}var f="flash",e={};return u.addConstructor(f,s),e});i(dt,[p,f],function(n,t){var i={slice:function(n,i,r,u){var f=this.getRuntime();return 0>i?i=Math.max(n.size+i,0):i>0&&(i=Math.min(i,n.size)),0>r?r=Math.max(n.size+r,0):r>0&&(r=Math.min(r,n.size)),n=f.shimExec.call(this,"Blob","slice",i,r,u||""),n&&(n=new t(f.uid,n)),n}};return n.Blob=i});i("moxie/runtime/flash/file/FileInput",[p],function(n){var t={init:function(n){this.getRuntime().shimExec.call(this,"FileInput","init",{name:n.name,accept:n.accept,multiple:n.multiple});this.trigger("ready")}};return n.FileInput=t});i(gt,[p,s],function(n,t){function r(n,i){switch(i){case"readAsText":return t.atob(n,"utf8");case"readAsBinaryString":return t.atob(n);case"readAsDataURL":return n}return null}var i="",u={read:function(n,t){var u=this,f=u.getRuntime();return"readAsDataURL"===n&&(i="data:"+(t.type||"")+";base64,"),u.bind("Progress",function(t,u){u&&(i+=r(u,n))}),f.shimExec.call(this,"FileReader","readAsBase64",t.uid)},getResult:function(){return i},destroy:function(){i=null}};return n.FileReader=u});i(ni,[p,s],function(n,t){function i(n,i){switch(i){case"readAsText":return t.atob(n,"utf8");case"readAsBinaryString":return t.atob(n);case"readAsDataURL":return n}return null}var r={read:function(n,t){var r,u=this.getRuntime();return(r=u.shimExec.call(this,"FileReaderSync","readAsBase64",t.uid))?("readAsDataURL"===n&&(r="data:"+(t.type||"")+";base64,"+r),i(r,n,t.type)):null}};return n.FileReaderSync=r});i(ti,[p,r,f,v,k,d,tt],function(n,t,i,r,u,f,e){var o={send:function(n,r){function o(){n.transport=u.mode;u.shimExec.call(s,"XMLHttpRequest","send",n,r)}function l(n,t){u.shimExec.call(s,"XMLHttpRequest","appendBlob",n,t.uid);r=null;o()}function a(n,t){var i=new e;i.bind("TransportingComplete",function(){t(this.result)});i.transport(n.getSource(),n.type,{ruid:u.uid})}var s=this,u=s.getRuntime(),c,h;(t.isEmptyObj(n.headers)||t.each(n.headers,function(n,t){u.shimExec.call(s,"XMLHttpRequest","setRequestHeader",t,n.toString())}),r instanceof f)?(r.each(function(n,t){n instanceof i?c=t:u.shimExec.call(s,"XMLHttpRequest","append",t,n)}),r.hasBlob())?(h=r.getBlob(),h.isDetached()?a(h,function(n){h.destroy();l(c,n)}):l(c,h)):(r=null,o()):r instanceof i?r.isDetached()?a(r,function(n){r.destroy();r=n.uid;o()}):(r=r.uid,o()):o()},getResponse:function(n){var f,i,e=this.getRuntime();if(i=e.shimExec.call(this,"XMLHttpRequest","getResponseAsBlob")){if(i=new r(e.uid,i),"blob"===n)return i;try{if(f=new u,~t.inArray(n,["","text"]))return f.readAsText(i);if("json"===n&&window.JSON)return JSON.parse(f.readAsText(i))}finally{i.destroy()}}return null},abort:function(){var n=this.getRuntime();n.shimExec.call(this,"XMLHttpRequest","abort");this.dispatchEvent("readystatechange");this.dispatchEvent("abort")}};return n.XMLHttpRequest=o});i(ii,[p,f],function(n,t){var i={getAsBlob:function(n){var i=this.getRuntime(),r=i.shimExec.call(this,"Transporter","getAsBlob",n);return r?new t(i.uid,r):null}};return n.Transporter=i});i(ri,[p,r,tt,f,k],function(n,t,i,r,u){var f={loadFromBlob:function(n){function f(n){u.shimExec.call(r,"Image","loadFromBlob",n.uid);r=u=null}var r=this,u=r.getRuntime(),t;n.isDetached()?(t=new i,t.bind("TransportingComplete",function(){f(t.result.getSource())}),t.transport(n.getSource(),n.type,{ruid:u.uid})):f(n.getSource())},loadFromImage:function(n){var t=this.getRuntime();return t.shimExec.call(this,"Image","loadFromImage",n.uid)},getAsBlob:function(n,t){var i=this.getRuntime(),u=i.shimExec.call(this,"Image","getAsBlob",n,t);return u?new r(i.uid,u):null},getAsDataURL:function(){var i=this.getRuntime(),n=i.Image.getAsBlob.apply(this,arguments),t;return n?(t=new u,t.readAsDataURL(n)):null}};return n.Image=f});i(y,[r,e,o,u,l],function(n,t,i,r,u){function o(n){var r=!1,o=null,u,t,i,f,s,e=0,h;try{try{o=new ActiveXObject("AgControl.AgControl");o.IsVersionSupported(n)&&(r=!0);o=null}catch(c){if(h=navigator.plugins["Silverlight Plug-In"],h){for(u=h.description,"1.0.30226.2"===u&&(u="2.0.30226.2"),t=u.split(".");t.length>3;)t.pop();for(;t.length<4;)t.push(0);for(i=n.split(".");i.length>4;)i.pop();do f=parseInt(i[e],10),s=parseInt(t[e],10),e++;while(e<i.length&&f===s);s>=f&&!isNaN(f)&&(r=!0)}}}catch(l){r=!1}return r}function s(s){var h=this,c;s=n.extend({xap_url:t.xap_url},s);u.call(this,s,f,{access_binary:u.capTrue,access_image_binary:u.capTrue,display_media:u.capTrue,do_cors:u.capTrue,drag_and_drop:!1,report_upload_progress:u.capTrue,resize_image:u.capTrue,return_response_headers:function(n){return n&&"client"===h.mode},return_response_type:function(n){return"json"!==n?!0:!!window.JSON},return_status_code:function(t){return"client"===h.mode||!n.arrayDiff(t,[200,404])},select_file:u.capTrue,select_multiple:u.capTrue,send_binary_string:u.capTrue,send_browser_cookies:function(n){return n&&"browser"===h.mode},send_custom_headers:function(n){return n&&"client"===h.mode},send_multipart:u.capTrue,slice_blob:u.capTrue,stream_upload:!0,summon_file_dialog:!1,upload_filesize:u.capTrue,use_http_method:function(t){return"client"===h.mode||!n.arrayDiff(t,["GET","POST"])}},{return_response_headers:function(n){return n?"client":"browser"},return_status_code:function(t){return n.arrayDiff(t,[200,404])?"client":["client","browser"]},send_browser_cookies:function(n){return n?"browser":"client"},send_custom_headers:function(n){return n?"client":"browser"},use_http_method:function(t){return n.arrayDiff(t,["GET","POST"])?"client":["client","browser"]}});o("2.0.31005.0")&&"Opera"!==t.browser||(this.mode=!1);n.extend(this,{getShim:function(){return i.get(this.uid).content.Moxie},shimExec:function(n,t){var i=[].slice.call(arguments,2);return h.getShim().exec(this.uid,n,t,i)},init:function(){var n;n=this.getShimContainer();n.innerHTML='<object id="'+this.uid+'" data="data:application/x-silverlight," type="application/x-silverlight-2" width="100%" height="100%" style="outline:none;"><param name="source" value="'+s.xap_url+'"/><param name="background" value="Transparent"/><param name="windowless" value="true"/><param name="enablehtmlaccess" value="true"/><param name="initParams" value="uid='+this.uid+",target="+t.global_event_dispatcher+'"/><\/object>';c=setTimeout(function(){h&&!h.initialized&&h.trigger("Error",new r.RuntimeError(r.RuntimeError.NOT_INIT_ERR))},"Windows"!==t.OS?1e4:5e3)},destroy:function(n){return function(){n.call(h);clearTimeout(c);s=c=n=h=null}}(this.destroy)},e)}var f="silverlight",e={};return u.addConstructor(f,s),e});i("moxie/runtime/silverlight/file/Blob",[y,r,dt],function(n,t,i){return n.Blob=t.extend({},i)});i("moxie/runtime/silverlight/file/FileInput",[y],function(n){var t={init:function(n){function t(n){for(var i="",t=0;t<n.length;t++)i+=(""!==i?"|":"")+n[t].title+" | *."+n[t].extensions.replace(/,/g,";*.");return i}this.getRuntime().shimExec.call(this,"FileInput","init",t(n.accept),n.name,n.multiple);this.trigger("ready")}};return n.FileInput=t});i("moxie/runtime/silverlight/file/FileDrop",[y,o,b],function(n,t,i){var r={init:function(){var n=this,r=n.getRuntime(),u;return u=r.getShimContainer(),i.addEvent(u,"dragover",function(n){n.preventDefault();n.stopPropagation();n.dataTransfer.dropEffect="copy"},n.uid),i.addEvent(u,"dragenter",function(n){n.preventDefault();var i=t.get(r.uid).dragEnter(n);i&&n.stopPropagation()},n.uid),i.addEvent(u,"drop",function(n){n.preventDefault();var i=t.get(r.uid).dragDrop(n);i&&n.stopPropagation()},n.uid),r.shimExec.call(this,"FileDrop","init")}};return n.FileDrop=r});i("moxie/runtime/silverlight/file/FileReader",[y,r,gt],function(n,t,i){return n.FileReader=t.extend({},i)});i("moxie/runtime/silverlight/file/FileReaderSync",[y,r,ni],function(n,t,i){return n.FileReaderSync=t.extend({},i)});i("moxie/runtime/silverlight/xhr/XMLHttpRequest",[y,r,ti],function(n,t,i){return n.XMLHttpRequest=t.extend({},i)});i("moxie/runtime/silverlight/runtime/Transporter",[y,r,ii],function(n,t,i){return n.Transporter=t.extend({},i)});i("moxie/runtime/silverlight/image/Image",[y,r,ri],function(n,t,i){return n.Image=t.extend({},i,{getInfo:function(){var r=this.getRuntime(),n={meta:{}},i=r.shimExec.call(this,"Image","getInfo");return i.meta&&t.each(["tiff","exif","gps"],function(t){var u=i.meta[t],e,f,o,r;if(u&&u.keys)for(n.meta[t]={},f=0,o=u.keys.length;o>f;f++)e=u.keys[f],r=u[e],r&&(/^(\d|[1-9]\d+)$/.test(r)?r=parseInt(r,10):/^\d*\.\d+$/.test(r)&&(r=parseFloat(r)),n.meta[t][e]=r)}),n.width=parseInt(i.width,10),n.height=parseInt(i.height,10),n.size=parseInt(i.size,10),n.type=i.type,n.name=i.name,n}})});i(rt,[r,u,l,e],function(n,t,i,r){function e(t){var e=this,o=i.capTest,s=i.capTrue;i.call(this,t,f,{access_binary:o(window.FileReader||window.File&&File.getAsDataURL),access_image_binary:!1,display_media:o(u.Image&&(r.can("create_canvas")||r.can("use_data_uri_over32kb"))),do_cors:!1,drag_and_drop:!1,filter_by_extension:o(function(){return"Chrome"===r.browser&&r.version>=28||"IE"===r.browser&&r.version>=10}()),resize_image:function(){return u.Image&&e.can("access_binary")&&r.can("create_canvas")},report_upload_progress:!1,return_response_headers:!1,return_response_type:function(t){return"json"===t&&window.JSON?!0:!!~n.inArray(t,["text","document",""])},return_status_code:function(t){return!n.arrayDiff(t,[200,404])},select_file:function(){return r.can("use_fileinput")},select_multiple:!1,send_binary_string:!1,send_custom_headers:!1,send_multipart:!0,slice_blob:!1,stream_upload:function(){return e.can("select_file")},summon_file_dialog:o(function(){return"Firefox"===r.browser&&r.version>=4||"Opera"===r.browser&&r.version>=12||!!~n.inArray(r.browser,["Chrome","Safari"])}()),upload_filesize:s,use_http_method:function(t){return!n.arrayDiff(t,["GET","POST"])}});n.extend(this,{init:function(){this.trigger("Init")},destroy:function(n){return function(){n.call(e);n=e=null}}(this.destroy)});n.extend(this.getShim(),u)}var f="html4",u={};return i.addConstructor(f,e),u});i("moxie/runtime/html4/file/FileInput",[rt,r,o,b,h,e],function(n,t,i,r,u,f){function e(){function h(){var c=this,w=c.getRuntime(),p,v,y,l,u,a;a=t.guid("uid_");p=w.getShimContainer();e&&(y=i.get(e+"_form"),y&&t.extend(y.style,{top:"100%"}));l=document.createElement("form");l.setAttribute("id",a+"_form");l.setAttribute("method","post");l.setAttribute("enctype","multipart/form-data");l.setAttribute("encoding","multipart/form-data");t.extend(l.style,{overflow:"hidden",position:"absolute",top:0,left:0,width:"100%",height:"100%"});u=document.createElement("input");u.setAttribute("id",a);u.setAttribute("type","file");u.setAttribute("name",n.name||"Filedata");u.setAttribute("accept",s.join(","));t.extend(u.style,{fontSize:"999px",opacity:0});l.appendChild(u);p.appendChild(l);t.extend(u.style,{position:"absolute",top:0,left:0,width:"100%",height:"100%"});"IE"===f.browser&&f.version<10&&t.extend(u.style,{filter:"progid:DXImageTransform.Microsoft.Alpha(opacity=0)"});u.onchange=function(){var n;this.value&&(n=this.files?this.files[0]:{name:this.value},o=[n],this.onchange=function(){},h.call(c),c.bind("change",function t(){var u=i.get(a),n=i.get(a+"_form"),r;c.unbind("change",t);c.files.length&&u&&n&&(r=c.files[0],u.setAttribute("id",r.uid),n.setAttribute("id",r.uid+"_form"),n.setAttribute("target",r.uid+"_iframe"));u=n=null},998),u=l=null,c.trigger("change"))};w.can("summon_file_dialog")&&(v=i.get(n.browse_button),r.removeEvent(v,"click",c.uid),r.addEvent(v,"click",function(n){u&&!u.disabled&&u.click();n.preventDefault()},c.uid));e=a;p=y=v=null}var e,o=[],s=[],n;t.extend(this,{init:function(t){var f=this,e=f.getRuntime(),o;n=t;s=t.accept.mimes||u.extList2mimes(t.accept,e.can("filter_by_extension"));o=e.getShimContainer(),function(){var n,s,u;n=i.get(t.browse_button);e.can("summon_file_dialog")&&("static"===i.getStyle(n,"position")&&(n.style.position="relative"),s=parseInt(i.getStyle(n,"z-index"),10)||1,n.style.zIndex=s,o.style.zIndex=s-1);u=e.can("summon_file_dialog")?n:o;r.addEvent(u,"mouseover",function(){f.trigger("mouseenter")},f.uid);r.addEvent(u,"mouseout",function(){f.trigger("mouseleave")},f.uid);r.addEvent(u,"mousedown",function(){f.trigger("mousedown")},f.uid);r.addEvent(i.get(t.container),"mouseup",function(){f.trigger("mouseup")},f.uid);n=null}();h.call(this);o=null;f.trigger({type:"ready",async:!0})},getFiles:function(){return o},disable:function(n){var t;(t=i.get(e))&&(t.disabled=!!n)},destroy:function(){var u=this.getRuntime(),f=u.getShim(),t=u.getShimContainer();r.removeAllEvents(t,this.uid);r.removeAllEvents(n&&i.get(n.container),this.uid);r.removeAllEvents(n&&i.get(n.browse_button),this.uid);t&&(t.innerHTML="");f.removeInstance(this.uid);e=o=s=n=t=f=null}})}return n.FileInput=e});i("moxie/runtime/html4/file/FileReader",[rt,lt],function(n,t){return n.FileReader=t});i("moxie/runtime/html4/xhr/XMLHttpRequest",[rt,r,o,nt,u,b,f,d],function(n,t,i,r,u,f,e,o){function s(){function c(t){var o=this,s,u,r,e,h=!1;if(n){if(s=n.id.replace(/_iframe$/,""),u=i.get(s+"_form")){for(r=u.getElementsByTagName("input"),e=r.length;e--;)switch(r[e].getAttribute("type")){case"hidden":r[e].parentNode.removeChild(r[e]);break;case"file":h=!0}r=[];h||u.parentNode.removeChild(u);u=null}setTimeout(function(){f.removeEvent(n,"load",o.uid);n.parentNode&&n.parentNode.removeChild(n);var i=o.getRuntime().getShimContainer();i.children.length||i.parentNode.removeChild(i);i=n=null;t()},1)}}var h,s,n;t.extend(this,{send:function(l,a){function d(){var u=k.getShimContainer()||document.body,i=document.createElement("div");i.innerHTML='<iframe id="'+p+'_iframe" name="'+p+'_iframe" src="javascript:&quot;&quot;" style="display:none"><\/iframe>';n=i.firstChild;u.appendChild(n);f.addEvent(n,"load",function(){var i;try{i=n.contentWindow.document||n.contentDocument||window.frames[n.id].document;/^4(0[0-9]|1[0-7]|2[2346])\s/.test(i.title)?h=i.title.replace(/^(\d+).*$/,"$1"):(h=200,s=t.trim(i.body.innerHTML),y.trigger({type:"progress",loaded:s.length,total:s.length}),b&&y.trigger({type:"uploadprogress",loaded:b.size||1025,total:b.size||1025}))}catch(u){if(!r.hasSameOrigin(l.url))return void c.call(y,function(){y.trigger("error")});h=404}c.call(y,function(){y.trigger("load")})},y.uid)}var y=this,k=y.getRuntime(),p,v,w,b;if(h=s=null,a instanceof o&&a.hasBlob()){if(b=a.getBlob(),p=b.uid,w=i.get(p),v=i.get(p+"_form"),!v)throw new u.DOMException(u.DOMException.NOT_FOUND_ERR);}else p=t.guid("uid_"),v=document.createElement("form"),v.setAttribute("id",p+"_form"),v.setAttribute("method",l.method),v.setAttribute("enctype","multipart/form-data"),v.setAttribute("encoding","multipart/form-data"),v.setAttribute("target",p+"_iframe"),k.getShimContainer().appendChild(v);a instanceof o&&a.each(function(n,i){if(n instanceof e)w&&w.setAttribute("name",i);else{var r=document.createElement("input");t.extend(r,{type:"hidden",name:i,value:n});w?v.insertBefore(r,w):v.appendChild(r)}});v.setAttribute("action",l.url);d();v.submit();y.trigger("loadstart")},getStatus:function(){return h},getResponse:function(n){if("json"===n&&"string"===t.typeOf(s)&&window.JSON)try{return JSON.parse(s.replace(/^\s*<pre[^>]*>/,"").replace(/<\/pre>\s*$/,""))}catch(i){return null}return s},abort:function(){var t=this;n&&n.contentWindow&&(n.contentWindow.stop?n.contentWindow.stop():n.contentWindow.document.execCommand?n.contentWindow.document.execCommand("Stop"):n.src="about:blank");c.call(this,function(){t.dispatchEvent("abort")})}})}return n.XMLHttpRequest=s});i("moxie/runtime/html4/image/Image",[rt,kt],function(n,t){return n.Image=t});ei([r,g,h,e,o,u,c,s,l,a,f,v,ot,st,ft,ht,nt,k,d,et,tt,ct,b])}(this),function(n){"use strict";var t={},i=n.moxie.core.utils.Basic.inArray;return function r(n){var u,f;for(u in n)f=typeof n[u],f==="object"&&!~i(u,["Exceptions","Env","Mime"])?r(n[u]):f==="function"&&(t[u]=n[u])}(n.moxie),t.Env=n.moxie.core.utils.Env,t.Mime=n.moxie.core.utils.Mime,t.Exceptions=n.moxie.core.Exceptions,n.mOxie=t,n.o||(n.o=t),t}(this),function(n,t,i){function e(n){function u(n,t,r){var u={chunks:"slice_blob",jpgresize:"send_binary_string",pngresize:"send_binary_string",progress:"report_upload_progress",multi_selection:"select_multiple",dragdrop:"drag_and_drop",drop_element:"drag_and_drop",headers:"send_custom_headers",urlstream_upload:"send_binary_string",canSendBinary:"send_binary",triggerDialog:"summon_file_dialog"};u[n]?i[u[n]]=t:r||(i[n]=t)}var t=n.required_features,i={};return typeof t=="string"?r.each(t.split(/\s*,\s*/),function(n){u(n,!0)}):typeof t=="object"?r.each(t,function(n,t){u(t,n)}):t===!0&&(n.chunk_size>0&&(i.slice_blob=!0),(n.resize.enabled||!n.multipart)&&(i.send_binary_string=!0),r.each(n,function(n,t){u(t,!!n,!0)})),i}var u=n.setTimeout,f={},r={VERSION:"2.1.2",STOPPED:1,STARTED:2,QUEUED:1,UPLOADING:2,FAILED:4,DONE:5,GENERIC_ERROR:-100,HTTP_ERROR:-200,IO_ERROR:-300,SECURITY_ERROR:-400,INIT_ERROR:-500,FILE_SIZE_ERROR:-600,FILE_EXTENSION_ERROR:-601,FILE_DUPLICATE_ERROR:-602,IMAGE_FORMAT_ERROR:-700,MEMORY_ERROR:-701,IMAGE_DIMENSIONS_ERROR:-702,mimeTypes:t.mimes,ua:t.ua,typeOf:t.typeOf,extend:t.extend,guid:t.guid,get:function(n){var i=[],r,u;for(t.typeOf(n)!=="array"&&(n=[n]),u=n.length;u--;)r=t.get(n[u]),r&&i.push(r);return i.length?i:null},each:t.each,getPos:t.getPos,getSize:t.getSize,xmlEncode:function(n){var t={"<":"lt",">":"gt","&":"amp",'"':"quot","'":"#39"};return n?(""+n).replace(/[<>&\"\']/g,function(n){return t[n]?"&"+t[n]+";":n}):n},toArray:t.toArray,inArray:t.inArray,addI18n:t.addI18n,translate:t.translate,isEmptyObj:t.isEmptyObj,hasClass:t.hasClass,addClass:t.addClass,removeClass:t.removeClass,getStyle:t.getStyle,addEvent:t.addEvent,removeEvent:t.removeEvent,removeAllEvents:t.removeAllEvents,cleanName:function(n){for(var i=[/[\300-\306]/g,"A",/[\340-\346]/g,"a",/\307/g,"C",/\347/g,"c",/[\310-\313]/g,"E",/[\350-\353]/g,"e",/[\314-\317]/g,"I",/[\354-\357]/g,"i",/\321/g,"N",/\361/g,"n",/[\322-\330]/g,"O",/[\362-\370]/g,"o",/[\331-\334]/g,"U",/[\371-\374]/g,"u"],t=0;t<i.length;t+=2)n=n.replace(i[t],i[t+1]);return n=n.replace(/\s+/g,"_"),n=n.replace(/[^a-z0-9_\-\.]+/gi,""),n},buildUrl:function(n,t){var i="";return r.each(t,function(n,t){i+=(i?"&":"")+encodeURIComponent(t)+"="+encodeURIComponent(n)}),i&&(n+=(n.indexOf("?")>0?"&":"?")+i),n},formatSize:function(n){function u(n,t){return Math.round(n*Math.pow(10,t))/Math.pow(10,t)}if(n===i||/\D/.test(n))return r.translate("N/A");var t=Math.pow(1024,4);return n>t?u(n/t,1)+" "+r.translate("tb"):n>(t/=1024)?u(n/t,1)+" "+r.translate("gb"):n>(t/=1024)?u(n/t,1)+" "+r.translate("mb"):n>1024?Math.round(n/1024)+" "+r.translate("kb"):n+" "+r.translate("b")},parseSize:t.parseSizeStr,predictRuntime:function(n,i){var u,f;return u=new r.Uploader(n),f=t.Runtime.thatCan(u.getOption().required_features,i||n.runtimes),u.destroy(),f},addFileFilter:function(n,t){f[n]=t}};r.addFileFilter("mime_types",function(n,t,i){n.length&&!n.regexp.test(t.name)?(this.trigger("Error",{code:r.FILE_EXTENSION_ERROR,message:r.translate("图片类型选择错误."),file:t}),i(!1)):i(!0)});r.addFileFilter("max_file_size",function(n,t,i){var u;n=r.parseSize(n);t.size!==u&&n&&t.size>n?(this.trigger("Error",{code:r.FILE_SIZE_ERROR,message:r.translate("File size error."),file:t}),i(!1)):i(!0)});r.addFileFilter("prevent_duplicates",function(n,t,i){if(n)for(var u=this.files.length;u--;)if(t.name===this.files[u].name&&t.size===this.files[u].size){this.trigger("Error",{code:r.FILE_DUPLICATE_ERROR,message:r.translate("Duplicate file error."),file:t});i(!1);return}i(!0)});r.Uploader=function(n){function w(){var n,i=0,t;if(this.state==r.STARTED){for(t=0;t<h.length;t++)!n&&h[t].status==r.QUEUED?(n=h[t],this.trigger("BeforeUpload",n)&&(n.status=r.UPLOADING,this.trigger("UploadFile",n))):i++;i==h.length&&(this.state!==r.STOPPED&&(this.state=r.STOPPED,this.trigger("StateChanged")),this.trigger("UploadComplete",h))}}function d(n){n.percent=n.size>0?Math.ceil(n.loaded/n.size*100):100;p()}function p(){var t,n;for(c.reset(),t=0;t<h.length;t++)n=h[t],n.size!==i?(c.size+=n.origSize,c.loaded+=n.loaded*n.origSize/n.size):c.size=i,n.status==r.DONE?c.uploaded++:n.status==r.FAILED?c.failed++:c.queued++;c.size===i?c.percent=h.length>0?Math.ceil(c.uploaded/h.length*100):0:(c.bytesPerSec=Math.ceil(c.loaded/((+new Date-k||1)/1e3)),c.percent=c.size>0?Math.ceil(c.loaded/c.size*100):0)}function b(){var n=l[0]||v[0];return n?n.getRuntime().uid:!1}function it(n,i){if(n.ruid){var r=t.Runtime.getInfo(n.ruid);if(r)return r.can(i)}return!1}function rt(){this.bind("FilesAdded FilesRemoved",function(n){n.trigger("QueueChanged");n.refresh()});this.bind("CancelUpload",ht);this.bind("BeforeUpload",ft);this.bind("UploadFile",et);this.bind("UploadProgress",ot);this.bind("StateChanged",st);this.bind("QueueChanged",p);this.bind("Error",lt);this.bind("FileUploaded",ct);this.bind("Destroy",at)}function g(n,i){var u=this,f=0,e=[],o={runtime_order:n.runtimes,required_caps:n.required_features,preferred_caps:a,swf_url:n.flash_swf_url,xap_url:n.silverlight_xap_url};r.each(n.runtimes.split(/\s*,\s*/),function(t){n[t]&&(o[t]=n[t])});n.browse_button&&r.each(n.browse_button,function(i){e.push(function(e){var s=new t.FileInput(r.extend({},o,{accept:n.filters.mime_types,name:n.file_data_name,multiple:n.multi_selection,container:n.container,browse_button:i}));s.onready=function(){var n=t.Runtime.getInfo(this.ruid);t.extend(u.features,{chunks:n.can("slice_blob"),multipart:n.can("send_multipart"),multi_selection:n.can("select_multiple")});f++;l.push(this);e()};s.onchange=function(){u.addFile(this.files)};s.bind("mouseenter mouseleave mousedown mouseup",function(r){y||(n.browse_button_hover&&("mouseenter"===r.type?t.addClass(i,n.browse_button_hover):"mouseleave"===r.type&&t.removeClass(i,n.browse_button_hover)),n.browse_button_active&&("mousedown"===r.type?t.addClass(i,n.browse_button_active):"mouseup"===r.type&&t.removeClass(i,n.browse_button_active)))});s.bind("mousedown",function(){u.trigger("Browse")});s.bind("error runtimeerror",function(){s=null;e()});s.init()})});n.drop_element&&r.each(n.drop_element,function(n){e.push(function(i){var e=new t.FileDrop(r.extend({},o,{drop_zone:n}));e.onready=function(){var n=t.Runtime.getInfo(this.ruid);u.features.dragdrop=n.can("drag_and_drop");f++;v.push(this);i()};e.ondrop=function(){u.addFile(this.files)};e.bind("error runtimeerror",function(){e=null;i()});e.init()})});t.inSeries(e,function(){typeof i=="function"&&i(f)})}function ut(n,r,u){var f=new t.Image;try{f.onload=function(){if(r.width>this.width&&r.height>this.height&&r.quality===i&&r.preserve_headers&&!r.crop)return this.destroy(),u(n);f.downsize(r.width,r.height,r.crop,r.preserve_headers)};f.onresize=function(){u(this.getAsBlob(n.type,r.quality));this.destroy()};f.onerror=function(){u(n)};f.load(n)}catch(e){u(n)}}function nt(n,i,u){function s(n,t,i){var u=o[n];switch(n){case"max_file_size":n==="max_file_size"&&(o.max_file_size=o.filters.max_file_size=t);break;case"chunk_size":(t=r.parseSize(t))&&(o[n]=t,o.send_file_name=!0);break;case"multipart":o[n]=t;t||(o.send_file_name=!0);break;case"unique_names":o[n]=t;t&&(o.send_file_name=!0);break;case"filters":r.typeOf(t)==="array"&&(t={mime_types:t});i?r.extend(o.filters,t):o.filters=t;t.mime_types&&(o.filters.mime_types.regexp=function(n){var t=[];return r.each(n,function(n){r.each(n.extensions.split(/,/),function(n){/^\s*\*\s*$/.test(n)?t.push("\\.*"):t.push("\\."+n.replace(new RegExp("["+"/^$.*+?|()[]{}\\".replace(/./g,"\\$&")+"]","g"),"\\$&"))})}),new RegExp("("+t.join("|")+")$","i")}(o.filters.mime_types));break;case"resize":i?r.extend(o.resize,t,{enabled:!0}):o.resize=t;break;case"prevent_duplicates":o.prevent_duplicates=o.filters.prevent_duplicates=!!t;break;case"browse_button":case"drop_element":t=r.get(t);case"container":case"runtimes":case"multi_selection":case"flash_swf_url":case"silverlight_xap_url":o[n]=t;i||(h=!0);break;default:o[n]=t}i||f.trigger("OptionChanged",n,t,u)}var f=this,h=!1;typeof n=="object"?r.each(n,function(n,t){s(t,n,u)}):s(n,i,u);u?(o.required_features=e(r.extend({},o)),a=e(r.extend({},o,{required_features:!0}))):h&&(f.trigger("Destroy"),g.call(f,o,function(n){n?(f.runtime=t.Runtime.getInfo(b()).type,f.trigger("Init",{runtime:f.runtime}),f.trigger("PostInit")):f.trigger("Error",{code:r.INIT_ERROR,message:r.translate("Init error.")})}))}function ft(n,t){if(n.settings.unique_names){var i=t.name.match(/\.([^.]+)$/),r="part";i&&(r=i[1]);t.target_name=t.id+"."+r}}function et(n,i){function v(){y-->0?u(h,1e3):(i.loaded=e,n.trigger("Error",{code:r.HTTP_ERROR,message:r.translate("HTTP Error."),file:i,response:s.responseText,status:s.status,responseHeaders:s.getAllResponseHeaders()}))}function h(){var w,b,p={},k;i.status===r.UPLOADING&&n.state!==r.STOPPED&&(n.settings.send_file_name&&(p.name=i.target_name||i.name),o&&l.chunks&&f.size>o?(k=Math.min(o,f.size-e),w=f.slice(e,e+k)):(k=f.size,w=f),o&&l.chunks&&(n.settings.send_chunk_number?(p.chunk=Math.ceil(e/o),p.chunks=Math.ceil(f.size/o)):(p.offset=e,p.total=f.size)),s=new t.XMLHttpRequest,s.upload&&(s.upload.onprogress=function(t){i.loaded=Math.min(i.size,e+t.loaded);n.trigger("UploadProgress",i)}),s.onload=function(){if(s.status>=400){v();return}y=n.settings.max_retries;k<f.size?(w.destroy(),e+=k,i.loaded=Math.min(e,f.size),n.trigger("ChunkUploaded",i,{offset:i.loaded,total:f.size,response:s.responseText,status:s.status,responseHeaders:s.getAllResponseHeaders()}),t.Env.browser==="Android Browser"&&n.trigger("UploadProgress",i)):i.loaded=i.size;w=b=null;!e||e>=f.size?(i.size!=i.origSize&&(f.destroy(),f=null),n.trigger("UploadProgress",i),i.status=r.DONE,n.trigger("FileUploaded",i,{response:s.responseText,status:s.status,responseHeaders:s.getAllResponseHeaders()})):u(h,1)},s.onerror=function(){v()},s.onloadend=function(){this.destroy();s=null},n.settings.multipart&&l.multipart?(s.open("post",c,!0),r.each(n.settings.headers,function(n,t){s.setRequestHeader(t,n)}),b=new t.FormData,r.each(r.extend(p,n.settings.multipart_params),function(n,t){b.append(t,n)}),b.append(n.settings.file_data_name,w),s.send(b,{runtime_order:n.settings.runtimes,required_caps:n.settings.required_features,preferred_caps:a,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url})):(c=r.buildUrl(n.settings.url,r.extend(p,n.settings.multipart_params)),s.open("post",c,!0),s.setRequestHeader("Content-Type","application/octet-stream"),r.each(n.settings.headers,function(n,t){s.setRequestHeader(t,n)}),s.send(w,{runtime_order:n.settings.runtimes,required_caps:n.settings.required_features,preferred_caps:a,swf_url:n.settings.flash_swf_url,xap_url:n.settings.silverlight_xap_url})))}var c=n.settings.url,o=n.settings.chunk_size,y=n.settings.max_retries,l=n.features,e=0,f;i.loaded&&(e=i.loaded=o?o*Math.floor(i.loaded/o):0);f=i.getSource();n.settings.resize.enabled&&it(f,"send_binary_string")&&!!~t.inArray(f.type,["image/jpeg","image/png"])?ut.call(this,f,n.settings.resize,function(n){f=n;i.size=n.size;h()}):h()}function ot(n,t){d(t)}function st(n){if(n.state==r.STARTED)k=+new Date;else if(n.state==r.STOPPED)for(var t=n.files.length-1;t>=0;t--)n.files[t].status==r.UPLOADING&&(n.files[t].status=r.QUEUED,p())}function ht(){s&&s.abort()}function ct(n){p();u(function(){w.call(n)},1)}function lt(n,t){t.code===r.INIT_ERROR?n.destroy():t.file&&(t.file.status=r.FAILED,d(t.file),n.state==r.STARTED&&(n.trigger("CancelUpload"),u(function(){w.call(n)},1)))}function at(n){n.stop();r.each(h,function(n){n.destroy()});h=[];l.length&&(r.each(l,function(n){n.destroy()}),l=[]);v.length&&(r.each(v,function(n){n.destroy()}),v=[]);a={};y=!1;k=s=null;c.reset()}var tt=r.guid(),o,h=[],a={},l=[],v=[],k,c,y=!1,s;o={runtimes:t.Runtime.order,max_retries:0,chunk_size:0,multipart:!0,multi_selection:!0,file_data_name:"file",flash_swf_url:"js/Moxie.swf",silverlight_xap_url:"js/Moxie.xap",filters:{mime_types:[],prevent_duplicates:!1,max_file_size:0},resize:{enabled:!1,preserve_headers:!0,crop:!1},send_file_name:!0,send_chunk_number:!0};nt.call(this,n,null,!0);c=new r.QueueProgress;r.extend(this,{id:tt,uid:tt,state:r.STOPPED,features:{},runtime:null,files:h,settings:o,total:c,init:function(){var n=this;if(typeof o.preinit=="function"?o.preinit(n):r.each(o.preinit,function(t,i){n.bind(i,t)}),rt.call(this),!o.browse_button||!o.url){this.trigger("Error",{code:r.INIT_ERROR,message:r.translate("Init error.")});return}g.call(this,o,function(i){typeof o.init=="function"?o.init(n):r.each(o.init,function(t,i){n.bind(i,t)});i?(n.runtime=t.Runtime.getInfo(b()).type,n.trigger("Init",{runtime:n.runtime}),n.trigger("PostInit")):n.trigger("Error",{code:r.INIT_ERROR,message:r.translate("Init error.")})})},setOption:function(n,t){nt.call(this,n,t,!this.runtime)},getOption:function(n){return n?o[n]:o},refresh:function(){l.length&&r.each(l,function(n){n.trigger("Refresh")});this.trigger("Refresh")},start:function(){this.state!=r.STARTED&&(this.state=r.STARTED,this.trigger("StateChanged"),w.call(this))},stop:function(){this.state!=r.STOPPED&&(this.state=r.STOPPED,this.trigger("StateChanged"),this.trigger("CancelUpload"))},disableBrowse:function(){y=arguments[0]!==i?arguments[0]:!0;l.length&&r.each(l,function(n){n.disable(y)});this.trigger("DisableBrowse",y)},getFile:function(n){for(var t=h.length-1;t>=0;t--)if(h[t].id===n)return h[t]},addFile:function(n,i){function a(n,i){var r=[];t.each(o.settings.filters,function(t,i){f[i]&&r.push(function(r){f[i].call(o,t,n,function(n){r(!n)})})});t.inSeries(r,i)}function e(n){var f=t.typeOf(n);if(n instanceof t.File){if(!n.ruid&&!n.isDetached()){if(!s)return!1;n.ruid=s;n.connectRuntime(s)}e(new r.File(n))}else n instanceof t.Blob?(e(n.getSource()),n.destroy()):n instanceof r.File?(i&&(n.name=i),c.push(function(t){a(n,function(i){i||(h.push(n),l.push(n),o.trigger("FileFiltered",n));u(t,1)})})):t.inArray(f,["file","blob"])!==-1?e(new t.File(null,n)):f==="node"&&t.typeOf(n.files)==="filelist"?t.each(n.files,e):f==="array"&&(i=null,t.each(n,e))}var o=this,c=[],l=[],s;s=b();e(n);c.length&&t.inSeries(c,function(){l.length&&o.trigger("FilesAdded",l)})},removeFile:function(n){for(var i=typeof n=="string"?n:n.id,t=h.length-1;t>=0;t--)if(h[t].id===i)return this.splice(t,1)[0]},splice:function(n,t){var u=h.splice(n===i?0:n,t===i?h.length:t),f=!1;return this.state==r.STARTED&&(r.each(u,function(n){if(n.status===r.UPLOADING)return f=!0,!1}),f&&this.stop()),this.trigger("FilesRemoved",u),r.each(u,function(n){n.destroy()}),f&&this.start(),u},bind:function(n,t,i){var u=this;r.Uploader.prototype.bind.call(this,n,function(){var n=[].slice.call(arguments);return n.splice(0,1,u),t.apply(this,n)},0,i)},destroy:function(){this.trigger("Destroy");o=c=null;this.unbindAll()}})};r.Uploader.prototype=t.EventTarget.instance;r.File=function(){function i(i){r.extend(this,{id:r.guid(),name:i.name||i.fileName,type:i.type||"",size:i.size||i.fileSize,origSize:i.size||i.fileSize,loaded:0,percent:0,status:r.QUEUED,lastModifiedDate:i.lastModifiedDate||(new Date).toLocaleString(),getNative:function(){var n=this.getSource().getSource();return t.inArray(t.typeOf(n),["blob","file"])!==-1?n:null},getSource:function(){return n[this.id]?n[this.id]:null},destroy:function(){var t=this.getSource();t&&(t.destroy(),delete n[this.id])}});n[this.id]=i}var n={};return i}();r.QueueProgress=function(){var n=this;n.size=0;n.loaded=0;n.uploaded=0;n.failed=0;n.queued=0;n.percent=0;n.bytesPerSec=0;n.reset=function(){n.size=n.loaded=n.uploaded=n.failed=n.queued=n.percent=n.bytesPerSec=0}};n.plupload=r}(window,mOxie);!function(n){function t(n,t,i){var r=new Date,u;r.setTime(r.getTime()+864e5*i);u="; expires="+r.toGMTString();document.cookie=n+"="+t+u+"; path=/"}function r(n){for(var r=n+"=",u=document.cookie.split(";"),t,i=0,f=u.length;f>i;i++){for(t=u[i];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(r))return t.substring(r.length,t.length)}return null}function i(){function o(n,i){for(var f="[qiniu-js-sdk]["+n+"]",u=f,r=0;r<i.length;r++)u+="string"==typeof i[r]?" "+i[r]:" "+t.stringifyJSON(i[r]);t.detectIEVersion()?console.log(u):(i.unshift(f),console.log.apply(console,i));document.getElementById("qiniu-js-sdk-log")&&(document.getElementById("qiniu-js-sdk-log").innerHTML+="<p>"+u+"<\/p>")}function s(t){var i=t.toLowerCase();n[i]=function(){if(window.console&&window.console.log&&n.level>=n[t]){var r=Array.prototype.slice.call(arguments);o(i,r)}}}var t=this,n,r,i;this.detectIEVersion=function(){for(var n=4,t=document.createElement("div"),i=t.getElementsByTagName("i");t.innerHTML="<!--[if gt IE "+n+"]><i><\/i><![endif]-->",i[0];)n++;return n>4?n:!1};n={MUTE:0,FATA:1,ERROR:2,WARN:3,INFO:4,DEBUG:5,TRACE:6,level:0};for(r in n)n.hasOwnProperty(r)&&"number"==typeof n[r]&&!n.hasOwnProperty(r.toLowerCase())&&s(r);i="https:"===window.location.protocol?"https://up.qbox.me":"http://upload.qiniu.com";var f=["http://upload.qiniu.com","http://up.qiniu.com"],u={http:["http://upload.qiniu.com","http://up.qiniu.com"],https:["https://up.qbox.me"]},e=0;this.resetUploadUrl=function(){var t="https:"===window.location.protocol?u.https:u.http,r=e%t.length;i=t[r];e++;n.debug("resetUploadUrl: "+i)};this.isImage=function(n){return n=n.split(/[?#]/)[0],/\.(png|jpg|jpeg|gif|bmp)$/i.test(n)};this.getFileExtension=function(n){var t=n.split(".");return 1===t.length||""===t[0]&&2===t.length?"":t.pop().toLowerCase()};this.utf8_encode=function(n){var i,t,f,h;if(null===n||"undefined"==typeof n)return"";var e=n+"",o="",r,u,s=0;for(r=u=0,s=e.length,i=0;s>i;i++){if(t=e.charCodeAt(i),f=null,128>t)u++;else if(t>127&&2048>t)f=String.fromCharCode(t>>6|192,63&t|128);else if(63488&t^!0)f=String.fromCharCode(t>>12|224,t>>6&63|128,63&t|128);else{if(64512&t^!0)throw new RangeError("Unmatched trail surrogate at "+i);if(h=e.charCodeAt(++i),64512&h^!0)throw new RangeError("Unmatched lead surrogate at "+(i-1));t=((1023&t)<<10)+(1023&h)+65536;f=String.fromCharCode(t>>18|240,t>>12&63|128,t>>6&63|128,63&t|128)}null!==f&&(u>r&&(o+=e.slice(r,u)),o+=f,r=u=i+1)}return u>r&&(o+=e.slice(r,s)),o};this.base64_decode=function(n){var i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",r,f,s,h,c,e,o,u,t=0,a=0,l=[];if(!n)return n;n+="";do h=i.indexOf(n.charAt(t++)),c=i.indexOf(n.charAt(t++)),e=i.indexOf(n.charAt(t++)),o=i.indexOf(n.charAt(t++)),u=h<<18|c<<12|e<<6|o,r=u>>16&255,f=u>>8&255,s=255&u,l[a++]=64===e?String.fromCharCode(r):64===o?String.fromCharCode(r,f):String.fromCharCode(r,f,s);while(t<n.length);return l.join("")};this.base64_encode=function(n){var r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f,e,o,s,h,c,l,i,u=0,v=0,t="",a=[];if(!n)return n;n=this.utf8_encode(n+"");do f=n.charCodeAt(u++),e=n.charCodeAt(u++),o=n.charCodeAt(u++),i=f<<16|e<<8|o,s=i>>18&63,h=i>>12&63,c=i>>6&63,l=63&i,a[v++]=r.charAt(s)+r.charAt(h)+r.charAt(c)+r.charAt(l);while(u<n.length);switch(t=a.join(""),n.length%3){case 1:t=t.slice(0,-2)+"==";break;case 2:t=t.slice(0,-1)+"="}return t};this.URLSafeBase64Encode=function(n){return n=this.base64_encode(n),n.replace(/\//g,"_").replace(/\+/g,"-")};this.URLSafeBase64Decode=function(n){return n=n.replace(/_/g,"/").replace(/-/g,"+"),this.base64_decode(n)};this.createAjax=function(){return window.XMLHttpRequest?new XMLHttpRequest:new ActiveXObject("Microsoft.XMLHTTP")};this.parseJSON=function(data){if(window.JSON&&window.JSON.parse)return window.JSON.parse(data);var rx_dangerous=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,text=String(data);return rx_dangerous.lastIndex=0,rx_dangerous.test(text)&&(text=text.replace(rx_dangerous,function(n){return"\\u"+("0000"+n.charCodeAt(0).toString(16)).slice(-4)})),eval("("+text+")")};this.stringifyJSON=function(n){var u,e,i,f,r;if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(n);switch(typeof n){case"string":return'"'+n.replace(/(["\\])/g,"\\$1")+'"';case"array":return"["+n.map(t.stringifyJSON).join(",")+"]";case"object":if(n instanceof Array){for(u=[],e=n.length,i=0;e>i;i++)u.push(t.stringifyJSON(n[i]));return"["+u.join(",")+"]"}if(null===n)return"null";f=[];for(r in n)n.hasOwnProperty(r)&&f.push(t.stringifyJSON(r)+":"+t.stringifyJSON(n[r]));return"{"+f.join(",")+"}";case"number":return n;case!1:return n;case"boolean":return n}};this.trim=function(n){return null===n?"":n.replace(/^\s+|\s+$/g,"")};this.uploader=function(r){var k=function(){var i=t.detectIEVersion(),u,n,f,e="Safari"===mOxie.Env.browser&&mOxie.Env.version<=5&&"Windows"===mOxie.Env.os&&"7"===mOxie.Env.osVersion||"Safari"===mOxie.Env.browser&&"iOS"===mOxie.Env.os&&"7"===mOxie.Env.osVersion;i&&9>i&&r.chunk_size&&r.runtimes.indexOf("flash")>=0?r.chunk_size=0:e?r.chunk_size=0:(u=20,n=4<<u,f=plupload.parseSize(r.chunk_size),f>n&&(r.chunk_size=n))},p=function(n){for(var r=[],i,t=0;t<n.length;t++)i=n[t],0===i.indexOf("-H")?r.push(i.split(" ")[2]):r.push(i);return r},d=function(n){var r=n.split(":"),u=r[0],i=t.parseJSON(t.URLSafeBase64Decode(r[2]));return i.ak=u,i.scope.indexOf(":")>=0?(i.bucket=i.scope.split(":")[0],i.key=i.scope.split(":")[1]):i.bucket=i.scope,i},g=function(i){var o=d(i),h=window.location.protocol+"//uc.qbox.me/v1/query?ak="+o.ak+"&bucket="+o.bucket,e,f,s;n.debug("putPolicy: ",o);n.debug("get uphosts from: ",h);e=t.detectIEVersion();e&&9>=e?(f=new mOxie.XMLHttpRequest,mOxie.Env.swf_url=r.flash_swf_url):f=t.createAjax();f.open("GET",h,!1);s=function(){if(n.debug("ajax.readyState: ",f.readyState),4===f.readyState)if(n.debug("ajax.status: ",f.status),f.status<400){var i=t.parseJSON(f.responseText);u.http=p(i.http.up);u.https=p(i.https.up);n.debug("get new uphosts: ",u);t.resetUploadUrl()}else n.error("get uphosts error: ",f.responseText)};e&&9>=e?f.bind("readystatechange",s):f.onreadystatechange=s;f.send()},w=function(n){return!t.token||r.uptoken_url&&t.tokenInfo.isExpired()?c(n):t.token},c=function(i){var u,e,o,s;if(r.uptoken)t.token=r.uptoken;else if(r.uptoken_url)if(n.debug("get uptoken from: ",t.uptoken_url),u=t.createAjax(),u.open("GET",t.uptoken_url,!1),u.setRequestHeader("If-Modified-Since","0"),u.send(),200===u.status){e=t.parseJSON(u.responseText);t.token=e.uptoken;o=t.token.split(":");s=t.parseJSON(t.URLSafeBase64Decode(o[2]));t.tokenMap||(t.tokenMap={});var f=function(n){return Math.ceil(n.getTime()/1e3)},h=f(new Date(u.getResponseHeader("date"))),c=f(new Date);t.tokenInfo={serverDelay:c-h,deadline:s.deadline,isExpired:function(){var n=this.deadline-f(new Date)+this.serverDelay;return 600>n}};n.debug("get new uptoken: ",t.token);n.debug("get token info: ",t.tokenInfo)}else n.error("get uptoken error: ",u.responseText);else r.uptoken_func?(n.debug("get uptoken from uptoken_func"),t.token=r.uptoken_func(i),n.debug("get new uptoken: ",t.token)):n.error("one of [uptoken, uptoken_url, uptoken_func] settings in options is required!");return t.token&&g(t.token),t.token},b=function(n,i,u){var f="",e=!1,o;return r.save_key||((e=n.getOption&&n.getOption("unique_names"),e=e||n.settings&&n.settings.unique_names)?(o=t.getFileExtension(i.name),f=o?i.id+"."+o:i.id):f="function"==typeof u?u(n,i):i.name),f},o,s,a,v,e,y,h;if(r.log_level&&(n.level=r.log_level),!r.domain)throw"domain setting in options is required!";if(!r.browse_button)throw"browse_button setting in options is required!";if(!r.uptoken&&!r.uptoken_url&&!r.uptoken_func)throw"one of [uptoken, uptoken_url, uptoken_func] settings in options is required!";n.debug("init uploader start");n.debug("environment: ",mOxie.Env);n.debug("userAgent: ",navigator.userAgent);var l={},nt=r.init&&r.init.Error,tt=r.init&&r.init.FileUploaded;return r.init.Error=function(){},r.init.FileUploaded=function(){},t.uptoken_url=r.uptoken_url,t.token="",t.key_handler="function"==typeof r.init.Key?r.init.Key:"",this.domain=r.domain,o="",s={isResumeUpload:!1,resumeFilesize:0,startTime:"",currentTime:""},k(),n.debug("invoke reset_chunk_size()"),n.debug("op.chunk_size: ",r.chunk_size),a={url:i,multipart_params:{token:""}},v=t.detectIEVersion(),v&&9>=v&&(a.multipart_params.accept="text/plain; charset=utf-8",n.debug("add accept text/plain in multipart params")),plupload.extend(l,r,a),n.debug("option: ",l),e=new plupload.Uploader(l),n.debug("new plupload.Uploader(option)"),e.bind("Init",function(){n.debug("Init event activated");r.get_new_uptoken||c(null)}),n.debug("bind Init event"),e.bind("FilesAdded",function(i,r){var u,o,f,e,s;if(n.debug("FilesAdded event activated"),u=i.getOption&&i.getOption("auto_start"),u=u||i.settings&&i.settings.auto_start,n.debug("auto_start: ",u),n.debug("files: ",r),o=function(){return"ios"===mOxie.Env.OS.toLowerCase()?!0:!1},o())for(f=0;f<r.length;f++)e=r[f],s=t.getFileExtension(e.name),e.name=e.id+"."+s;u&&setTimeout(function(){i.start();n.debug("invoke up.start()")},0);i.refresh()}),n.debug("bind FilesAdded event"),e.bind("BeforeUpload",function(u,f){var h,a,v,y;n.debug("BeforeUpload event activated");f.speed=f.speed||0;o="";r.get_new_uptoken&&c(f);var p=function(u,f,e){var c,l,o,h;if(s.startTime=(new Date).getTime(),c=r.save_key?{token:t.token}:{key:b(u,f,e),token:t.token},l=t.detectIEVersion(),l&&9>=l&&(c.accept="text/plain; charset=utf-8",n.debug("add accept text/plain in multipart params")),n.debug("directUpload multipart_params_obj: ",c),o=r.x_vars,void 0!==o&&"object"==typeof o)for(h in o)o.hasOwnProperty(h)&&("function"==typeof o[h]?c["x:"+h]=o[h](u,f):"object"!=typeof o[h]&&(c["x:"+h]=o[h]));u.setOption({url:i,multipart:!0,chunk_size:k()?r.max_file_size:void 0,multipart_params:c})},k=function(){var n=navigator.userAgent.toLowerCase();return(n.match(/MicroMessenger/i)||"QQBrowser"===mOxie.Env.browser||n.match(/V1_AND_SQ/i))&&"android"===mOxie.Env.OS.toLowerCase()?!0:!1},l=u.getOption&&u.getOption("chunk_size");if(l=l||u.settings&&u.settings.chunk_size,n.debug("uploader.runtime: ",e.runtime),n.debug("chunk_size: ",l),("html5"===e.runtime||"flash"===e.runtime)&&l)if(f.size<l||k())n.debug("directUpload because file.size < chunk_size || is_android_weixin_or_qq()"),p(u,f,t.key_handler);else{if(h=localStorage.getItem(f.name),a=l,h){h=t.parseJSON(h);var d=(new Date).getTime(),g=h.time||0;864e5>d-g&&100!==h.percent&&f.size===h.total?(f.percent=h.percent,f.loaded=h.offset,o=h.ctx,s.isResumeUpload=!0,s.resumeFilesize=h.offset,h.offset+a>f.size&&(a=f.size-h.offset)):localStorage.removeItem(f.name)}s.startTime=(new Date).getTime();v={};y=t.detectIEVersion();y&&9>=y&&(v.accept="text/plain; charset=utf-8",n.debug("add accept text/plain in multipart params"));u.setOption({url:i+"/mkblk/"+a,multipart:!1,chunk_size:l,required_features:"chunks",headers:{Authorization:"UpToken "+w(f)},multipart_params:v})}else n.debug("directUpload because uploader.runtime !== 'html5' || uploader.runtime !== 'flash' || !chunk_size"),p(u,f,t.key_handler)}),n.debug("bind BeforeUpload event"),e.bind("UploadProgress",function(t,i){n.trace("UploadProgress event activated");s.currentTime=(new Date).getTime();var u=s.currentTime-s.startTime,r=i.loaded||0;s.isResumeUpload&&(r=i.loaded-s.resumeFilesize);i.speed=(r/u*1e3).toFixed(0)||0}),n.debug("bind UploadProgress event"),e.bind("ChunkUploaded",function(r,u,f){var e,s,h;n.debug("ChunkUploaded event activated");n.debug("file: ",u);n.debug("info: ",f);e=t.parseJSON(f.response);n.debug("res: ",e);o=o?o+","+e.ctx:e.ctx;s=f.total-f.offset;h=r.getOption&&r.getOption("chunk_size");h=h||r.settings&&r.settings.chunk_size;h>s&&(r.setOption({url:i+"/mkblk/"+s}),n.debug("up.setOption url: ",i+"/mkblk/"+s));r.setOption({headers:{Authorization:"UpToken "+w(u)}});localStorage.setItem(u.name,t.stringifyJSON({ctx:o,percent:u.percent,total:f.total,offset:f.offset,time:(new Date).getTime()}))}),n.debug("bind ChunkUploaded event"),y=f.length,h=function(n){return y-->0?(setTimeout(function(){t.resetUploadUrl();n.status=plupload.QUEUED;e.stop();e.start()},0),!0):(y=f.length,!1)},e.bind("Error",function(i){return function(r,u){var f,o,c,s,l;if(n.error("Error event activated"),n.error("err: ",u),f="",o=u.file,o){switch(u.code){case plupload.FAILED:f="上传失败。请稍后再试。";break;case plupload.FILE_SIZE_ERROR:c=r.getOption&&r.getOption("max_file_size");c=c||r.settings&&r.settings.max_file_size;f="浏览器最大可上传"+c+"。更大文件请使用命令行工具。";break;case plupload.FILE_EXTENSION_ERROR:f="文件验证失败。请稍后重试。";break;case plupload.HTTP_ERROR:if(""===u.response){if(f=u.message||"未知网络错误。",!h(o))return;break}s=t.parseJSON(u.response);l=s.error;switch(u.status){case 400:f="请求报文格式错误。";break;case 401:f="客户端认证授权失败。请重试或提交反馈。";break;case 405:f="客户端请求错误。请重试或提交反馈。";break;case 579:f="资源上传成功，但回调失败。";break;case 599:if(f="网络连接异常。请重试或提交反馈。",!h(o))return;break;case 614:f="文件已存在。";try{s=t.parseJSON(s.error);l=s.error||"file exists"}catch(a){l=s.error||"file exists"}break;case 631:f="指定空间不存在。";break;case 701:f="上传数据块校验出错。请重试或提交反馈。";break;default:if(f="未知错误。",!h(o))return}f=f+"("+u.status+"："+l+")";break;case plupload.SECURITY_ERROR:f="安全配置错误。请联系网站管理员。";break;case plupload.GENERIC_ERROR:f="上传失败。请稍后再试。";break;case plupload.IO_ERROR:f="上传失败。请稍后再试。";break;case plupload.INIT_ERROR:f="网站配置错误。请联系网站管理员。";e.destroy();break;default:if(f=u.message+u.details,!h(o))return}i&&i(r,u,f)}r.refresh()}}(nt)),n.debug("bind Error event"),e.bind("FileUploaded",function(u){return function(f,s,h){var p,g,v,nt,a,k,y,c,d;if(n.debug("FileUploaded event activated"),n.debug("file: ",s),n.debug("info: ",h),p=function(n,i,f){if(r.downtoken_url){var o=t.createAjax();o.open("POST",r.downtoken_url,!0);o.setRequestHeader("Content-type","application/x-www-form-urlencoded");o.onreadystatechange=function(){var s,r;if(4===o.readyState)if(200===o.status){try{s=t.parseJSON(o.responseText)}catch(h){throw"invalid json format";}r={};plupload.extend(r,t.parseJSON(f),s);u&&u(n,i,t.stringifyJSON(r))}else e.trigger("Error",{status:o.status,response:o.responseText,file:i,code:plupload.HTTP_ERROR})};o.send("key="+t.parseJSON(f).key+"&domain="+r.domain)}else u&&u(n,i,f)},g=t.parseJSON(h.response),o=o?o:g.ctx,n.debug("ctx: ",o),o){v="";n.debug("save_key: ",r.save_key);r.save_key||(v=b(f,s,t.key_handler),v=v?"/key/"+t.URLSafeBase64Encode(v):"");nt="/fname/"+t.URLSafeBase64Encode(s.name);n.debug("op.x_vars: ",r.x_vars);var l=r.x_vars,w="",tt="";if(void 0!==l&&"object"==typeof l)for(a in l)l.hasOwnProperty(a)&&("function"==typeof l[a]?w=t.URLSafeBase64Encode(l[a](f,s)):"object"!=typeof l[a]&&(w=t.URLSafeBase64Encode(l[a])),tt+="/x:"+a+"/"+w);k=i+"/mkfile/"+s.size+v+nt+tt;y=t.detectIEVersion();y&&9>=y?(c=new mOxie.XMLHttpRequest,mOxie.Env.swf_url=r.flash_swf_url):c=t.createAjax();c.open("POST",k,!0);c.setRequestHeader("Content-Type","text/plain;charset=UTF-8");c.setRequestHeader("Authorization","UpToken "+t.token);d=function(){if(n.debug("ajax.readyState: ",c.readyState),4===c.readyState){localStorage.removeItem(s.name);var t;200===c.status?(t=c.responseText,n.debug("mkfile is success: ",t),p(f,s,t)):(t={status:c.status,response:c.responseText,file:s,code:-200,responseHeaders:c.getAllResponseHeaders()},n.debug("mkfile is error: ",t),e.trigger("Error",t))}};y&&9>=y?c.bind("readystatechange",d):c.onreadystatechange=d;c.send(o);n.debug("mkfile: ",k)}else p(f,s,h.response)}}(tt)),n.debug("bind FileUploaded event"),e.init(),n.debug("invoke uploader.init()"),n.debug("init uploader end"),e};this.getUrl=function(n){if(!n)return!1;n=encodeURI(n);var t=this.domain;return"/"!==t.slice(t.length-1)&&(t+="/"),t+n};this.imageView2=function(n,t){var i;if(!/^\d$/.test(n.mode))return!1;var o=n.mode,r=n.w||"",u=n.h||"",f=n.q||"",e=n.format||"";return!r&&!u?!1:(i="imageView2/"+o,i+=r?"/w/"+r:"",i+=u?"/h/"+u:"",i+=f?"/q/"+f:"",i+=e?"/format/"+e:"",t&&(i=this.getUrl(t)+"?"+i),i)};this.imageMogr2=function(n,t){var c=n["auto-orient"]||"",r=n.thumbnail||"",l=n.strip||"",u=n.gravity||"",f=n.crop||"",e=n.quality||"",o=n.rotate||"",s=n.format||"",h=n.blur||"",i="imageMogr2";return i+=c?"/auto-orient":"",i+=r?"/thumbnail/"+r:"",i+=l?"/strip":"",i+=u?"/gravity/"+u:"",i+=e?"/quality/"+e:"",i+=f?"/crop/"+f:"",i+=o?"/rotate/"+o:"",i+=s?"/format/"+s:"",i+=h?"/blur/"+h:"",t&&(i=this.getUrl(t)+"?"+i),i};this.watermark=function(n,t){var r=n.mode,i,u;if(!r)return!1;if(i="watermark/"+r,1===r){if(u=n.image||"",!u)return!1;i+=u?"/image/"+this.URLSafeBase64Encode(u):""}else{if(2!==r)return!1;var f=n.text?n.text:"",e=n.font?n.font:"",o=n.fontsize?n.fontsize:"",s=n.fill?n.fill:"";if(!f)return!1;i+=f?"/text/"+this.URLSafeBase64Encode(f):"";i+=e?"/font/"+this.URLSafeBase64Encode(e):"";i+=o?"/fontsize/"+o:"";i+=s?"/fill/"+this.URLSafeBase64Encode(s):""}var h=n.dissolve||"",c=n.gravity||"",l=n.dx||"",a=n.dy||"";return i+=h?"/dissolve/"+h:"",i+=c?"/gravity/"+c:"",i+=l?"/dx/"+l:"",i+=a?"/dy/"+a:"",t&&(i=this.getUrl(t)+"?"+i),i};this.imageInfo=function(n){if(!n)return!1;var r=this.getUrl(n)+"?imageInfo",t=this.createAjax(),i,u=this;return t.open("GET",r,!1),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&(i=u.parseJSON(t.responseText))},t.send(),i};this.exif=function(n){if(!n)return!1;var r=this.getUrl(n)+"?exif",t=this.createAjax(),i,u=this;return t.open("GET",r,!1),t.onreadystatechange=function(){4===t.readyState&&200===t.status&&(i=u.parseJSON(t.responseText))},t.send(),i};this.get=function(n,t){return t&&n?"exif"===n?this.exif(t):"imageInfo"===n?this.imageInfo(t):!1:!1};this.pipeline=function(n,t){var s="[object Array]"===Object.prototype.toString.call(n),r,e,i="",u,o,f;if(s){for(u=0,o=n.length;o>u;u++){if(r=n[u],!r.fop)return!1;switch(r.fop){case"watermark":i+=this.watermark(r)+"|";break;case"imageView2":i+=this.imageView2(r)+"|";break;case"imageMogr2":i+=this.imageMogr2(r)+"|";break;default:e=!0}if(e)return!1}return t&&(i=this.getUrl(t)+"?"+i,f=i.length,"|"===i.slice(f-1)&&(i=i.slice(0,f-1))),i}return!1}}window.localStorage||(window.localStorage={setItem:function(n,i){t(n,i,30)},getItem:function(n){return r(n)},removeItem:function(n){t(n,"",-1)}});var u=new i;n.Qiniu=u;n.QiniuJsSDK=i}(window);var DateFormatter;!function(){"use strict";var t,n,i,f,r,u;r=864e5;u=3600;t=function(n,t){return"string"==typeof n&&"string"==typeof t&&n.toLowerCase()===t.toLowerCase()};n=function(t,i,r){var f=r||"0",u=t.toString();return u.length<i?n(f+u,i):u};i=function(n){var u,r,t;for(n=n||{},u=1;u<arguments.length;u++)if(r=arguments[u])for(t in r)r.hasOwnProperty(t)&&("object"==typeof r[t]?i(n[t],r[t]):n[t]=r[t]);return n};f={dateSettings:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],meridiem:["AM","PM"],ordinal:function(n){var t=n%10,i={1:"st",2:"nd",3:"rd"};return 1!==Math.floor(n%100/10)&&i[t]?i[t]:"th"}},separators:/[ \-+\/\.T:@]/g,validParts:/[dDjlNSwzWFmMntLoYyaABgGhHisueTIOPZcrU]/g,intParts:/[djwNzmnyYhHgGis]/g,tzParts:/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,tzClip:/[^-+\dA-Z]/g};DateFormatter=function(n){var t=this,r=i(f,n);t.dateSettings=r.dateSettings;t.separators=r.separators;t.validParts=r.validParts;t.intParts=r.intParts;t.tzParts=r.tzParts;t.tzClip=r.tzClip};DateFormatter.prototype={constructor:DateFormatter,parseDate:function(n,i){var f,c,e,o,r,s,v,y,p,w,b=this,l=!1,h=!1,a=b.dateSettings,u={date:null,year:null,month:null,day:null,hour:0,min:0,sec:0};if(!n)return void 0;if(n instanceof Date)return n;if("number"==typeof n)return new Date(n);if("U"===i)return e=parseInt(n),e?new Date(1e3*e):n;if("string"!=typeof n)return"";if(f=i.match(b.validParts),!f||0===f.length)throw new Error("Invalid date format definition.");for(c=n.replace(b.separators,"\x00").split("\x00"),e=0;e<c.length;e++)switch(o=c[e],r=parseInt(o),f[e]){case"y":case"Y":p=o.length;2===p?u.year=parseInt((70>r?"20":"19")+o):4===p&&(u.year=r);l=!0;break;case"m":case"n":case"M":case"F":isNaN(o)?(s=a.monthsShort.indexOf(o),s>-1&&(u.month=s+1),s=a.months.indexOf(o),s>-1&&(u.month=s+1)):r>=1&&12>=r&&(u.month=r);l=!0;break;case"d":case"j":r>=1&&31>=r&&(u.day=r);l=!0;break;case"g":case"h":v=f.indexOf("a")>-1?f.indexOf("a"):f.indexOf("A")>-1?f.indexOf("A"):-1;w=c[v];v>-1?(y=t(w,a.meridiem[0])?0:t(w,a.meridiem[1])?12:-1,r>=1&&12>=r&&y>-1?u.hour=r+y-1:r>=0&&23>=r&&(u.hour=r)):r>=0&&23>=r&&(u.hour=r);h=!0;break;case"G":case"H":r>=0&&23>=r&&(u.hour=r);h=!0;break;case"i":r>=0&&59>=r&&(u.min=r);h=!0;break;case"s":r>=0&&59>=r&&(u.sec=r);h=!0}if(l===!0&&u.year&&u.month&&u.day)u.date=new Date(u.year,u.month-1,u.day,u.hour,u.min,u.sec,0);else{if(h!==!0)return!1;u.date=new Date(0,0,0,u.hour,u.min,u.sec,0)}return u.date},guessDate:function(n,t){if("string"!=typeof n)return n;var h,f,r,u,c=this,s=n.replace(c.separators,"\x00").split("\x00"),e=t.match(c.validParts),i=new Date,o=0;if(!/^[djmn]/g.test(e[0]))return n;for(f=0;f<s.length;f++){switch(o=2,r=s[f],u=parseInt(r.substr(0,2)),f){case 0:"m"===e[0]||"n"===e[0]?i.setMonth(u-1):i.setDate(u);break;case 1:"m"===e[0]||"n"===e[0]?i.setDate(u):i.setMonth(u-1);break;case 2:h=i.getFullYear();r.length<4?(i.setFullYear(parseInt(h.toString().substr(0,4-r.length)+r)),o=r.length):(i.setFullYear=parseInt(r.substr(0,4)),o=4);break;case 3:i.setHours(u);break;case 4:i.setMinutes(u);break;case 5:i.setSeconds(u)}r.substr(o).length>0&&s.splice(f+1,0,r.substr(o))}return i},parseFormat:function(t,i){var f,o=this,e=o.dateSettings,h=/\\?(.?)/gi,s=function(n,t){return f[n]?f[n]():t};return f={d:function(){return n(f.j(),2)},D:function(){return e.daysShort[f.w()]},j:function(){return i.getDate()},l:function(){return e.days[f.w()]},N:function(){return f.w()||7},w:function(){return i.getDay()},z:function(){var n=new Date(f.Y(),f.n()-1,f.j()),t=new Date(f.Y(),0,1);return Math.round((n-t)/r)},W:function(){var t=new Date(f.Y(),f.n()-1,f.j()-f.N()+3),i=new Date(t.getFullYear(),0,4);return n(1+Math.round((t-i)/r/7),2)},F:function(){return e.months[i.getMonth()]},m:function(){return n(f.n(),2)},M:function(){return e.monthsShort[i.getMonth()]},n:function(){return i.getMonth()+1},t:function(){return new Date(f.Y(),f.n(),0).getDate()},L:function(){var n=f.Y();return n%4==0&&n%100!=0||n%400==0?1:0},o:function(){var n=f.n(),t=f.W(),i=f.Y();return i+(12===n&&9>t?1:1===n&&t>9?-1:0)},Y:function(){return i.getFullYear()},y:function(){return f.Y().toString().slice(-2)},a:function(){return f.A().toLowerCase()},A:function(){var n=f.G()<12?0:1;return e.meridiem[n]},B:function(){var t=i.getUTCHours()*u,r=60*i.getUTCMinutes(),f=i.getUTCSeconds();return n(Math.floor((t+r+f+u)/86.4)%1e3,3)},g:function(){return f.G()%12||12},G:function(){return i.getHours()},h:function(){return n(f.g(),2)},H:function(){return n(f.G(),2)},i:function(){return n(i.getMinutes(),2)},s:function(){return n(i.getSeconds(),2)},u:function(){return n(1e3*i.getMilliseconds(),6)},e:function(){var n=/\((.*)\)/.exec(String(i))[1];return n||"Coordinated Universal Time"},T:function(){var n=(String(i).match(o.tzParts)||[""]).pop().replace(o.tzClip,"");return n||"UTC"},I:function(){var n=new Date(f.Y(),0),t=Date.UTC(f.Y(),0),i=new Date(f.Y(),6),r=Date.UTC(f.Y(),6);return n-t!=i-r?1:0},O:function(){var t=i.getTimezoneOffset(),r=Math.abs(t);return(t>0?"-":"+")+n(100*Math.floor(r/60)+r%60,4)},P:function(){var n=f.O();return n.substr(0,3)+":"+n.substr(3,2)},Z:function(){return 60*-i.getTimezoneOffset()},c:function(){return"Y-m-d\\TH:i:sP".replace(h,s)},r:function(){return"D, d M Y H:i:s O".replace(h,s)},U:function(){return i.getTime()/1e3||0}},s(t,t)},formatDate:function(n,t){var i,o,e,r,u,f=this,s="";if("string"==typeof n&&(n=f.parseDate(n,t),n===!1))return!1;if(n instanceof Date){for(e=t.length,i=0;e>i;i++)u=t.charAt(i),"S"!==u&&(r=f.parseFormat(u,n),i!==e-1&&f.intParts.test(u)&&"S"===t.charAt(i+1)&&(o=parseInt(r),r+=f.dateSettings.ordinal(o)),s+=r);return s}return""}}}(),function(n){"function"==typeof define&&define.amd?define(["jquery","jquery-mousewheel"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){"use strict";function u(n,t,i){this.date=n;this.desc=t;this.style=i}var r={i18n:{ar:{months:["كانون الثاني","شباط","آذار","نيسان","مايو","حزيران","تموز","آب","أيلول","تشرين الأول","تشرين الثاني","كانون الأول"],dayOfWeekShort:["ن","ث","ع","خ","ج","س","ح"],dayOfWeek:["الأحد","الاثنين","الثلاثاء","الأربعاء","الخميس","الجمعة","السبت","الأحد"]},ro:{months:["Ianuarie","Februarie","Martie","Aprilie","Mai","Iunie","Iulie","August","Septembrie","Octombrie","Noiembrie","Decembrie"],dayOfWeekShort:["Du","Lu","Ma","Mi","Jo","Vi","Sâ"],dayOfWeek:["Duminică","Luni","Marţi","Miercuri","Joi","Vineri","Sâmbătă"]},id:{months:["Januari","Februari","Maret","April","Mei","Juni","Juli","Agustus","September","Oktober","November","Desember"],dayOfWeekShort:["Min","Sen","Sel","Rab","Kam","Jum","Sab"],dayOfWeek:["Minggu","Senin","Selasa","Rabu","Kamis","Jumat","Sabtu"]},is:{months:["Janúar","Febrúar","Mars","Apríl","Maí","Júní","Júlí","Ágúst","September","Október","Nóvember","Desember"],dayOfWeekShort:["Sun","Mán","Þrið","Mið","Fim","Fös","Lau"],dayOfWeek:["Sunnudagur","Mánudagur","Þriðjudagur","Miðvikudagur","Fimmtudagur","Föstudagur","Laugardagur"]},bg:{months:["Януари","Февруари","Март","Април","Май","Юни","Юли","Август","Септември","Октомври","Ноември","Декември"],dayOfWeekShort:["Нд","Пн","Вт","Ср","Чт","Пт","Сб"],dayOfWeek:["Неделя","Понеделник","Вторник","Сряда","Четвъртък","Петък","Събота"]},fa:{months:["فروردین","اردیبهشت","خرداد","تیر","مرداد","شهریور","مهر","آبان","آذر","دی","بهمن","اسفند"],dayOfWeekShort:["یکشنبه","دوشنبه","سه شنبه","چهارشنبه","پنجشنبه","جمعه","شنبه"],dayOfWeek:["یک‌شنبه","دوشنبه","سه‌شنبه","چهارشنبه","پنج‌شنبه","جمعه","شنبه","یک‌شنبه"]},ru:{months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],dayOfWeekShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"],dayOfWeek:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"]},uk:{months:["Січень","Лютий","Березень","Квітень","Травень","Червень","Липень","Серпень","Вересень","Жовтень","Листопад","Грудень"],dayOfWeekShort:["Ндл","Пнд","Втр","Срд","Чтв","Птн","Сбт"],dayOfWeek:["Неділя","Понеділок","Вівторок","Середа","Четвер","П'ятниця","Субота"]},en:{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeekShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},el:{months:["Ιανουάριος","Φεβρουάριος","Μάρτιος","Απρίλιος","Μάιος","Ιούνιος","Ιούλιος","Αύγουστος","Σεπτέμβριος","Οκτώβριος","Νοέμβριος","Δεκέμβριος"],dayOfWeekShort:["Κυρ","Δευ","Τρι","Τετ","Πεμ","Παρ","Σαβ"],dayOfWeek:["Κυριακή","Δευτέρα","Τρίτη","Τετάρτη","Πέμπτη","Παρασκευή","Σάββατο"]},de:{months:["Januar","Februar","März","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],dayOfWeekShort:["So","Mo","Di","Mi","Do","Fr","Sa"],dayOfWeek:["Sonntag","Montag","Dienstag","Mittwoch","Donnerstag","Freitag","Samstag"]},nl:{months:["januari","februari","maart","april","mei","juni","juli","augustus","september","oktober","november","december"],dayOfWeekShort:["zo","ma","di","wo","do","vr","za"],dayOfWeek:["zondag","maandag","dinsdag","woensdag","donderdag","vrijdag","zaterdag"]},tr:{months:["Ocak","Şubat","Mart","Nisan","Mayıs","Haziran","Temmuz","Ağustos","Eylül","Ekim","Kasım","Aralık"],dayOfWeekShort:["Paz","Pts","Sal","Çar","Per","Cum","Cts"],dayOfWeek:["Pazar","Pazartesi","Salı","Çarşamba","Perşembe","Cuma","Cumartesi"]},fr:{months:["Janvier","Février","Mars","Avril","Mai","Juin","Juillet","Août","Septembre","Octobre","Novembre","Décembre"],dayOfWeekShort:["Dim","Lun","Mar","Mer","Jeu","Ven","Sam"],dayOfWeek:["dimanche","lundi","mardi","mercredi","jeudi","vendredi","samedi"]},es:{months:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],dayOfWeekShort:["Dom","Lun","Mar","Mié","Jue","Vie","Sáb"],dayOfWeek:["Domingo","Lunes","Martes","Miércoles","Jueves","Viernes","Sábado"]},th:{months:["มกราคม","กุมภาพันธ์","มีนาคม","เมษายน","พฤษภาคม","มิถุนายน","กรกฎาคม","สิงหาคม","กันยายน","ตุลาคม","พฤศจิกายน","ธันวาคม"],dayOfWeekShort:["อา.","จ.","อ.","พ.","พฤ.","ศ.","ส."],dayOfWeek:["อาทิตย์","จันทร์","อังคาร","พุธ","พฤหัส","ศุกร์","เสาร์","อาทิตย์"]},pl:{months:["styczeń","luty","marzec","kwiecień","maj","czerwiec","lipiec","sierpień","wrzesień","październik","listopad","grudzień"],dayOfWeekShort:["nd","pn","wt","śr","cz","pt","sb"],dayOfWeek:["niedziela","poniedziałek","wtorek","środa","czwartek","piątek","sobota"]},pt:{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeekShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sab"],dayOfWeek:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"]},ch:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeekShort:["日","一","二","三","四","五","六"]},se:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeekShort:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"]},kr:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeekShort:["일","월","화","수","목","금","토"],dayOfWeek:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},it:{months:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],dayOfWeekShort:["Dom","Lun","Mar","Mer","Gio","Ven","Sab"],dayOfWeek:["Domenica","Lunedì","Martedì","Mercoledì","Giovedì","Venerdì","Sabato"]},da:{months:["January","Februar","Marts","April","Maj","Juni","July","August","September","Oktober","November","December"],dayOfWeekShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],dayOfWeek:["søndag","mandag","tirsdag","onsdag","torsdag","fredag","lørdag"]},no:{months:["Januar","Februar","Mars","April","Mai","Juni","Juli","August","September","Oktober","November","Desember"],dayOfWeekShort:["Søn","Man","Tir","Ons","Tor","Fre","Lør"],dayOfWeek:["Søndag","Mandag","Tirsdag","Onsdag","Torsdag","Fredag","Lørdag"]},ja:{months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],dayOfWeekShort:["日","月","火","水","木","金","土"],dayOfWeek:["日曜","月曜","火曜","水曜","木曜","金曜","土曜"]},vi:{months:["Tháng 1","Tháng 2","Tháng 3","Tháng 4","Tháng 5","Tháng 6","Tháng 7","Tháng 8","Tháng 9","Tháng 10","Tháng 11","Tháng 12"],dayOfWeekShort:["CN","T2","T3","T4","T5","T6","T7"],dayOfWeek:["Chủ nhật","Thứ hai","Thứ ba","Thứ tư","Thứ năm","Thứ sáu","Thứ bảy"]},sl:{months:["Januar","Februar","Marec","April","Maj","Junij","Julij","Avgust","September","Oktober","November","December"],dayOfWeekShort:["Ned","Pon","Tor","Sre","Čet","Pet","Sob"],dayOfWeek:["Nedelja","Ponedeljek","Torek","Sreda","Četrtek","Petek","Sobota"]},cs:{months:["Leden","Únor","Březen","Duben","Květen","Červen","Červenec","Srpen","Září","Říjen","Listopad","Prosinec"],dayOfWeekShort:["Ne","Po","Út","St","Čt","Pá","So"]},hu:{months:["Január","Február","Március","Április","Május","Június","Július","Augusztus","Szeptember","Október","November","December"],dayOfWeekShort:["Va","Hé","Ke","Sze","Cs","Pé","Szo"],dayOfWeek:["vasárnap","hétfő","kedd","szerda","csütörtök","péntek","szombat"]},az:{months:["Yanvar","Fevral","Mart","Aprel","May","Iyun","Iyul","Avqust","Sentyabr","Oktyabr","Noyabr","Dekabr"],dayOfWeekShort:["B","Be","Ça","Ç","Ca","C","Ş"],dayOfWeek:["Bazar","Bazar ertəsi","Çərşənbə axşamı","Çərşənbə","Cümə axşamı","Cümə","Şənbə"]},bs:{months:["Januar","Februar","Mart","April","Maj","Jun","Jul","Avgust","Septembar","Oktobar","Novembar","Decembar"],dayOfWeekShort:["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],dayOfWeek:["Nedjelja","Ponedjeljak","Utorak","Srijeda","Četvrtak","Petak","Subota"]},ca:{months:["Gener","Febrer","Març","Abril","Maig","Juny","Juliol","Agost","Setembre","Octubre","Novembre","Desembre"],dayOfWeekShort:["Dg","Dl","Dt","Dc","Dj","Dv","Ds"],dayOfWeek:["Diumenge","Dilluns","Dimarts","Dimecres","Dijous","Divendres","Dissabte"]},"en-GB":{months:["January","February","March","April","May","June","July","August","September","October","November","December"],dayOfWeekShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],dayOfWeek:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},et:{months:["Jaanuar","Veebruar","Märts","Aprill","Mai","Juuni","Juuli","August","September","Oktoober","November","Detsember"],dayOfWeekShort:["P","E","T","K","N","R","L"],dayOfWeek:["Pühapäev","Esmaspäev","Teisipäev","Kolmapäev","Neljapäev","Reede","Laupäev"]},eu:{months:["Urtarrila","Otsaila","Martxoa","Apirila","Maiatza","Ekaina","Uztaila","Abuztua","Iraila","Urria","Azaroa","Abendua"],dayOfWeekShort:["Ig.","Al.","Ar.","Az.","Og.","Or.","La."],dayOfWeek:["Igandea","Astelehena","Asteartea","Asteazkena","Osteguna","Ostirala","Larunbata"]},fi:{months:["Tammikuu","Helmikuu","Maaliskuu","Huhtikuu","Toukokuu","Kesäkuu","Heinäkuu","Elokuu","Syyskuu","Lokakuu","Marraskuu","Joulukuu"],dayOfWeekShort:["Su","Ma","Ti","Ke","To","Pe","La"],dayOfWeek:["sunnuntai","maanantai","tiistai","keskiviikko","torstai","perjantai","lauantai"]},gl:{months:["Xan","Feb","Maz","Abr","Mai","Xun","Xul","Ago","Set","Out","Nov","Dec"],dayOfWeekShort:["Dom","Lun","Mar","Mer","Xov","Ven","Sab"],dayOfWeek:["Domingo","Luns","Martes","Mércores","Xoves","Venres","Sábado"]},hr:{months:["Siječanj","Veljača","Ožujak","Travanj","Svibanj","Lipanj","Srpanj","Kolovoz","Rujan","Listopad","Studeni","Prosinac"],dayOfWeekShort:["Ned","Pon","Uto","Sri","Čet","Pet","Sub"],dayOfWeek:["Nedjelja","Ponedjeljak","Utorak","Srijeda","Četvrtak","Petak","Subota"]},ko:{months:["1월","2월","3월","4월","5월","6월","7월","8월","9월","10월","11월","12월"],dayOfWeekShort:["일","월","화","수","목","금","토"],dayOfWeek:["일요일","월요일","화요일","수요일","목요일","금요일","토요일"]},lt:{months:["Sausio","Vasario","Kovo","Balandžio","Gegužės","Birželio","Liepos","Rugpjūčio","Rugsėjo","Spalio","Lapkričio","Gruodžio"],dayOfWeekShort:["Sek","Pir","Ant","Tre","Ket","Pen","Šeš"],dayOfWeek:["Sekmadienis","Pirmadienis","Antradienis","Trečiadienis","Ketvirtadienis","Penktadienis","Šeštadienis"]},lv:{months:["Janvāris","Februāris","Marts","Aprīlis ","Maijs","Jūnijs","Jūlijs","Augusts","Septembris","Oktobris","Novembris","Decembris"],dayOfWeekShort:["Sv","Pr","Ot","Tr","Ct","Pk","St"],dayOfWeek:["Svētdiena","Pirmdiena","Otrdiena","Trešdiena","Ceturtdiena","Piektdiena","Sestdiena"]},mk:{months:["јануари","февруари","март","април","мај","јуни","јули","август","септември","октомври","ноември","декември"],dayOfWeekShort:["нед","пон","вто","сре","чет","пет","саб"],dayOfWeek:["Недела","Понеделник","Вторник","Среда","Четврток","Петок","Сабота"]},mn:{months:["1-р сар","2-р сар","3-р сар","4-р сар","5-р сар","6-р сар","7-р сар","8-р сар","9-р сар","10-р сар","11-р сар","12-р сар"],dayOfWeekShort:["Дав","Мяг","Лха","Пүр","Бсн","Бям","Ням"],dayOfWeek:["Даваа","Мягмар","Лхагва","Пүрэв","Баасан","Бямба","Ням"]},"pt-BR":{months:["Janeiro","Fevereiro","Março","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],dayOfWeekShort:["Dom","Seg","Ter","Qua","Qui","Sex","Sáb"],dayOfWeek:["Domingo","Segunda","Terça","Quarta","Quinta","Sexta","Sábado"]},sk:{months:["Január","Február","Marec","Apríl","Máj","Jún","Júl","August","September","Október","November","December"],dayOfWeekShort:["Ne","Po","Ut","St","Št","Pi","So"],dayOfWeek:["Nedeľa","Pondelok","Utorok","Streda","Štvrtok","Piatok","Sobota"]},sq:{months:["Janar","Shkurt","Mars","Prill","Maj","Qershor","Korrik","Gusht","Shtator","Tetor","Nëntor","Dhjetor"],dayOfWeekShort:["Die","Hën","Mar","Mër","Enj","Pre","Shtu"],dayOfWeek:["E Diel","E Hënë","E Martē","E Mërkurë","E Enjte","E Premte","E Shtunë"]},"sr-YU":{months:["Januar","Februar","Mart","April","Maj","Jun","Jul","Avgust","Septembar","Oktobar","Novembar","Decembar"],dayOfWeekShort:["Ned","Pon","Uto","Sre","čet","Pet","Sub"],dayOfWeek:["Nedelja","Ponedeljak","Utorak","Sreda","Četvrtak","Petak","Subota"]},sr:{months:["јануар","фебруар","март","април","мај","јун","јул","август","септембар","октобар","новембар","децембар"],dayOfWeekShort:["нед","пон","уто","сре","чет","пет","суб"],dayOfWeek:["Недеља","Понедељак","Уторак","Среда","Четвртак","Петак","Субота"]},sv:{months:["Januari","Februari","Mars","April","Maj","Juni","Juli","Augusti","September","Oktober","November","December"],dayOfWeekShort:["Sön","Mån","Tis","Ons","Tor","Fre","Lör"],dayOfWeek:["Söndag","Måndag","Tisdag","Onsdag","Torsdag","Fredag","Lördag"]},"zh-TW":{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeekShort:["日","一","二","三","四","五","六"],dayOfWeek:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},zh:{months:["一月","二月","三月","四月","五月","六月","七月","八月","九月","十月","十一月","十二月"],dayOfWeekShort:["日","一","二","三","四","五","六"],dayOfWeek:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]},he:{months:["ינואר","פברואר","מרץ","אפריל","מאי","יוני","יולי","אוגוסט","ספטמבר","אוקטובר","נובמבר","דצמבר"],dayOfWeekShort:["א'","ב'","ג'","ד'","ה'","ו'","שבת"],dayOfWeek:["ראשון","שני","שלישי","רביעי","חמישי","שישי","שבת","ראשון"]},hy:{months:["Հունվար","Փետրվար","Մարտ","Ապրիլ","Մայիս","Հունիս","Հուլիս","Օգոստոս","Սեպտեմբեր","Հոկտեմբեր","Նոյեմբեր","Դեկտեմբեր"],dayOfWeekShort:["Կի","Երկ","Երք","Չոր","Հնգ","Ուրբ","Շբթ"],dayOfWeek:["Կիրակի","Երկուշաբթի","Երեքշաբթի","Չորեքշաբթի","Հինգշաբթի","Ուրբաթ","Շաբաթ"]},kg:{months:["Үчтүн айы","Бирдин айы","Жалган Куран","Чын Куран","Бугу","Кулжа","Теке","Баш Оона","Аяк Оона","Тогуздун айы","Жетинин айы","Бештин айы"],dayOfWeekShort:["Жек","Дүй","Шей","Шар","Бей","Жум","Ише"],dayOfWeek:["Жекшемб","Дүйшөмб","Шейшемб","Шаршемб","Бейшемби","Жума","Ишенб"]},rm:{months:["Schaner","Favrer","Mars","Avrigl","Matg","Zercladur","Fanadur","Avust","Settember","October","November","December"],dayOfWeekShort:["Du","Gli","Ma","Me","Gie","Ve","So"],dayOfWeek:["Dumengia","Glindesdi","Mardi","Mesemna","Gievgia","Venderdi","Sonda"]},ka:{months:["იანვარი","თებერვალი","მარტი","აპრილი","მაისი","ივნისი","ივლისი","აგვისტო","სექტემბერი","ოქტომბერი","ნოემბერი","დეკემბერი"],dayOfWeekShort:["კვ","ორშ","სამშ","ოთხ","ხუთ","პარ","შაბ"],dayOfWeek:["კვირა","ორშაბათი","სამშაბათი","ოთხშაბათი","ხუთშაბათი","პარასკევი","შაბათი"]}},value:"",rtl:!1,format:"Y-m-d",formatTime:"H:i",formatDate:"Y/m/d",startDate:!1,step:60,monthChangeSpinner:!0,closeOnDateSelect:!1,closeOnTimeSelect:!0,closeOnWithoutClick:!0,closeOnInputClick:!0,timepicker:!1,datepicker:!0,weeks:!1,defaultTime:!1,defaultDate:!1,minDate:!1,maxDate:!1,minTime:!1,maxTime:!1,disabledMinTime:!1,disabledMaxTime:!1,allowTimes:[],opened:!1,initTime:!0,inline:!1,theme:"",onSelectDate:function(){},onSelectTime:function(){},onChangeMonth:function(){},onGetWeekOfYear:function(){},onChangeYear:function(){},onChangeDateTime:function(){},onShow:function(){},onClose:function(){},onGenerate:function(){},withoutCopyright:!0,inverseButton:!1,hours12:!1,next:"xdsoft_next",prev:"xdsoft_prev",dayOfWeekStart:0,parentID:"body",timeHeightInTimePicker:25,timepickerScrollbar:!0,todayButton:!0,prevButton:!0,nextButton:!0,defaultSelect:!0,scrollMonth:!0,scrollTime:!0,scrollInput:!0,lazyInit:!1,mask:!1,validateOnBlur:!0,allowBlank:!0,yearStart:1950,yearEnd:2050,monthStart:0,monthEnd:11,style:"",id:"",fixed:!1,roundTime:"round",className:"",weekends:[],highlightedDates:[],highlightedPeriods:[],allowDates:[],allowDateRe:null,disabledDates:[],disabledWeekDays:[],yearOffset:0,beforeShowDay:null,enterLikeTab:!0,showApplyButton:!1},t=null,e="en",i="ch",o={meridiem:["AM","PM"]},f=function(){var u=r.i18n[i],f={days:u.dayOfWeek,daysShort:u.dayOfWeekShort,months:u.months,monthsShort:n.map(u.months,function(n){return n.substring(0,3)})};t=new DateFormatter({dateSettings:n.extend({},o,f)})};n.datetimepicker={setLocale:function(n){var t=r.i18n[n]?n:e;i!=t&&(i=t,f())},setDateFormatter:function(n){t=n},RFC_2822:"D, d M Y H:i:s O",ATOM:"Y-m-dTH:i:sP",ISO_8601:"Y-m-dTH:i:sO",RFC_822:"D, d M y H:i:s O",RFC_850:"l, d-M-y H:i:s T",RFC_1036:"D, d M y H:i:s O",RFC_1123:"D, d M Y H:i:s O",RSS:"D, d M Y H:i:s O",W3C:"Y-m-dTH:i:sP"};f();window.getComputedStyle||(window.getComputedStyle=function(n){return this.el=n,this.getPropertyValue=function(t){var i=/(\-([a-z]){1})/g;return"float"===t&&(t="styleFloat"),i.test(t)&&(t=t.replace(i,function(n,t,i){return i.toUpperCase()})),n.currentStyle[t]||null},this});Array.prototype.indexOf||(Array.prototype.indexOf=function(n,t){for(var i=t||0,r=this.length;r>i;i+=1)if(this[i]===n)return i;return-1});Date.prototype.countDaysInMonth=function(){return new Date(this.getFullYear(),this.getMonth()+1,0).getDate()};n.fn.xdsoftScroller=function(t){return this.each(function(){var f,u,e,o,r,i=n(this),s=function(n){var i,t={x:0,y:0};return"touchstart"===n.type||"touchmove"===n.type||"touchend"===n.type||"touchcancel"===n.type?(i=n.originalEvent.touches[0]||n.originalEvent.changedTouches[0],t.x=i.clientX,t.y=i.clientY):("mousedown"===n.type||"mouseup"===n.type||"mousemove"===n.type||"mouseover"===n.type||"mouseout"===n.type||"mouseenter"===n.type||"mouseleave"===n.type)&&(t.x=n.clientX,t.y=n.clientY),t},h=100,c=!1,w=0,a=0,v=0,y=!1,p=0,l=function(){};return"hide"===t?void i.find(".xdsoft_scrollbar").hide():(n(this).hasClass("xdsoft_scroller_box")||(f=i.children().eq(0),u=i[0].clientHeight,e=f[0].offsetHeight,o=n('<div class="xdsoft_scrollbar"><\/div>'),r=n('<div class="xdsoft_scroller"><\/div>'),o.append(r),i.addClass("xdsoft_scroller_box").append(o),l=function(n){var t=s(n).y-w+p;0>t&&(t=0);t+r[0].offsetHeight>v&&(t=v-r[0].offsetHeight);i.trigger("scroll_element.xdsoft_scroller",[h?t/h:0])},r.on("touchstart.xdsoft_scroller mousedown.xdsoft_scroller",function(f){u||i.trigger("resize_scroll.xdsoft_scroller",[t]);w=s(f).y;p=parseInt(r.css("margin-top"),10);v=o[0].offsetHeight;"mousedown"===f.type||"touchstart"===f.type?(document&&n(document.body).addClass("xdsoft_noselect"),n([document.body,window]).on("touchend mouseup.xdsoft_scroller",function e(){n([document.body,window]).off("touchend mouseup.xdsoft_scroller",e).off("mousemove.xdsoft_scroller",l).removeClass("xdsoft_noselect")}),n(document.body).on("mousemove.xdsoft_scroller",l)):(y=!0,f.stopPropagation(),f.preventDefault())}).on("touchmove",function(n){y&&(n.preventDefault(),l(n))}).on("touchend touchcancel",function(){y=!1;p=0}),i.on("scroll_element.xdsoft_scroller",function(n,t){u||i.trigger("resize_scroll.xdsoft_scroller",[t,!0]);t=t>1?1:0>t||isNaN(t)?0:t;r.css("margin-top",h*t);setTimeout(function(){f.css("marginTop",-parseInt((f[0].offsetHeight-u)*t,10))},10)}).on("resize_scroll.xdsoft_scroller",function(n,t,s){var c,l;u=i[0].clientHeight;e=f[0].offsetHeight;c=u/e;l=c*o[0].offsetHeight;c>1?r.hide():(r.show(),r.css("height",parseInt(l>10?l:10,10)),h=o[0].offsetHeight-r[0].offsetHeight,s!==!0&&i.trigger("scroll_element.xdsoft_scroller",[t||Math.abs(parseInt(f.css("marginTop"),10))/(e-u)]))}),i.on("mousewheel",function(n){var t=Math.abs(parseInt(f.css("marginTop"),10));return t-=20*n.deltaY,0>t&&(t=0),i.trigger("scroll_element.xdsoft_scroller",[t/(e-u)]),n.stopPropagation(),!1}),i.on("touchstart",function(n){c=s(n);a=Math.abs(parseInt(f.css("marginTop"),10))}),i.on("touchmove",function(n){if(c){n.preventDefault();var t=s(n);i.trigger("scroll_element.xdsoft_scroller",[(a-(t.y-c.y))/(e-u)])}}),i.on("touchend touchcancel",function(){c=!1;a=0})),void i.trigger("resize_scroll.xdsoft_scroller",[t]))})};n.fn.datetimepicker=function(f,e){var c,v,y=this,p=48,nt=57,w=96,b=105,l=17,s=46,k=13,tt=27,h=8,it=37,rt=38,ut=39,ft=40,d=9,et=116,ot=65,st=67,ht=86,ct=90,lt=89,a=!1,o=n.isPlainObject(f)||!f?n.extend(!0,{},r,f):n.extend(!0,{},r),g=0,at=function(n){n.on("open.xdsoft focusin.xdsoft mousedown.xdsoft touchstart",function t(){n.is(":disabled")||n.data("xdsoft_datetimepicker")||(clearTimeout(g),g=setTimeout(function(){n.data("xdsoft_datetimepicker")||c(n);n.off("open.xdsoft focusin.xdsoft mousedown.xdsoft touchstart",t).trigger("open.xdsoft")},100))})};return c=function(r){function kt(){var t,n=!1;return o.startDate?n=c.strToDate(o.startDate):(n=o.value||(r&&r.val&&r.val()?r.val():""),n?n=c.strToDateTime(n):o.defaultDate&&(n=c.strToDateTime(o.defaultDate),o.defaultTime&&(t=c.strtotime(o.defaultTime),n.setHours(t.getHours()),n.setMinutes(t.getMinutes())))),n&&c.isValidDate(n)?e.data("changed",!0):n="",n||0}function fi(t){var i=function(n,t){var i=n.replace(/([\[\]\/\{\}\(\)\-\.\+]{1})/g,"\\$1").replace(/_/g,"{digit+}").replace(/([0-9]{1})/g,"{digit$1}").replace(/\{digit([0-9]{1})\}/g,"[0-$1_]{1}").replace(/\{digit[\+]\}/g,"[0-9_]{1}");return new RegExp(i).test(t)},f=function(n){try{if(document.selection&&document.selection.createRange){var t=document.selection.createRange();return t.getBookmark().charCodeAt(2)-2}if(n.setSelectionRange)return n.selectionStart}catch(i){return 0}},u=function(n,t){if(n="string"==typeof n||n instanceof String?document.getElementById(n):n,!n)return!1;if(n.createTextRange){var i=n.createTextRange();return i.collapse(!0),i.moveEnd("character",t),i.moveStart("character",t),i.select(),!0}return n.setSelectionRange?(n.setSelectionRange(t,t),!0):!1};t.mask&&r.off("keydown.xdsoft");t.mask===!0&&(t.mask="undefined"!=typeof moment?t.format.replace(/Y{4}/g,"9999").replace(/Y{2}/g,"99").replace(/M{2}/g,"19").replace(/D{2}/g,"39").replace(/H{2}/g,"29").replace(/m{2}/g,"59").replace(/s{2}/g,"59"):t.format.replace(/Y/g,"9999").replace(/F/g,"9999").replace(/m/g,"19").replace(/d/g,"39").replace(/H/g,"29").replace(/i/g,"59").replace(/s/g,"59"));"string"===n.type(t.mask)&&(i(t.mask,r.val())||(r.val(t.mask.replace(/[0-9]/g,"_")),u(r[0],0)),r.on("keydown.xdsoft",function(e){var c,y,v=this.value,o=e.which;if(o>=p&&nt>=o||o>=w&&b>=o||o===h||o===s){for(c=f(this),y=o!==h&&o!==s?String.fromCharCode(o>=w&&b>=o?o-p:o):"_",o!==h&&o!==s||!c||(c-=1,y="_");/[^0-9_]/.test(t.mask.substr(c,1))&&c<t.mask.length&&c>0;)c+=o===h||o===s?-1:1;if(v=v.substr(0,c)+y+v.substr(c+1),""===n.trim(v))v=t.mask.replace(/[0-9]/g,"_");else if(c===t.mask.length)return e.preventDefault(),!1;for(c+=o===h||o===s?0:1;/[^0-9_]/.test(t.mask.substr(c,1))&&c<t.mask.length&&c>0;)c+=o===h||o===s?-1:1;i(t.mask,v)?(this.value=v,u(this,c)):""===n.trim(v)?this.value=t.mask.replace(/[0-9]/g,"_"):r.trigger("error_input.xdsoft")}else if(-1!==[ot,st,ht,ct,lt].indexOf(o)&&a||-1!==[tt,rt,ft,it,ut,et,l,d,k].indexOf(o))return!0;return e.preventDefault(),!1}))}var ei,dt,pt,vt,wt,c,gt,e=n('<div class="xdsoft_datetimepicker xdsoft_noselect"><\/div>'),oi=n('<div class="xdsoft_copyright"><a target="_blank" href="http://xdsoft.net/jqplugins/datetimepicker/">xdsoft.net<\/a><\/div>'),at=n('<div class="xdsoft_datepicker active"><\/div>'),y=n('<div class="xdsoft_mounthpicker"><button type="button" class="xdsoft_prev"><\/button><button type="button" class="xdsoft_today_button"><\/button><div class="xdsoft_label xdsoft_month"><span><\/span><i><\/i><\/div><div class="xdsoft_label xdsoft_year"><span><\/span><i><\/i><\/div><button type="button" class="xdsoft_next"><\/button><\/div>'),ni=n('<div class="xdsoft_calendar"><\/div>'),yt=n('<div class="xdsoft_timepicker active"><button type="button" class="xdsoft_prev"><\/button><div class="xdsoft_time_box"><\/div><button type="button" class="xdsoft_next"><\/button><\/div>'),g=yt.find(".xdsoft_time_box").eq(0),v=n('<div class="xdsoft_time_variant"><\/div>'),ti=n('<button type="button" class="xdsoft_save_selected blue-gradient-button">Save Selected<\/button>'),ii=n('<div class="xdsoft_select xdsoft_monthselect"><div><\/div><\/div>'),ri=n('<div class="xdsoft_select xdsoft_yearselect"><div><\/div><\/div>'),bt=!1,ui=0;o.id&&e.attr("id",o.id);o.style&&e.attr("style",o.style);o.weeks&&e.addClass("xdsoft_showweeks");o.rtl&&e.addClass("xdsoft_rtl");e.addClass("xdsoft_"+o.theme);e.addClass(o.className);y.find(".xdsoft_month span").after(ii);y.find(".xdsoft_year span").after(ri);y.find(".xdsoft_month,.xdsoft_year").on("touchstart mousedown.xdsoft",function(t){var r,u,i=n(this).find(".xdsoft_select").eq(0),f=0,e=0,o=i.is(":visible");for(y.find(".xdsoft_select").hide(),c.currentTime&&(f=c.currentTime[n(this).hasClass("xdsoft_month")?"getMonth":"getFullYear"]()),i[o?"hide":"show"](),r=i.find("div.xdsoft_option"),u=0;u<r.length&&r.eq(u).data("value")!==f;u+=1)e+=r[0].offsetHeight;return i.xdsoftScroller(e/(i.children()[0].offsetHeight-i[0].clientHeight)),t.stopPropagation(),!1});y.find(".xdsoft_select").xdsoftScroller().on("touchstart mousedown.xdsoft",function(n){n.stopPropagation();n.preventDefault()}).on("touchstart mousedown.xdsoft",".xdsoft_option",function(){(void 0===c.currentTime||null===c.currentTime)&&(c.currentTime=c.now());var t=c.currentTime.getFullYear();c&&c.currentTime&&c.currentTime[n(this).parent().parent().hasClass("xdsoft_monthselect")?"setMonth":"setFullYear"](n(this).data("value"));n(this).parent().parent().hide();e.trigger("xchange.xdsoft");o.onChangeMonth&&n.isFunction(o.onChangeMonth)&&o.onChangeMonth.call(e,c.currentTime,e.data("input"));t!==c.currentTime.getFullYear()&&n.isFunction(o.onChangeYear)&&o.onChangeYear.call(e,c.currentTime,e.data("input"))});e.getValue=function(){return c.getCurrentTime()};e.setOptions=function(i){var f={};o=n.extend(!0,{},o,i);i.allowTimes&&n.isArray(i.allowTimes)&&i.allowTimes.length&&(o.allowTimes=n.extend(!0,[],i.allowTimes));i.weekends&&n.isArray(i.weekends)&&i.weekends.length&&(o.weekends=n.extend(!0,[],i.weekends));i.allowDates&&n.isArray(i.allowDates)&&i.allowDates.length&&(o.allowDates=n.extend(!0,[],i.allowDates));i.allowDateRe&&"[object String]"===Object.prototype.toString.call(i.allowDateRe)&&(o.allowDateRe=new RegExp(i.allowDateRe));i.highlightedDates&&n.isArray(i.highlightedDates)&&i.highlightedDates.length&&(n.each(i.highlightedDates,function(i,r){var s,c=n.map(r.split(","),n.trim),e=new u(t.parseDate(c[0],o.formatDate),c[1],c[2]),h=t.formatDate(e.date,o.formatDate);void 0!==f[h]?(s=f[h].desc,s&&s.length&&e.desc&&e.desc.length&&(f[h].desc=s+"\n"+e.desc)):f[h]=e}),o.highlightedDates=n.extend(!0,[],f));i.highlightedPeriods&&n.isArray(i.highlightedPeriods)&&i.highlightedPeriods.length&&(f=n.extend(!0,[],o.highlightedDates),n.each(i.highlightedPeriods,function(i,r){var e,a,v,s,h,l,y,c;for(n.isArray(r)?(e=r[0],a=r[1],v=r[2],y=r[3]):(c=n.map(r.split(","),n.trim),e=t.parseDate(c[0],o.formatDate),a=t.parseDate(c[1],o.formatDate),v=c[2],y=c[3]);a>=e;)s=new u(e,v,y),h=t.formatDate(e,o.formatDate),e.setDate(e.getDate()+1),void 0!==f[h]?(l=f[h].desc,l&&l.length&&s.desc&&s.desc.length&&(f[h].desc=l+"\n"+s.desc)):f[h]=s}),o.highlightedDates=n.extend(!0,[],f));i.disabledDates&&n.isArray(i.disabledDates)&&i.disabledDates.length&&(o.disabledDates=n.extend(!0,[],i.disabledDates));i.disabledWeekDays&&n.isArray(i.disabledWeekDays)&&i.disabledWeekDays.length&&(o.disabledWeekDays=n.extend(!0,[],i.disabledWeekDays));!o.open&&!o.opened||o.inline||r.trigger("open.xdsoft");o.inline&&(bt=!0,e.addClass("xdsoft_inline"),r.after(e).hide());o.inverseButton&&(o.next="xdsoft_prev",o.prev="xdsoft_next");o.datepicker?at.addClass("active"):at.removeClass("active");o.timepicker?yt.addClass("active"):yt.removeClass("active");o.value&&(c.setCurrentTime(o.value),r&&r.val&&r.val(c.str));o.dayOfWeekStart=isNaN(o.dayOfWeekStart)?0:parseInt(o.dayOfWeekStart,10)%7;o.timepickerScrollbar||g.xdsoftScroller("hide");o.minDate&&/^[\+\-](.*)$/.test(o.minDate)&&(o.minDate=t.formatDate(c.strToDateTime(o.minDate),o.formatDate));o.maxDate&&/^[\+\-](.*)$/.test(o.maxDate)&&(o.maxDate=t.formatDate(c.strToDateTime(o.maxDate),o.formatDate));ti.toggle(o.showApplyButton);y.find(".xdsoft_today_button").css("visibility",o.todayButton?"visible":"hidden");y.find("."+o.prev).css("visibility",o.prevButton?"visible":"hidden");y.find("."+o.next).css("visibility",o.nextButton?"visible":"hidden");fi(o);o.validateOnBlur&&r.off("blur.xdsoft").on("blur.xdsoft",function(){var u,i,r;o.allowBlank&&(!n.trim(n(this).val()).length||"string"==typeof o.mask&&n.trim(n(this).val())===o.mask.replace(/[0-9]/g,"_"))?(n(this).val(null),e.data("xdsoft_datetime").empty()):(u=t.parseDate(n(this).val(),o.format),u?n(this).val(t.formatDate(u,o.format)):(i=+[n(this).val()[0],n(this).val()[1]].join(""),r=+[n(this).val()[2],n(this).val()[3]].join(""),n(this).val(!o.datepicker&&o.timepicker&&i>=0&&24>i&&r>=0&&60>r?[i,r].map(function(n){return n>9?n:"0"+n}).join(":"):t.formatDate(c.now(),o.format))),e.data("xdsoft_datetime").setCurrentTime(n(this).val()));e.trigger("changedatetime.xdsoft");e.trigger("close.xdsoft")});o.dayOfWeekStartPrev=0===o.dayOfWeekStart?6:o.dayOfWeekStart-1;e.trigger("xchange.xdsoft").trigger("afterOpen.xdsoft")};e.data("options",o).on("touchstart mousedown.xdsoft",function(n){return n.stopPropagation(),n.preventDefault(),ri.hide(),ii.hide(),!1});g.append(v);g.xdsoftScroller();e.on("afterOpen.xdsoft",function(){g.xdsoftScroller()});e.append(at).append(yt);o.withoutCopyright!==!0&&e.append(oi);at.append(y).append(ni).append(ti);n(o.parentID).append(e);ei=function(){var i=this;i.now=function(n){var r,u,t=new Date;return!n&&o.defaultDate&&(r=i.strToDateTime(o.defaultDate),t.setFullYear(r.getFullYear()),t.setMonth(r.getMonth()),t.setDate(r.getDate())),o.yearOffset&&t.setFullYear(t.getFullYear()+o.yearOffset),!n&&o.defaultTime&&(u=i.strtotime(o.defaultTime),t.setHours(u.getHours()),t.setMinutes(u.getMinutes())),t};i.isValidDate=function(n){return"[object Date]"!==Object.prototype.toString.call(n)?!1:!isNaN(n.getTime())};i.setCurrentTime=function(n){i.currentTime="string"==typeof n?i.strToDateTime(n):i.isValidDate(n)?n:i.now();e.trigger("xchange.xdsoft")};i.empty=function(){i.currentTime=null};i.getCurrentTime=function(){return i.currentTime};i.nextMonth=function(){(void 0===i.currentTime||null===i.currentTime)&&(i.currentTime=i.now());var r,t=i.currentTime.getMonth()+1;return 12===t&&(i.currentTime.setFullYear(i.currentTime.getFullYear()+1),t=0),r=i.currentTime.getFullYear(),i.currentTime.setDate(Math.min(new Date(i.currentTime.getFullYear(),t+1,0).getDate(),i.currentTime.getDate())),i.currentTime.setMonth(t),o.onChangeMonth&&n.isFunction(o.onChangeMonth)&&o.onChangeMonth.call(e,c.currentTime,e.data("input")),r!==i.currentTime.getFullYear()&&n.isFunction(o.onChangeYear)&&o.onChangeYear.call(e,c.currentTime,e.data("input")),e.trigger("xchange.xdsoft"),t};i.prevMonth=function(){(void 0===i.currentTime||null===i.currentTime)&&(i.currentTime=i.now());var t=i.currentTime.getMonth()-1;return-1===t&&(i.currentTime.setFullYear(i.currentTime.getFullYear()-1),t=11),i.currentTime.setDate(Math.min(new Date(i.currentTime.getFullYear(),t+1,0).getDate(),i.currentTime.getDate())),i.currentTime.setMonth(t),o.onChangeMonth&&n.isFunction(o.onChangeMonth)&&o.onChangeMonth.call(e,c.currentTime,e.data("input")),e.trigger("xchange.xdsoft"),t};i.getWeekOfYear=function(t){var r,i;return o.onGetWeekOfYear&&n.isFunction(o.onGetWeekOfYear)&&(r=o.onGetWeekOfYear.call(e,t),"undefined"!=typeof r)?r:(i=new Date(t.getFullYear(),0,1),4!=i.getDay()&&i.setMonth(0,1+(11-i.getDay())%7),Math.ceil(((t-i)/864e5+i.getDay()+1)/7))};i.strToDateTime=function(n){var f,u,r=[];return n&&n instanceof Date&&i.isValidDate(n)?n:(r=/^(\+|\-)(.*)$/.exec(n),r&&(r[2]=t.parseDate(r[2],o.formatDate)),r&&r[2]?(f=r[2].getTime()-6e4*r[2].getTimezoneOffset(),u=new Date(i.now(!0).getTime()+parseInt(r[1]+"1",10)*f)):u=n?t.parseDate(n,o.format):i.now(),i.isValidDate(u)||(u=i.now()),u)};i.strToDate=function(n){if(n&&n instanceof Date&&i.isValidDate(n))return n;var r=n?t.parseDate(n,o.formatDate):i.now(!0);return i.isValidDate(r)||(r=i.now(!0)),r};i.strtotime=function(n){if(n&&n instanceof Date&&i.isValidDate(n))return n;var r=n?t.parseDate(n,o.formatTime):i.now(!0);return i.isValidDate(r)||(r=i.now(!0)),r};i.str=function(){return t.formatDate(i.currentTime,o.format)};i.currentTime=this.now()};c=new ei;ti.on("touchend click",function(n){n.preventDefault();e.data("changed",!0);c.setCurrentTime(kt());r.val(c.str());e.trigger("close.xdsoft")});y.find(".xdsoft_today_button").on("touchend mousedown.xdsoft",function(){e.data("changed",!0);c.setCurrentTime(0);e.trigger("afterOpen.xdsoft")}).on("dblclick.xdsoft",function(){var n,t,i=c.getCurrentTime();i=new Date(i.getFullYear(),i.getMonth(),i.getDate());n=c.strToDate(o.minDate);n=new Date(n.getFullYear(),n.getMonth(),n.getDate());n>i||(t=c.strToDate(o.maxDate),t=new Date(t.getFullYear(),t.getMonth(),t.getDate()),i>t||(r.val(c.str()),r.trigger("change"),e.trigger("close.xdsoft")))});y.find(".xdsoft_prev,.xdsoft_next").on("touchend mousedown.xdsoft",function(){var t=n(this),i=0,r=!1;!function u(n){t.hasClass(o.next)?c.nextMonth():t.hasClass(o.prev)&&c.prevMonth();o.monthChangeSpinner&&(r||(i=setTimeout(u,n||100)))}(500);n([document.body,window]).on("touchend mouseup.xdsoft",function f(){clearTimeout(i);r=!0;n([document.body,window]).off("touchend mouseup.xdsoft",f)})});yt.find(".xdsoft_prev,.xdsoft_next").on("touchend mousedown.xdsoft",function(){var i=n(this),r=0,u=!1,t=110;!function f(n){var s=g[0].clientHeight,h=v[0].offsetHeight,e=Math.abs(parseInt(v.css("marginTop"),10));i.hasClass(o.next)&&h-s-o.timeHeightInTimePicker>=e?v.css("marginTop","-"+(e+o.timeHeightInTimePicker)+"px"):i.hasClass(o.prev)&&e-o.timeHeightInTimePicker>=0&&v.css("marginTop","-"+(e-o.timeHeightInTimePicker)+"px");g.trigger("scroll_element.xdsoft_scroller",[Math.abs(parseInt(v[0].style.marginTop,10)/(h-s))]);t=t>10?10:t-10;u||(r=setTimeout(f,n||t))}(500);n([document.body,window]).on("touchend mouseup.xdsoft",function e(){clearTimeout(r);u=!0;n([document.body,window]).off("touchend mouseup.xdsoft",e)})});dt=0;e.on("xchange.xdsoft",function(u){clearTimeout(dt);dt=setTimeout(function(){(void 0===c.currentTime||null===c.currentTime)&&(c.currentTime=c.now());for(var a,d,et,nt,ot,p,st,k,tt,it,l="",u=new Date(c.currentTime.getFullYear(),c.currentTime.getMonth(),1,12,0,0),s=0,rt=c.now(),w=!1,b=!1,h=[],ut=!0,ft="",g="";u.getDay()!==o.dayOfWeekStart;)u.setDate(u.getDate()-1);for(l+="<table><thead><tr>",o.weeks&&(l+="<th><\/th>"),a=0;7>a;a+=1)l+="<th>"+o.i18n[i].dayOfWeekShort[(a+o.dayOfWeekStart)%7]+"<\/th>";for(l+="<\/tr><\/thead>",l+="<tbody>",o.maxDate!==!1&&(w=c.strToDate(o.maxDate),w=new Date(w.getFullYear(),w.getMonth(),w.getDate(),23,59,59,999)),o.minDate!==!1&&(b=c.strToDate(o.minDate),b=new Date(b.getFullYear(),b.getMonth(),b.getDate()));s<c.currentTime.countDaysInMonth()||u.getDay()!==o.dayOfWeekStart||c.currentTime.getMonth()===u.getMonth();)h=[],s+=1,et=u.getDay(),nt=u.getDate(),ot=u.getFullYear(),p=u.getMonth(),st=c.getWeekOfYear(u),it="",h.push("xdsoft_date"),k=o.beforeShowDay&&n.isFunction(o.beforeShowDay.call)?o.beforeShowDay.call(e,u):null,o.allowDateRe&&"[object RegExp]"===Object.prototype.toString.call(o.allowDateRe)?o.allowDateRe.test(t.formatDate(u,o.formatDate))||h.push("xdsoft_disabled"):o.allowDates&&o.allowDates.length>0?-1===o.allowDates.indexOf(t.formatDate(u,o.formatDate))&&h.push("xdsoft_disabled"):w!==!1&&u>w||b!==!1&&b>u||k&&k[0]===!1?h.push("xdsoft_disabled"):-1!==o.disabledDates.indexOf(t.formatDate(u,o.formatDate))?h.push("xdsoft_disabled"):-1!==o.disabledWeekDays.indexOf(et)?h.push("xdsoft_disabled"):r.is("[readonly]")&&h.push("xdsoft_disabled"),k&&""!==k[1]&&h.push(k[1]),c.currentTime.getMonth()!==p&&h.push("xdsoft_other_month"),(o.defaultSelect||e.data("changed"))&&t.formatDate(c.currentTime,o.formatDate)===t.formatDate(u,o.formatDate)&&h.push("xdsoft_current"),t.formatDate(rt,o.formatDate)===t.formatDate(u,o.formatDate)&&h.push("xdsoft_today"),(0===u.getDay()||6===u.getDay()||-1!==o.weekends.indexOf(t.formatDate(u,o.formatDate)))&&h.push("xdsoft_weekend"),void 0!==o.highlightedDates[t.formatDate(u,o.formatDate)]&&(d=o.highlightedDates[t.formatDate(u,o.formatDate)],h.push(void 0===d.style?"xdsoft_highlighted_default":d.style),it=void 0===d.desc?"":d.desc),o.beforeShowDay&&n.isFunction(o.beforeShowDay)&&h.push(o.beforeShowDay(u)),ut&&(l+="<tr>",ut=!1,o.weeks&&(l+="<th>"+st+"<\/th>")),l+='<td data-date="'+nt+'" data-month="'+p+'" data-year="'+ot+'" class="xdsoft_date xdsoft_day_of_week'+u.getDay()+" "+h.join(" ")+'" title="'+it+'"><div>'+nt+"<\/div><\/td>",u.getDay()===o.dayOfWeekStartPrev&&(l+="<\/tr>",ut=!0),u.setDate(nt+1);if(l+="<\/tbody><\/table>",ni.html(l),y.find(".xdsoft_label span").eq(0).text(o.i18n[i].months[c.currentTime.getMonth()]),y.find(".xdsoft_label span").eq(1).text(c.currentTime.getFullYear()),ft="",g="",p="",tt=function(i,u){var s,l,f=c.now(),a=o.allowTimes&&n.isArray(o.allowTimes)&&o.allowTimes.length;f.setHours(i);i=parseInt(f.getHours(),10);f.setMinutes(u);u=parseInt(f.getMinutes(),10);s=new Date(c.currentTime);s.setHours(i);s.setMinutes(u);h=[];o.minDateTime!==!1&&o.minDateTime>s||o.maxTime!==!1&&c.strtotime(o.maxTime).getTime()<f.getTime()||o.minTime!==!1&&c.strtotime(o.minTime).getTime()>f.getTime()?h.push("xdsoft_disabled"):o.minDateTime!==!1&&o.minDateTime>s||o.disabledMinTime!==!1&&f.getTime()>c.strtotime(o.disabledMinTime).getTime()&&o.disabledMaxTime!==!1&&f.getTime()<c.strtotime(o.disabledMaxTime).getTime()?h.push("xdsoft_disabled"):r.is("[readonly]")&&h.push("xdsoft_disabled");l=new Date(c.currentTime);l.setHours(parseInt(c.currentTime.getHours(),10));a||l.setMinutes(Math[o.roundTime](c.currentTime.getMinutes()/o.step)*o.step);(o.initTime||o.defaultSelect||e.data("changed"))&&l.getHours()===parseInt(i,10)&&(!a&&o.step>59||l.getMinutes()===parseInt(u,10))&&(o.defaultSelect||e.data("changed")?h.push("xdsoft_current"):o.initTime&&h.push("xdsoft_init_time"));parseInt(rt.getHours(),10)===parseInt(i,10)&&parseInt(rt.getMinutes(),10)===parseInt(u,10)&&h.push("xdsoft_today");ft+='<div class="xdsoft_time '+h.join(" ")+'" data-hour="'+i+'" data-minute="'+u+'">'+t.formatDate(f,o.formatTime)+"<\/div>"},o.allowTimes&&n.isArray(o.allowTimes)&&o.allowTimes.length)for(s=0;s<o.allowTimes.length;s+=1)g=c.strtotime(o.allowTimes[s]).getHours(),p=c.strtotime(o.allowTimes[s]).getMinutes(),tt(g,p);else for(s=0,a=0;s<(o.hours12?12:24);s+=1)for(a=0;60>a;a+=o.step)g=(10>s?"0":"")+s,p=(10>a?"0":"")+a,tt(g,p);for(v.html(ft),f="",s=0,s=parseInt(o.yearStart,10)+o.yearOffset;s<=parseInt(o.yearEnd,10)+o.yearOffset;s+=1)f+='<div class="xdsoft_option '+(c.currentTime.getFullYear()===s?"xdsoft_current":"")+'" data-value="'+s+'">'+s+"<\/div>";for(ri.children().eq(0).html(f),s=parseInt(o.monthStart,10),f="";s<=parseInt(o.monthEnd,10);s+=1)f+='<div class="xdsoft_option '+(c.currentTime.getMonth()===s?"xdsoft_current":"")+'" data-value="'+s+'">'+o.i18n[i].months[s]+"<\/div>";ii.children().eq(0).html(f);n(e).trigger("generate.xdsoft")},10);u.stopPropagation()}).on("afterOpen.xdsoft",function(){if(o.timepicker){var n,t,i,r;v.find(".xdsoft_current").length?n=".xdsoft_current":v.find(".xdsoft_init_time").length&&(n=".xdsoft_init_time");n?(t=g[0].clientHeight,i=v[0].offsetHeight,r=v.find(n).index()*o.timeHeightInTimePicker+1,r>i-t&&(r=i-t),g.trigger("scroll_element.xdsoft_scroller",[parseInt(r,10)/(i-t)])):g.trigger("scroll_element.xdsoft_scroller",[0])}});pt=0;ni.on("touchend click.xdsoft","td",function(t){t.stopPropagation();pt+=1;var u=n(this),i=c.currentTime;return(void 0===i||null===i)&&(c.currentTime=c.now(),i=c.currentTime),u.hasClass("xdsoft_disabled")?!1:(i.setDate(1),i.setFullYear(u.data("year")),i.setMonth(u.data("month")),i.setDate(u.data("date")),e.trigger("select.xdsoft",[i]),r.val(c.str()),o.onSelectDate&&n.isFunction(o.onSelectDate)&&o.onSelectDate.call(e,c.currentTime,e.data("input"),t),e.data("changed",!0),e.trigger("xchange.xdsoft"),e.trigger("changedatetime.xdsoft"),(pt>1||o.closeOnDateSelect===!0||o.closeOnDateSelect===!1&&!o.timepicker)&&!o.inline&&e.trigger("close.xdsoft"),void setTimeout(function(){pt=0},200))});v.on("touchend click.xdsoft","div",function(t){t.stopPropagation();var r=n(this),i=c.currentTime;return(void 0===i||null===i)&&(c.currentTime=c.now(),i=c.currentTime),r.hasClass("xdsoft_disabled")?!1:(i.setHours(r.data("hour")),i.setMinutes(r.data("minute")),e.trigger("select.xdsoft",[i]),e.data("input").val(c.str()),o.onSelectTime&&n.isFunction(o.onSelectTime)&&o.onSelectTime.call(e,c.currentTime,e.data("input"),t),e.data("changed",!0),e.trigger("xchange.xdsoft"),e.trigger("changedatetime.xdsoft"),void(o.inline!==!0&&o.closeOnTimeSelect===!0&&e.trigger("close.xdsoft")))});at.on("mousewheel.xdsoft",function(n){return o.scrollMonth?(n.deltaY<0?c.nextMonth():c.prevMonth(),!1):!0});r.on("mousewheel.xdsoft",function(n){return o.scrollInput?!o.datepicker&&o.timepicker?(vt=v.find(".xdsoft_current").length?v.find(".xdsoft_current").eq(0).index():0,vt+n.deltaY>=0&&vt+n.deltaY<v.children().length&&(vt+=n.deltaY),v.children().eq(vt).length&&v.children().eq(vt).trigger("mousedown"),!1):o.datepicker&&!o.timepicker?(at.trigger(n,[n.deltaY,n.deltaX,n.deltaY]),r.val&&r.val(c.str()),e.trigger("changedatetime.xdsoft"),!1):void 0:!0});e.on("changedatetime.xdsoft",function(t){if(o.onChangeDateTime&&n.isFunction(o.onChangeDateTime)){var i=e.data("input");o.onChangeDateTime.call(e,c.currentTime,i,t);delete o.value;i.trigger("change")}}).on("generate.xdsoft",function(){o.onGenerate&&n.isFunction(o.onGenerate)&&o.onGenerate.call(e,c.currentTime,e.data("input"));bt&&(e.trigger("afterOpen.xdsoft"),bt=!1)}).on("click.xdsoft",function(n){n.stopPropagation()});vt=0;gt=function(n,t){do if(n=n.parentNode,t(n)===!1)break;while("HTML"!==n.nodeName)};wt=function(){var u,i,t,r,c,p,a,s,h,v,y,l,f,w;(s=e.data("input"),u=s.offset(),i=s[0],v="top",t=u.top+i.offsetHeight-1,r=u.left,c="absolute",h=n(window).width(),l=n(window).height(),f=n(window).scrollTop(),document.documentElement.clientWidth-u.left<at.parent().outerWidth(!0))&&(w=at.parent().outerWidth(!0)-i.offsetWidth,r-=w);"rtl"===s.parent().css("direction")&&(r-=e.outerWidth()-s.outerWidth());o.fixed?(t-=f,r-=n(window).scrollLeft(),c="fixed"):(a=!1,gt(i,function(n){if("fixed"===window.getComputedStyle(n).getPropertyValue("position"))return(a=!0,!1)}),a?(c="fixed",t+e.outerHeight()>l+f?(v="bottom",t=l+f-u.top):t-=f):t+i.offsetHeight>l+f&&(t=u.top-i.offsetHeight+1),0>t&&(t=0),r+i.offsetWidth>h&&(r=h-i.offsetWidth));p=e[0];gt(p,function(n){var t;return t=window.getComputedStyle(n).getPropertyValue("position"),"relative"===t&&h>=n.offsetWidth?(r-=(h-n.offsetWidth)/2,!1):void 0});y={position:c,left:r,top:"",bottom:""};y[v]=t;e.css(y)};e.on("open.xdsoft",function(t){var i=!0;o.onShow&&n.isFunction(o.onShow)&&(i=o.onShow.call(e,c.currentTime,e.data("input"),t));i!==!1&&(e.show(),wt(),n(window).off("resize.xdsoft",wt).on("resize.xdsoft",wt),o.closeOnWithoutClick&&n([document.body,window]).on("touchstart mousedown.xdsoft",function r(){e.trigger("close.xdsoft");n([document.body,window]).off("touchstart mousedown.xdsoft",r)}))}).on("close.xdsoft",function(t){var i=!0;y.find(".xdsoft_month,.xdsoft_year").find(".xdsoft_select").hide();o.onClose&&n.isFunction(o.onClose)&&(i=o.onClose.call(e,c.currentTime,e.data("input"),t));i===!1||o.opened||o.inline||e.hide();t.stopPropagation()}).on("toggle.xdsoft",function(){e.trigger(e.is(":visible")?"close.xdsoft":"open.xdsoft")}).data("input",r);ui=0;e.data("xdsoft_datetime",c);e.setOptions(o);c.setCurrentTime(kt());r.data("xdsoft_datetimepicker",e).on("open.xdsoft focusin.xdsoft mousedown.xdsoft touchstart",function(){r.is(":disabled")||r.data("xdsoft_datetimepicker").is(":visible")&&o.closeOnInputClick||(clearTimeout(ui),ui=setTimeout(function(){r.is(":disabled")||(bt=!0,c.setCurrentTime(kt()),o.mask&&fi(o),e.trigger("open.xdsoft"))},100))}).on("keydown.xdsoft",function(t){var i,r=t.which;return-1!==[k].indexOf(r)&&o.enterLikeTab?(i=n("input:visible,textarea:visible,button:visible,a:visible"),e.trigger("close.xdsoft"),i.eq(i.index(this)+1).focus(),!1):-1!==[d].indexOf(r)?(e.trigger("close.xdsoft"),!0):void 0}).on("blur.xdsoft",function(){e.trigger("close.xdsoft")})},v=function(t){var i=t.data("xdsoft_datetimepicker");i&&(i.data("xdsoft_datetime",null),i.remove(),t.data("xdsoft_datetimepicker",null).off(".xdsoft"),n(window).off("resize.xdsoft"),n([window,document.body]).off("mousedown.xdsoft touchstart"),t.unmousewheel&&t.unmousewheel())},n(document).off("keydown.xdsoftctrl keyup.xdsoftctrl").on("keydown.xdsoftctrl",function(n){n.keyCode===l&&(a=!0)}).on("keyup.xdsoftctrl",function(n){n.keyCode===l&&(a=!1)}),this.each(function(){var r,i=n(this).data("xdsoft_datetimepicker");if(i){if("string"===n.type(f))switch(f){case"show":n(this).select().focus();i.trigger("open.xdsoft");break;case"hide":i.trigger("close.xdsoft");break;case"toggle":i.trigger("toggle.xdsoft");break;case"destroy":v(n(this));break;case"reset":this.value=this.defaultValue;this.value&&i.data("xdsoft_datetime").isValidDate(t.parseDate(this.value,o.format))||i.data("changed",!1);i.data("xdsoft_datetime").setCurrentTime(this.value);break;case"validate":r=i.data("input");r.trigger("blur.xdsoft");break;default:i[f]&&n.isFunction(i[f])&&(y=i[f](e))}else i.setOptions(f);return 0}"string"!==n.type(f)&&(!o.lazyInit||o.open||o.inline?c(n(this)):at(n(this)))}),y};n.fn.datetimepicker.defaults=r}),function(n){"function"==typeof define&&define.amd?define(["jquery"],n):"object"==typeof exports?module.exports=n:n(jQuery)}(function(n){function u(r){var u=r||window.event,w=c.call(arguments,1),l=0,s=0,e=0,a=0,b=0,k=0,v,y,p;if(r=n.event.fix(u),r.type="mousewheel","detail"in u&&(e=-1*u.detail),"wheelDelta"in u&&(e=u.wheelDelta),"wheelDeltaY"in u&&(e=u.wheelDeltaY),"wheelDeltaX"in u&&(s=-1*u.wheelDeltaX),"axis"in u&&u.axis===u.HORIZONTAL_AXIS&&(s=-1*e,e=0),l=0===e?s:e,"deltaY"in u&&(e=-1*u.deltaY,l=e),"deltaX"in u&&(s=u.deltaX,0===e&&(l=-1*s)),0!==e||0!==s)return 1===u.deltaMode?(v=n.data(this,"mousewheel-line-height"),l*=v,e*=v,s*=v):2===u.deltaMode&&(y=n.data(this,"mousewheel-page-height"),l*=y,e*=y,s*=y),(a=Math.max(Math.abs(e),Math.abs(s)),(!t||t>a)&&(t=a,o(u,a)&&(t/=40)),o(u,a)&&(l/=40,s/=40,e/=40),l=Math[l>=1?"floor":"ceil"](l/t),s=Math[s>=1?"floor":"ceil"](s/t),e=Math[e>=1?"floor":"ceil"](e/t),i.settings.normalizeOffset&&this.getBoundingClientRect)&&(p=this.getBoundingClientRect(),b=r.clientX-p.left,k=r.clientY-p.top),r.deltaX=s,r.deltaY=e,r.deltaFactor=t,r.offsetX=b,r.offsetY=k,r.deltaMode=0,w.unshift(r,l,s,e),f&&clearTimeout(f),f=setTimeout(h,200),(n.event.dispatch||n.event.handle).apply(this,w)}function h(){t=null}function o(n,t){return i.settings.adjustOldDeltas&&"mousewheel"===n.type&&t%120==0}var f,t,s=["wheel","mousewheel","DOMMouseScroll","MozMousePixelScroll"],r="onwheel"in document||document.documentMode>=9?["wheel"]:["mousewheel","DomMouseScroll","MozMousePixelScroll"],c=Array.prototype.slice,e,i;if(n.event.fixHooks)for(e=s.length;e;)n.event.fixHooks[s[--e]]=n.event.mouseHooks;i=n.event.special.mousewheel={version:"3.1.12",setup:function(){if(this.addEventListener)for(var t=r.length;t;)this.addEventListener(r[--t],u,!1);else this.onmousewheel=u;n.data(this,"mousewheel-line-height",i.getLineHeight(this));n.data(this,"mousewheel-page-height",i.getPageHeight(this))},teardown:function(){if(this.removeEventListener)for(var t=r.length;t;)this.removeEventListener(r[--t],u,!1);else this.onmousewheel=null;n.removeData(this,"mousewheel-line-height");n.removeData(this,"mousewheel-page-height")},getLineHeight:function(t){var r=n(t),i=r["offsetParent"in n.fn?"offsetParent":"parent"]();return i.length||(i=n("body")),parseInt(i.css("fontSize"),10)||parseInt(r.css("fontSize"),10)||16},getPageHeight:function(t){return n(t).height()},settings:{adjustOldDeltas:!0,normalizeOffset:!0}};n.fn.extend({mousewheel:function(n){return n?this.bind("mousewheel",n):this.trigger("mousewheel")},unmousewheel:function(n){return this.unbind("mousewheel",n)}})})